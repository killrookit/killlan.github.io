<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">敲竹杠家族又出新玩法 - 随机化密码、邮件取信</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">360安全卫士</a> <span class="bull">·</span> <time title="2015/10/23 15:28" ui-time="" datetime="2015/10/23 15:28" class="published ng-binding ng-isolate-scope">2015/10/23 15:28</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h1>0x01 概况</h1><hr><p>近期360QVM团队截获到了一批伪装成游戏外挂、QQ刷钻、游戏刷装备等类型的敲诈软件。一旦用户点击运行，用户计算机的管理员账号将被添加或更改密码，造成用户计算机无法进行任何操作。如果用户想要解锁手机只能联系恶意软件界面上留下的QQ号码并向其进行付费，从而达到勒索用户资金的目的。</p><h1>0x02 样本分析</h1><hr><p>近期我们捕获到的恶意勒索类软件主要分为两种实现方法，其中一种是为计算机用户添加固定的用户密码；另一种是通过当前环境的部分信息进行加密计算后设置系统的用户密码，导致无法进入系统操作界面，本文将以一枚随机算法的样本进行分析。</p><p>样本信息：</p><ul><li>MD5:FD71FA7B8B9282618E050653464611F4</li><li>SHA1:C0126EACC1D50F0F7BBE3C1303EA61154688AC4B</li></ul><p>(1)样本执行流程</p><p>样本首先通过随机数和取时间进行混合运算后得到密码，然后通过操作注册表达到关闭UCA(User Account Control)等功能，再修改用户密码并向作者设定好的邮箱中投递密码信息用作用户赎回密码时提供密码，最后进行强制关机。</p><p><img alt="" img-src="5452d3bc6dfd01ec534656b958e84b0568088622.jpg"></p><p>(2)样本具体行为</p><p>样本启动后首先对设置自身为开机启动项，在注册表内建立</p><p>“3.exe”的注册表项</p><p><img alt="" img-src="05f2d8829e0a266fb6128c35c924fc310fa2310d.jpg"></p><p>通过taskkill 来结束卡巴斯基、瑞星、McAfee 等安全软件来实现保护自身的目的。</p><p><img alt="" img-src="16932172d37036bdbb5c89ffabc2a4c8f266335d.jpg"></p><p><img alt="" img-src="815e874facc1a089e8efe4ffb8e15b369ab8c667.jpg"></p><p>对注册表的相关操作数量过多，将在下文源码中具体体现。</p><p>其中设置注册表项共计如下：</p><p><img alt="" img-src="9e3a1964f3da6d88b62a3c4fa0ee0fa5c64b062b.jpg"></p><p>其中删除注册表共计如下：</p><p><img alt="" img-src="3d031086e4547a6a84afa5e3347cd745f80c3cae.jpg"></p><p><img alt="" img-src="0109256c32e650f1e956c4262d1d0c26fc0355f2.jpg"></p><p><img alt="" img-src="2f5f0220078f9d470cb4e6f386ce7e54e7dc8aa7.jpg"></p><p>调用cmd进行添加计算机密码</p><p><img alt="" img-src="19a69319f9a2fc1f423bce31dcdacde37c03b705.jpg"></p><p>对作者预设的邮箱中发送密码信息，在发送密码后将进行关机</p><p><img alt="" img-src="4c236ae063e2900891cacfe9f87f98603b91bd05.jpg"></p><p>因为样本是易语言样本，根据其特性识别样本中的支持库信息并还原源码，其算法部分如下：</p><p><img alt="" img-src="ab6f58a2b8d326d6c62252e131a8cfced6a6f15d.jpg"></p><p>逆向支持库后还原完整源码如下：</p><p><img alt="" img-src="75829faced3abf4d02792ab4b14fbf1224c85aa3.jpg"></p><h1>0x03 解决方案</h1><hr><p>对付敲竹杠木马以预防为主，如果不慎中招，推荐使用360安全查询的敲竹杠木马开机密码找回功能(<code>http://fuwu.360.cn/chaxun/qq</code>)，我们通过对样本分析，不断更新补充敲竹杠木马的开机密码库，在找回开机密码后请及时全盘扫描杀毒。如遇到无法查到密码的情况，也欢迎向我们提交样本反馈。</p><p><img alt="" img-src="621f0b77370fa5d4e863f1aff9c78f446e102fc3.jpg"></p><p><img alt="" img-src="f9f93a1765f408951f9195ea4eba2c6f04e887ba.jpg"></p><p>开机密码找回步骤:</p><p>1、若您的电脑开机出现如下画面</p><p><img alt="" img-src="27dafd3d60f452f0a13e6c6a09ef8612ead87763.jpg"></p><p>2、输入对方留下的联系QQ号码</p><p><img alt="" img-src="e060f4830cfa3eb4e497165dc33f3644fe124c58.jpg"></p><p>3、立即修改您的密码(控制面板→用户账户→更改密码)</p><h1>0x04 总结</h1><hr><p>在PC领域，“勒索软件”这个词在去年一个名为CryptLocker的病毒爆发之后逐渐进入公众视线，其会将用户文档资料全部加密，而用户必须给黑客支付300美元或0.5比特币才能找回自己的文档资料。而在此之后国内也出现了利用添加或修改用户开机密码进行勒索的恶意软件，并且有愈演愈烈地趋势。这种类型的恶意软件如果进一步演变，对用户电脑及电脑上的数据资料都会带来巨大的安全风险和威胁。我们将密切关注此类恶意软件的演变趋势并提供有效的解决方案。</p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Sakura丶小樱</span> <span class="reply-time">2015-11-01 23:09:29</span></div><p></p><p>输入QQ查密码是什么原理？求告知！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Nppll</span> <span class="reply-time">2015-10-28 17:53:13</span></div><p></p><p>安全软件就被一个taskkill杀了？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">小良不能说的秘密</span> <span class="reply-time">2015-10-26 07:15:21</span></div><p></p><p>@phunter 不是有谷歌么</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">小良不能说的秘密</span> <span class="reply-time">2015-10-26 07:13:44</span></div><p></p><p>学习了，通过随机数和时间随机生成密码，这敲竹杠又升级了。。。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Michael</span> <span class="reply-time">2015-10-24 15:11:16</span></div><p></p><p>這玩意專門針對XP的呀，現在Microsoft賬戶的好處就真正體現出來。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">phunter</span> <span class="reply-time">2015-10-24 01:46:29</span></div><p></p><p>易语言太亮了，你说要是易语言写一个木马专门打国外网站，这抓到了老外也不能反编译，是不是很机智</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">yi</span> <span class="reply-time">2015-10-23 16:21:51</span></div><p></p><p>The Yi language is 66666666666</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">。</span> <span class="reply-time">2015-10-23 16:15:48</span></div><p></p><p>借机敲诈 20-30 元不等的钱财</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">红衣大炮</span> <span class="reply-time">2015-10-23 15:39:37</span></div><p></p><p>唉， 丢人啊</p><p></p></div></div></div></div></div></main>