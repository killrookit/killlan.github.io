<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">黑产godlike攻击: 邮箱 XSS 窃取 appleID 的案例分析</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">路人甲</a> <span class="bull">·</span> <time title="2015/12/30 18:34" ui-time="" datetime="2015/12/30 18:34" class="published ng-binding ng-isolate-scope">2015/12/30 18:34</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><p>最近黑产利用腾讯邮箱的漏洞组合，开始频繁的针对腾讯用户实施攻击。</p><p>其利用的页面都起名为godlike.html，所以我们把这起攻击事件命名为godlike。</p><p>主要被利用的漏洞有3个, 一个 URL 跳转, 一个 CSRF, 另外一个就是 XSS</p><h1>0x00</h1><hr><p>早上的时候被同学叫起来看一个链接</p><p><img alt="" img-src="9169493c000c01d74fe8c9ed66693bffbb2d0039.jpg"></p><p>第一眼看到这个以为是张图片, 欺骗性很高, 不过因为当时嫌麻烦没有点进去</p><p>后来在电脑上发现是一个链接而不是图片才感到有问题, 这里的锅主要是腾讯的一个 URL 跳转了.</p><h1>0x01 URL 跳转恶意构造指向 title</h1><hr><p>这里的这个 URL 跳转很猥琐</p><blockquote><p>http://jump.qt.qq.com/php/jump/check_url/?url=http://www.qmaild.xyz</p></blockquote><p>可以看到被指向的 url 是 www.qmaild.xyz。</p><p>而这个 www.qmaild.xyz 把 title 设置成了这样</p><p><img alt="" img-src="639d4221cc486edfb5d080f62a2feb67e33bbac0.jpg"></p><p>所以在手机里会有产生极为类似 img 文件的效果, 如果加上类似 『这个妹子好正』,之类的相信上钩的几率会更加高, 附一张手机 QQ 发送正常图片的截图</p><p><img alt="" img-src="d66d202a4d2bcd431904307e64ec039712c3fc08.jpg"></p><h1>0x02 CSRF 自动请求 XSS 页面</h1><hr><p>跳转到 www.qmaild.xyz 这个 URL 之后直接 iframe 了 godlike.html ( 我猜是个玩 lol 的放纵 boy, 具体代码可以看下面</p><p><img alt="" img-src="1cc33ac235678cb6ffd41587381ae03b593edece.jpg"></p><p>没什么好说的, 巴拉巴拉就到了下面</p><h1>0x03 XSS</h1><hr><p>由 form 表单跳转到的企业邮箱页面如下, 加载了 qzoneon.com 这个 URL 下的一段 js</p><p><img alt="" img-src="306d8b3c80c175a5f5c68658ec5557f135838e9e.jpg"></p><p>哎呀, 页面变成这样了, 好糟糕, 看下html代码, 有奇怪的 script 进来了, 这段加载的 js 就是偷取 cookie 发送到攻击者的服务器上。</p><p><img alt="" img-src="6f08e71a624417ff75d0c17f67c2c15d3faf7475.jpg"></p><p>恩, 果不其然, orz, 如果不是同学提前跟我说估计我也上钩了, 以后民那桑打开 QQ 里的东西还是小心点为好 = =</p><p>因知乎上已经出现了详细的漏洞分析：https://www.zhihu.com/question/39019943，故公开此文章。</p><p><img alt="enter image description here" img-src="9ccba034d2667c00e18f2b28af29e094db156982.jpg"></p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/papers/155" rel="bookmark" id="re1">CSRF简单介绍及利用方法</a></li><li><a href="http://drops.wooyun.org/papers/1501" rel="bookmark" id="re2">漏扫工具AWVS命令执行</a></li><li><a href="http://drops.wooyun.org/papers/526" rel="bookmark" id="re3">浏览器安全（一）</a></li><li><a href="http://drops.wooyun.org/papers/7480" rel="bookmark" id="re4">中间人攻击利用框架bettercap测试</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">HackPanda</span> <span class="reply-time">2016-01-19 10:07:22</span></div><p></p><p>已经追踪到</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">smilezino</span> <span class="reply-time">2016-01-04 23:10:21</span></div><p></p><p>这里也有一个反射型的xss</p><p>http://heat.qq.com/location_result.php?date_begin=2015-12-29&amp;date_end=2015-12-30&amp;prov=&amp;city=&amp;region_name=xss</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">朱英达</span> <span class="reply-time">2016-01-02 14:49:00</span></div><p></p><p>这里说的url跳转，其实就是一个反射型xss，属于非持久xss的一种。建议修改下</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">lanyan</span> <span class="reply-time">2016-01-01 22:04:45</span></div><p></p><p>csrf配合xss的典型案例</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">刘海哥</span> <span class="reply-time">2015-12-31 08:51:08</span></div><p></p><p>然而https的qq邮箱。很麻烦！</p><p></p></div></div></div></div></div></main>