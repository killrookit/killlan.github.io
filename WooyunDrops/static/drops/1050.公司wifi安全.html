<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">公司wifi安全</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">Black_Hole</a> <span class="bull">·</span> <time title="2016/02/24 10:11" ui-time="" datetime="2016/02/24 10:11" class="published ng-binding ng-isolate-scope">2016/02/24 10:11</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h1>0x00 前言</h1><hr><p>很多的公司都没有安全团队，只有运维来负责整个公司的安全，从而安全问题也大打折扣。我最近一直在给各个公司做安全检测，就把自己的心得写下来，有什么不足之处还望补充。</p><h1>0x01 无线安全</h1><hr><p>很多的公司都有不怎么注重公司的无线电安全，有钱的公司买设备，没钱的公司搞人力。但是人的技术在好，没有设备的辅助，人力在牛逼也没有个卵用。一个好的路由器、交换机、IDS就像你装备了 无尽、狂徒、杀人书一样的屌。</p><p>很多的公司WIFI认证基本都是WPA/WPA2然后加个WEB二次认证，认为这样就万无一失了，而其实这并没有什么卵用，破解WPA/WPA2，这大家都知道，可以使用aircrack-ng、airmon-ng、airodump-ng、aireplay-ng来实现暴力破解，没有好的密码破解，可以把cap的包发给“549011522”七元一次（<strong>本人没破过，不保证绝对不上当</strong>）。而大家也都知道有一款神奇叫做“wifi万能钥匙”，可以先去看看wifi万能钥匙能不能解，不能解的话再破。连上WIFI后，将会提示你需要进行WEB二次认证。这里你完全可以弃之不理，因为它并没有什么卵用。WEB二次认证说难听了，屁用没有。因为你是WPA/WPA2的认证方式，你连上WIFI之后，交换机就会马上分配给你一个内网IP（我遇到的是交换机，也可能是路由器）一个黑客要你外网干什么，他需要的是公司的内网资源。连不上网对黑客来说没有什么问题。我给某公司做安全检测的时候，万能钥匙破解—中间人嗅探。不到一分钟拿到了他们公司官网后台管理员的权限。WEB认证在我看来不是针对于黑客的，是针对于员工的，因为黑客不需要外网资源，但是员工需要。</p><p>下面是我画的图：</p><p><img alt="p1" img-src="f9df6d0c62c242691dc802836405c0ded2273650.jpg"> 思维导图URL：<a href="https://www.processon.com/view/556d3cd0e4b09c41cc41b26e">https://www.processon.com/view/556d3cd0e4b09c41cc41b26e</a></p><p>黑客连入WIFI后，虽然WEB二次认证不了，但是黑客现在已经处于内网中，他可以访问内网的任何资源。</p><p><strong>修复建议：</strong></p><ol><li>把WPA/WPA2无线认证换成802.1x认证方式（802.1x无线认证方式需要交换机的支持）</li><li>买针对无线检测/防御设备</li><li>无线不能访问内网资源，只有有线可以访问内网资源（从物理上隔绝问题）</li></ol><p>关于802.1x认证方式，他的原理图是下面这样的:</p><p><img alt="p2" img-src="ba4fbd0711a3b250cd5efa5540bccd311a6d111d.jpg"> 思维导图URL：<a href="http://www.processon.com/view/link/556d5c6be4b09c41cc43c0e3">http://www.processon.com/view/link/556d5c6be4b09c41cc43c0e3</a></p><p>黑客即使连上公司WIFI，但是无法通过802.1x认证，导致 公司设备（路由器、交换机）无法分配给你内网IP和外网出口IP的资格。</p><h1>0x02 较为深入无线安全</h1><hr><p>像上面所讲，只是针对公司开放的WIFI进行管理。而上面的三个解决方案，只有第一个相比之下是比较方便还不用花钱的（机房设备需要支持802.1x无线协议，不支持还是要花钱）。</p><p>第二个，公司如果不想花钱是不会选择的，而且买了还要配置，前期工作量特别大。</p><p>第三个，工作量大，需要重新架构公司网络。</p><p>如果公司不想花钱或者运维不想重新架构的话，第一种是很好的选择，但是这里又有一个问题，360/百度随身WIFI，这个东西的存在，对那些本来就不怎么安全的公司更是雪上加霜。360/百度随身WIFI插入公司电脑后，会开启ICS服务，加上自带的无线网卡AP功能。当你连上这个随身WIFI之后，相当于一个小型的局域网。这时我们可以先入侵那个插了随身WIFI的PC电脑，通过它来入侵整个公司。如果你只需要某个接口，则不需要入侵插了随身WIFI的PC电脑。这里假设下“我需要的是这个网站的后台，可是想要登陆这个网站后台，需要出口IP是这个公司的外网IP”这样的话，我们则不需要入侵插了随身WIFI的PC电脑来。为什么呢？我画了一个图，大家看下。</p><p><img alt="p3" img-src="14cf99f7575f7252702ee669830997e0bc95d045.jpg"> 思维导图URL：<a href="https://www.processon.com/view/556d175ee4b0546a904aa2bb">https://www.processon.com/view/556d175ee4b0546a904aa2bb</a></p><p>黑客连入WIFI后，无需进行WEB二次认证，因为它使用的是员工的网络，员工也肯定认证过了，员工使用的是公司内网，内网有个统一的出口IP，而服务器端也只认这个IP，其他IP连不上服务器。</p><p>解决办法，网上很多，可以参考网上的教程。</p><p>如果你又更好的解决方案，可以提出来。我个人的思路有限。有不足之处，还望见谅。</p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/web/13009" rel="bookmark" id="re1">前端防御XSS</a></li><li><a href="http://drops.wooyun.org/news/1401" rel="bookmark" id="re2">WordPress更新至 3.8.2 修复多个漏洞</a></li><li><a href="http://drops.wooyun.org/news/1069" rel="bookmark" id="re3">GOOGLE赶在PWN2OWN之前修复了四个高危漏洞</a></li><li><a href="http://drops.wooyun.org/papers/9979" rel="bookmark" id="re4">Joomla CMS 3.2-3.4.4 SQL注入 漏洞分析</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">xlh</span> <span class="reply-time">2016-03-24 15:35:05</span></div><p></p><p>@Black_Hole 这个可以用桌管系统对桌面下发一些策略杜绝 另外 完善的企业一般是会弄安全区域隔离 只通过WPA认证进入的安全区域权限比较低</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">xlh</span> <span class="reply-time">2016-03-24 15:33:57</span></div><p></p><p>即使公司做过入网验证了，但是一旦360wifi一开，放出的信号相当于是认证后域的信号。所以只要黑客攻破360wifi的密码就能够进行内网漫游了。不知道这方面有没有什么好的解决思路？<br>这个可以用桌管系统对桌面下发一些策略杜绝<br>另外 完善的企业一般是会弄安全区域隔离 只通过WPA认证进入的安全区域权限比较低</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">wattson</span> <span class="reply-time">2016-03-09 02:45:51</span></div><p></p><p>@P0ker_L 无线服务关掉，删除驱动，通过软路由封360WIFI。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">P0ker_L</span> <span class="reply-time">2016-03-02 14:54:29</span></div><p></p><p>即使公司做过入网验证了，但是一旦360wifi一开，放出的信号相当于是认证后域的信号。所以只要黑客攻破360wifi的密码就能够进行内网漫游了。不知道这方面有没有什么好的解决思路？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">游侠客i</span> <span class="reply-time">2016-02-28 19:36:21</span></div><p></p><p>感谢您的论文！虽然对我没有什么用！但对其他的人还是很有用的！！继续努力哈！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">black</span> <span class="reply-time">2016-02-26 17:02:51</span></div><p></p><p>@Black_Hole 一些大学宿舍用的宽带客户端都可以阻止开热点了，认证也是用802.1X的。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">softge</span> <span class="reply-time">2016-02-26 15:51:20</span></div><p></p><p>@miyuhan 我们现在就在用这款ac，效果还可以。就是比较贵而已</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">风格</span> <span class="reply-time">2016-02-26 14:02:43</span></div><p></p><p>在办公区域监测异常wifi信号~</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">miyuhan</span> <span class="reply-time">2016-02-26 10:59:09</span></div><p></p><p>@Black_Hole ,去年测试深信服的一款上网行为管理系统可以监测到员工是否开启热点，还可以阻断，不过这个功能不是很稳定，现在不知道情况怎么样了。。一般公司都会划分vlan，限定mac地址，可以阻止一部分黑客了。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Black_Hole</span> <span class="reply-time">2016-02-25 17:09:08</span></div><p></p><p>@erevus 在我自己认知和朋友的了解中上网行为管理是不行的。可以检测到某一IP地址的出口数据量大，到热点好像是不行的。你是否可以详细说下。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">erevus</span> <span class="reply-time">2016-02-25 16:32:34</span></div><p></p><p>上网行为管理系统可以知道有没有员工私自开热点了 @Black_Hole</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Black_Hole</span> <span class="reply-time">2016-02-25 11:24:24</span></div><p></p><p>@封停 @黑色双刃剑 @Herolon 这里统一说一下。<br>我之前在给某公司(中小型公司，不愿花太多的钱来做安防)做安全检测的时候，使用方法如下:<br>手机连接wifi无法访问内网资源且不在同一网段<br>pc与mac绑定<br>wifi从wpa2升级为802.1x<br>发现员工使用随身wifi罚款200。<br>想要禁止员工使用随身wifi，只能从员工电脑入手。但是有几个难点:<br>不给员工高权限用户（提权最高权限的方法网上都有说）<br>员工携带自己的电脑时，公司是无权对员工电脑进行操作的</p><p>这里还有一个方法就是对整个公司出口数据包的时候对wifi万能钥匙的数据包进行阻拦（via:扬卿）但是随身wifi确实是个难点。因为无法统一做限制。如果有比罚款更好的解决方案欢迎提出来。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">封停</span> <span class="reply-time">2016-02-25 11:12:39</span></div><p></p><p>之前一直想针对伪造AP做点检测，<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="f2164a7f156d571b7361b2b09e939199">[email&#160;protected]</a>_Hole有什么好的思路。（之前想的是搞一个大功率天线，扫描覆盖范围内的AP，获取MAC存数据库，然后和已经注册的AP MAC做比对，不匹配的识别为伪造AP....)</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">黑色双刃剑</span> <span class="reply-time">2016-02-25 10:29:22</span></div><p></p><p>@Black_Hole 如果公司或者企业网络运用准入呢？你肿么办？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">黑色双刃剑</span> <span class="reply-time">2016-02-25 10:28:16</span></div><p></p><p>@Rasiel 谁都不是圣人，作者只是提出一个思路进行讨论~~！<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="51b4f7d3b4c1dd1129293e3e3423">[email&#160;protected]</a> 所说<br>你行你上~~！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">xxooer</span> <span class="reply-time">2016-02-25 10:02:07</span></div><p></p><p>在评论之前请先尊重作者，觉得文章写的水的。你可以自己来写啊</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Herolon</span> <span class="reply-time">2016-02-25 09:33:43</span></div><p></p><p>其实还可以禁止wifi的固定ip访问路由器 禁止访问内网ip</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">xsser_w</span> <span class="reply-time">2016-02-25 02:02:09</span></div><p></p><p>好点企业都有网段划分，也有acl 这种情况一般还是碰不到</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Black_Hole</span> <span class="reply-time">2016-02-24 22:29:59</span></div><p></p><p>@Rasiel 谁说一定要登陆后台？只需要管理员在后台操作就可以拿到cookie，并伪造登陆就行了。麻烦下次先看清在BB</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Rasiel</span> <span class="reply-time">2016-02-24 21:11:54</span></div><p></p><p>万能钥匙破解—中间人嗅探。不到一分钟拿到了他们公司官网后台管理员的权限。<br>嗯。。。人家就在一分钟之内就登录了官网后台，这么巧！你也出来装逼，好巧啊！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">程序猿猪要疯</span> <span class="weibo"></span> <span class="reply-time">2016-02-24 18:26:47</span></div><p></p><p>无尽狂徒杀人书一样的屌是什么屌……</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">学霸</span> <span class="reply-time">2016-02-24 17:41:17</span></div><p></p><p>不错，</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">thanatos</span> <span class="reply-time">2016-02-24 16:42:35</span></div><p></p><p>不知道说啥</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">得到</span> <span class="reply-time">2016-02-24 16:34:32</span></div><p></p><p>短短的</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Tea</span> <span class="reply-time">2016-02-24 15:46:04</span></div><p></p><p>一些公司的Guest用WIFI跟办公网的出口IP是同一个，&quot;而服务器端也只认这个IP，其他IP连不上服务器&quot;，这部分已经成了。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">cnh4ckff</span> <span class="weibo"></span> <span class="reply-time">2016-02-24 14:32:29</span></div><p></p><p>水帘洞</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Black_Hole</span> <span class="reply-time">2016-02-24 12:00:17</span></div><p></p><p>@哦？ 文章都是真对于公司内网资源的说明，外网IP是有些公司的后台地址只认公司外网IP，需要先进入内网，才可以访问后台地址</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">哦？</span> <span class="reply-time">2016-02-24 11:43:19</span></div><p></p><p>要你外网ip干啥！d你啊...</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">真是好文章啊！</span> <span class="reply-time">2016-02-24 11:33:44</span></div><p></p><p>真水</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Black_Hole</span> <span class="reply-time">2016-02-24 11:30:17</span></div><p></p><p>因文章是去年五月份所写，难免有些错误。可能现在已经有更好的方法解决问题。文中没有提出，如果您有更好的思路欢迎提出来:)</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">真水</span> <span class="reply-time">2016-02-24 11:16:31</span></div><p></p><p>真是好文章啊！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">钱塘老娘舅</span> <span class="reply-time">2016-02-24 10:43:02</span></div><p></p><p>讲的很好</p><p></p></div></div></div></div></div></main>