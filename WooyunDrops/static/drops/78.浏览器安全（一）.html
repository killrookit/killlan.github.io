<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">浏览器安全（一）</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">杀戮</a> <span class="bull">·</span> <time title="2013/08/28 15:03" ui-time="" datetime="2013/08/28 15:03" class="published ng-binding ng-isolate-scope">2013/08/28 15:03</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h2>0x00 背景</h2><hr><p>嗯，长短短要求我写一篇关于浏览器安全的文章，所以我出现了，求大神不吐槽，本人渣技术。</p><p>这篇文章很多地方借鉴了黑哥Kcon和于旸hitcon的PPT。</p><h2>0x01 简介</h2><hr><p>如何看待浏览器安全，总之就是战场大小的问题。有多少功能，就有多少攻击面。缓冲区溢出什么的是高富帅的东西，好好当屌丝，别看了。</p><p>什么是功能，比如为了用户体验加上的功能，比如历史记录，浏览器插件，调试器..........比如浏览器本身功能导致的问题，CSS所能达到的伪造，高权限的DOM，地址栏的各种协议等等。</p><h2>0x02 如何学习</h2><hr><p>如何学习这方面的知识，说实在的，浏览器安全比较冷门，别指望有坑货会为这方面写书。只能丢一些链接出来：</p><p><a href="http://code.google.com/p/browsersec/">http://code.google.com/p/browsersec/</a></p><p><a href="http://www.unicode.org/reports/tr36/">http://www.unicode.org/reports/tr36/</a></p><p><a href="http://ha.ckers.org/weird/">http://ha.ckers.org/weird/</a></p><p><a href="http://kotowicz.net/absolute/">http://kotowicz.net/absolute/</a></p><p>主要的还是看自己的猥琐程度，只要能达到看见妹纸能往XSS方面联想那你就无往不利了。</p><h2>0x03 基础</h2><hr><h3>攻击面：</h3><h4>浏览器本身</h4><p>危险的DOM操作SUCH AS <a target="_blank" href="http://www.wooyun.org/bugs/wooyun-2013-022437">WooYun: 关于IE页面欺骗漏洞</a></p><p>CSS 的伪造 SUCH AS 通过CSS伪装状态栏等。。</p><p>地址栏的协议 SUCH AS <a target="_blank" href="http://www.wooyun.org/bugs/wooyun-2013-016895">WooYun: Safari location污染漏洞</a></p><h4>扩展功能</h4><p>插件安全 SUCH AS <a target="_blank" href="http://www.wooyun.org/bugs/wooyun-2013-022263">WooYun: 傲游浏览器本地域突破（浏览器插件风险）</a></p><p>历史记录 SUCH AS <a target="_blank" href="http://www.wooyun.org/bugs/wooyun-2013-028185">WooYun: 猎豹浏览器存储xss(本地域权限)</a></p><p>扩展功能 等等....................</p><h3>漏洞利用</h3><h4>命令执行：</h4><p>特权API : <a target="_blank" href="http://www.wooyun.org/bugs/wooyun-2010-020">WooYun: 360安全浏览器远程代码执行漏洞</a></p><p>缓冲区溢出: <a href="http://www.2cto.com/Article/201308/238149.html">http://www.2cto.com/Article/201308/238149.html</a> 充数的 不要在意</p><h4>信息探测：</h4><p>探测历史记录</p><p>本地文件</p><h2>0x04 找到奶糖</h2><hr><p>浏览器的本质是为了方便用户浏览网页，所以我们的攻击代码最终都是存在与网页上的，我们要攻击一个浏览器，要看浏览器如何处理我们的代码，火狐的firebug曾经爆出过浏览器命令执行， 漏洞的成因就是firebug提取网页内容时过滤不严谨，导致可以在特权区域调用特权API执行代码。</p><p>Such As : Chrome</p><p>我们先确定一个突破点，我们把注意力放在谷歌插件上。</p><p>我们确定一个插件，我们已经发现它对网页内容进行提取。</p><p><img alt="2013082701211476111.jpg" img-src="7dd78f741bee80609eb62cab86ef219fee519780.jpg"></p><p>插件提取了 title 和 Url 我们构造一个页面</p><p>POC:</p><pre><code>#!html
"&gt;&lt;iframe src=http://drops.wooyun.org &gt;&lt;/iframe&gt;&lt;a
</code></pre><p><img alt="enter image description here" img-src="4edc0a8c437918591442dff632171a5648c31383.jpg"></p><p>很早的时候谷歌就意识到了插件的安全问题并且加了防范，所以在这个特权区域执行js比较困难。这里只是打个比方，说明下浏览器处理网页内容造成的危害。</p><p>比如历史记录造成的问题。</p><p>Such As: 360浏览器</p><p>输入网址</p><pre><code>http://hao.360.cn/#"&gt;&lt;script&gt;alert(document.domain);&lt;/script&gt;
</code></pre><p>查看历史记录</p><p><img alt="enter image description here" img-src="a4346d1a941cd4acf552ef98f10a47102a9c072c.jpg"></p><p>同样也是对网页内容的抓取，同时还有很多地方存在安全问题，比如调试器。</p><p><img alt="enter image description here" img-src="ced369e715382b6310cf126813aa84085bd98796.jpg"></p><p>哥几个高抬贵手啊，我这个还有点用，就不说内容了。</p><h2>0x05 奶糖和琥珀</h2><hr><p>如何找到漏洞，要注意的是注意浏览器中的每一个点。</p><p>一般命令执行的方式</p><pre><code>确定特权域 --&gt; 寻找特权域的XSS --&gt; 查看可调用的API --&gt; 编写 exp --&gt; 攻击
</code></pre><p>这个流程我们来走一遍</p><p>打个比方说，我们要攻击傲游浏览器。</p><p>确定特权域</p><p><img alt="enter image description here" img-src="f174c2ef1d099523c519f332bf4dcc74dc392dfb.jpg"></p><p>这是一个傲游的特权区域，我们先确定这个页面对网页进行怎么样的抓取。</p><p><img alt="enter image description here" img-src="34e6e6163cc9c4e0daa3b76e7dfe844c9d2664b9.jpg"></p><p>我们点一下 加号 可以看到这些 ，我们可以判定 它对我们经常访问的title进行了提取。</p><p>假设它并没有对title进行过滤。我们构造网页</p><p>POC:</p><pre><code>#!html
&lt;title&gt;&lt;script&gt;alert(document.domain);&lt;/script&gt;&lt;/title&gt;
</code></pre><p><img alt="enter image description here" img-src="4aad51104e7f0cde606962a482679f3440b820bc.jpg"></p><p>现在我们简单查看下有什么高权限的API可以调用。</p><p><img alt="enter image description here" img-src="ed0dd97c85a7773c6103a0c2c3f2be02c0f22512.jpg"></p><p>通过审查这些API我们可以抽取出高权限的API来进行攻击。</p><h2>0x06 有过的漏洞？</h2><hr><p>– CVE-2002-0189</p><p>– CVE-2002-1187</p><p>– CVE-2002-1688</p><p>– CVE-2003-1328(MS03-004)</p><p>– CVE-2005-0054(MS05-014)</p><p>– CVE-2006-3643(MS06-044)</p><h2>0x07 结尾</h2><hr><p>嗯。。。。其实还有一些要点，第二篇再说吧，好累 睡觉去了，改天我要捅死短短。</p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/papers/146" rel="bookmark" id="re1">Browser Security-基本概念</a></li><li><a href="http://drops.wooyun.org/tips/147" rel="bookmark" id="re2">Browser Security-超文本标记语言（HTML）</a></li><li><a href="http://drops.wooyun.org/tips/150" rel="bookmark" id="re3">Browser Security-css、javascript</a></li><li><a href="http://drops.wooyun.org/tips/151" rel="bookmark" id="re4">Browser Security-同源策略、伪URL的域</a></li><li><a href="http://drops.wooyun.org/tips/188" rel="bookmark" id="re5">详解XMLHttpRequest的跨域资源共享</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">vaf</span> <span class="reply-time">2015-04-05 16:40:01</span></div><p></p><p>大哥，你现在还在红黑联盟当讲师么？想参加一次实地培训，无奈PKAv的已经停了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">泳少</span> <span class="reply-time">2014-11-12 00:18:25</span></div><p></p><p>为啥有个错误这么久没改？firefox里面有个插件叫firbug而不是firebug么？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">灰色轨迹</span> <span class="reply-time">2013-11-20 17:53:07</span></div><p></p><p>戮了戮了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">心伤的胖子</span> <span class="reply-time">2013-09-04 14:58:30</span></div><p></p><p>能够把 wooyun 上各种浏览器漏洞总结一份，应该可以作为浏览器安全的教材了。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Evi1m0</span> <span class="reply-time">2013-09-02 23:09:42</span></div><p></p><p>黑哥的议题真像。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">xsser</span> <span class="reply-time">2013-08-29 14:30:03</span></div><p></p><p>其实的确最后攻击都是以数据为核心的</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">xsser</span> <span class="reply-time">2013-08-29 14:26:09</span></div><p></p><p><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="35d3a9bcd18d9f75d0a1a5d0858dd18dbcd3a4b3d3bcbe">[email&#160;protected]</a> 的案例不错啊</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">瞌睡龙</span> <span class="reply-time">2013-08-29 00:45:03</span></div><p></p><p>哈~已修正</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">猪猪侠</span> <span class="reply-time">2013-08-28 19:53:29</span></div><p></p><p>tk的名字写错了 于旸 不是于汤</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Crackkay</span> <span class="reply-time">2013-08-28 16:37:05</span></div><p></p><p>戳。。使劲戳！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">园长</span> <span class="reply-time">2013-08-28 15:53:31</span></div><p></p><p>看了黑哥的PPT里面有讲，YY下。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">园长</span> <span class="reply-time">2013-08-28 15:52:41</span></div><p></p><p>戮了戮了</p><p></p></div></div></div></div></div></main>