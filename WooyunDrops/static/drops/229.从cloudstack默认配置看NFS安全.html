<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">从cloudstack默认配置看NFS安全</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">霍大然</a> <span class="bull">·</span> <time title="2014/04/24 11:52" ui-time="" datetime="2014/04/24 11:52" class="published ng-binding ng-isolate-scope">2014/04/24 11:52</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><p>看到有同学写了关于<a href="http://drops.wooyun.org/tips/1423">NFS的运维安全</a>，本菜鸟以cloudstack为例也写下关于NFS访问控制安全吧。</p><h2>0x00 NFS默认配置缺陷</h2><hr><p>在Cloudstack云平台部署时，按照apache官方的安装文档，如果又不对管理网络进行隔离会导致整个云环境中的虚拟机处于危险状态：</p><p><img alt="2014042411404387958.jpg" img-src="f0225e7191792c699301a90de5462d147d27bc74.jpg"></p><p><a href="http://cloudstack.apache.org/docs/zh-CN/Apache_CloudStack/4.1.1/html/Installation_Guide/management-server-install-flow.html#prepare-nfs-share">http://cloudstack.apache.org/docs/zh-CN/Apache_CloudStack/4.1.1/html/Installation_Guide/management-server-install-flow.html#prepare-nfs-share</a></p><p>1.     配置新的路径作为 NFS 引入, 编辑<code>/etc/exports</code>。引入NFS 共享用<code>rw,async,no_root_squash</code>。例如：</p><pre><code>#!bash
#vi /etc/exports
</code></pre><p>插入下列行。</p><pre><code>/export *(rw,async,no_root_squash)
</code></pre><p>看到如上的配置exports文件，小伙伴们震惊了吧，任意用户可以读取与写入文件，该配置是对整个云环境的存储做的配置，也就意味着任意能够访问到该IP的用户都可控制整个云系统。</p><h2>0x01 攻击权限配置不当的NFS系统</h2><hr><p>只要在云环境中的任意一台主机进行查看：</p><p><img alt="2014042411412586267.jpg" img-src="f7f02a6eb1117447b0fd075ae9105fd22ba0b573.jpg"></p><p>然后进行mount 该文件夹，可以任意操作该存储上的虚拟机：</p><p><img alt="2014042411420188380.jpg" img-src="833573cf3a6488c2e9262e74d7ab2506d326088f.jpg"></p><h2>0x02 漏洞修复</h2><hr><p>还是<code>/etc/exports</code>下的文件，如果配置成如下模式则可减少风险（我说的仅仅是减少）：</p><pre><code>/export 172.19.104.6(rw,async,no_root_squash)
</code></pre><p>这样就把访问控制给了单独的IP，但这样是不是就安全了，小伙伴们可以继续想伪造IP的办法来绕过了。</p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/tips/8659" rel="bookmark" id="re1">NFS配置不当那些事</a></li><li><a href="http://drops.wooyun.org/tips/352" rel="bookmark" id="re2">SVN安装配置及安全注意事项</a></li><li><a href="http://drops.wooyun.org/tips/2014" rel="bookmark" id="re3">批量网站DNS区域传送漏洞检测——bash shell实现</a></li><li><a href="http://drops.wooyun.org/tips/1354" rel="bookmark" id="re4">DNS泛解析与内容投毒，XSS漏洞以及证书验证的那些事</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">wsg00d</span> <span class="reply-time">2015-07-28 16:35:55</span></div><p></p><p>项目中遇到个问题，求各位大神教，最后那里的伪造ip怎么弄？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">小贱人</span> <span class="reply-time">2014-05-28 21:59:09</span></div><p></p><p>已阅</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Hxai11</span> <span class="reply-time">2014-05-13 20:10:50</span></div><p></p><p>其实总觉得在nfs上出现漏洞太不应该了。。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">霍大然</span> <span class="reply-time">2014-04-29 10:22:34</span></div><p></p><p>cloudstack用户只能用public IP，不会用节点的IP。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">2020human</span> <span class="reply-time">2014-04-28 20:12:32</span></div><p></p><p>你的配置防御在cloudstack根本是不行的，NFS是所有cloudstack的节点都可能会去挂载的。能做的是使用iptables控制访问。或者使用/etc/hosts.allow 和/etc/hosts.deny 做访问控制。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Mody</span> <span class="reply-time">2014-04-27 20:58:51</span></div><p></p><p>mark</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">ss</span> <span class="reply-time">2014-04-26 13:10:08</span></div><p></p><p>算啊</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">xsser</span> <span class="reply-time">2014-04-24 14:08:46</span></div><p></p><p>折算漏洞吧</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">小胖子</span> <span class="reply-time">2014-04-24 12:52:43</span></div><p></p><p>已撸。</p><p></p></div></div></div></div></div></main>