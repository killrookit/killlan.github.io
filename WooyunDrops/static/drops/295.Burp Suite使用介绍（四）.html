<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">Burp Suite使用介绍（四）</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">小乐天</a> <span class="bull">·</span> <time title="2014/07/07 12:05" ui-time="" datetime="2014/07/07 12:05" class="published ng-binding ng-isolate-scope">2014/07/07 12:05</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h2>0x00 Intruder Scan</h2><hr><p>发送一个你想csrf_token的请求到intruder。</p><h3>1)Positions设置如下：</h3><p><img alt="enter image description here" img-src="3d4dda9da208fa1e8161c3c1fcf830004a29372e.jpg"></p><h3>2)Options设置如下：</h3><pre><code>Request Engine
</code></pre><p><img alt="enter image description here" img-src="c5f4284a5f6214179525ed077545b7a703f73115.jpg"></p><pre><code>options&gt;Grep-Extract&gt;add
</code></pre><p><img alt="enter image description here" img-src="68d52ec878ddc07cbd8b1475b7d023e19cb639f1.jpg"></p><p><img alt="enter image description here" img-src="b79ef610c20992fe44719dbad019ea553945bd8e.jpg"></p><h3>3)payloads设置如下</h3><p><img alt="enter image description here" img-src="cd26b88235744f47249c745de919c217726aaede.jpg"></p><p>这里payload type设置递归(Recursive grep)，在Initial payload for first request设置一个有效的csrf_token值作为第一项</p><p><img alt="enter image description here" img-src="da3ad63151f959bde0e60b7153ba98eb5430cea2.jpg"></p><h2>0x01 Active Scan with sqlmap</h2><hr><p>其实这个结合sqlmap有两种方法，<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="4ea9caf8abdec0a6f9d10e2d7a2c2c2f292ba6e0e6a6e0f4aaf4c8aaf6c5">[email&#160;protected]</a>,我采用的也是他那个代码，但是在注入的时候我发现在burpsuite里查看HTTP history(历史记录)里的token是没有变化的，但是还是可以注入，刚开始挺纳闷的，我以为他写的那个代码有问题，后来他说不是，在burpsuite里是看不到的，然后我也同意他说的，就是替换这个过程直接经过宏功能替换了，不会显示在历史记录里。我这里就说下第二种方法吧。第一种点这里。</p><h3>1)首先是登录csrf_token页面，不需要拦截。然后选择Options>Sessions>Add</h3><p><img alt="enter image description here" img-src="f830fc13ef11602946b679af47ad31d3ff718de1.jpg"></p><p><img alt="enter image description here" img-src="3b5acbe48de4f597d03dadf68e07f93c865ec608.jpg"></p><h3>2)接着会弹出一个窗口选择Select macro>add</h3><p><img alt="enter image description here" img-src="459c8cabd48c6d042e03148e72a72f7809786fde.jpg"></p><h3>3)点击add後会弹出两个页面如图所示：</h3><p><img alt="enter image description here" img-src="cd7d0e96b9ed6f69c596a51446925a03189bcd72.jpg"></p><h3>4)选择2-3个页面，第一个页面是请求页面，第二个页面是post数据的时候的页面，为了便于查看我这里添加了3个页面。</h3><p><img alt="enter image description here" img-src="f2fad08beb9cb55e992c232505dd7cbe208a9915.jpg"></p><h3>5)选择第二个页面点击Configure item，指定root，添加一个自定义token参数</h3><p><img alt="enter image description here" img-src="734ee47daa0143839c7e0d89487c626461c4e9e5.jpg"></p><p><img alt="enter image description here" img-src="f75a2fbd3aa30c7e7767b275da3c9e0c5c31ad79.jpg"></p><h3>6)最后配置完可以点击Test macro看看我们配置成功了没</h3><p><img alt="enter image description here" img-src="99f1c761d96cae65aae4c5e856406bacdd814a8d.jpg"></p><p><img alt="enter image description here" img-src="77fec226b3dc494fad70f83163f7346d1eda77ed.jpg"></p><h3>7)如果以上配置成功，再选择Scope选择应用范围</h3><p><img alt="enter image description here" img-src="746f7a63378392d1af5ae289b65b939327d6a0fb.jpg"></p><p><img alt="enter image description here" img-src="8bea8e2441ec05608287a9157d97e52c107e810c.jpg"></p><h3>8)接着就是放到sqlmap里去跑数据咯</h3><p>如果是post页面，这里是把post的数据保存到request.txt文件里，然后运行命令如下：</p><pre><code>./sqlmap.py -r request.txt –proxy=http://127.0.0.1:8080
</code></pre><p>如果是get页面命令如下：</p><pre><code>./sqlmap.py –u “www.target.com/vuln.php?id=1” –proxy=http://127.0.0.1:8080
</code></pre><p><img alt="enter image description here" img-src="54f9e35f9c368195b35bad47a21b4954ada08bec.jpg"></p><h2>0x02 Session Randomness Analysis Sequencer</h2><hr><p>请求拦截一个地址，在响应内容中如果有cookie，或者我们可以在sequencer中自定义配置token参数</p><p><img alt="enter image description here" img-src="cc583ae705419f84d4aa1e6ae56960c5373b772d.jpg"></p><p><img alt="enter image description here" img-src="f66e6ee0122c98ebee5b48976e95df0c0f29c5d5.jpg"></p><p>然后点击Start live capture进行分析</p><p><img alt="enter image description here" img-src="a04e50359b4d19f38f59c47e4b2348b9f111706d.jpg"></p><p>等分析完即可生成报告，通过报告我们可以看出token是否可以伪造。</p><p>参考资料：http://resources.infosecinstitute.com/session-randomness-analysis-burp-suite-sequencer/</p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/tools/1629" rel="bookmark" id="re1">Burp Suite使用介绍（二）</a></li><li><a href="http://drops.wooyun.org/tips/2247" rel="bookmark" id="re2">Burp Suite使用介绍（三）</a></li><li><a href="http://drops.wooyun.org/tools/1548" rel="bookmark" id="re3">Burp Suite使用介绍（一）</a></li><li><a href="http://drops.wooyun.org/tips/6653" rel="bookmark" id="re4">使用sqlmapapi.py批量化扫描实践</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">yuan88k</span> <span class="reply-time">2016-04-15 14:16:50</span></div><p></p><p>@小乐天 真的很感激楼主，最近正在学习burp的使用，找了很多资料都找疯了，今天找到这，大家都是很感谢你的分享的，不用为了几个人黑而放弃我们这些支持你的人，再次感谢</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">yuan88k</span> <span class="reply-time">2016-04-15 14:13:20</span></div><p></p><p>真的没想到在这能找到这么详细的教程，网上搜了很多都差多了，非常感谢楼主的贡献</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">yeah_go</span> <span class="reply-time">2016-02-25 18:39:56</span></div><p></p><p>mark</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">废废</span> <span class="reply-time">2016-01-21 19:40:23</span></div><p></p><p>你的每一步操作我都会认真看，背单词，没有熟练到炉火存青的地步是写不出来的。这真是堪称经典教材，比有些老师都厉害~~~~~在你累的时候，想想还会有更多的人看到它，即使在多年以后，是不是很哈皮呀~~~~~~~加油哈，你们的分享，带动下一代白帽子迅速的成长，赶超USA~~~~~~额，有点太激动。。。。。哈哈</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">小菜果子</span> <span class="reply-time">2015-01-12 09:49:11</span></div><p></p><p>牛b</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">看风者</span> <span class="reply-time">2014-08-20 15:46:10</span></div><p></p><p>支持lz，看了很有感触</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">安然失夏</span> <span class="reply-time">2014-08-11 07:45:47</span></div><p></p><p>求下载地址</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">yinian</span> <span class="reply-time">2014-07-15 17:02:40</span></div><p></p><p>好强大的burp</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">TT向上</span> <span class="reply-time">2014-07-14 15:29:13</span></div><p></p><p>期待下一部教程</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">瞌睡龙</span> <span class="reply-time">2014-07-12 00:28:17</span></div><p></p><p>@px1624 小伙伴不能这么想哦，楼主都是对之前的补充，并且内容不错。你如果投稿一个系列的文章分开投，单篇内容只要过关，分几次都没关系。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">小乐天</span> <span class="reply-time">2014-07-11 18:11:31</span></div><p></p><p>如果你们都这么想的话那我看以后没必要再写了，没意思</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">小乐天</span> <span class="reply-time">2014-07-11 18:08:58</span></div><p></p><p>我没那么想，这些都是后面大伙遇到的问题，然后总结出来的，因为有的时候自己没遇到，然后小伙伴遇到了问题，就问我，然后我各种收集资料整理出来的，所以我希望大伙遇到了问题欢迎各种讨论沟通，这样才能更完善</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">从容</span> <span class="reply-time">2014-07-11 00:01:38</span></div><p></p><p>为了这些wb也是很不容易的...</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">px1624</span> <span class="reply-time">2014-07-10 16:37:00</span></div><p></p><p>楼主真淫荡，一个文章分4次发，10WB变成40WB了！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">阿萨帝</span> <span class="reply-time">2014-07-09 13:47:56</span></div><p></p><p>希望能继续写burp内容，对我们很有用。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">帅克笛枫</span> <span class="reply-time">2014-07-08 14:33:46</span></div><p></p><p>近日在学习burp，有空帮忙指导下。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">x1aoh4i</span> <span class="reply-time">2014-07-08 08:29:59</span></div><p></p><p>顶一下</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">小乐天</span> <span class="reply-time">2014-07-07 22:06:11</span></div><p></p><p>没看懂，你照着做一遍，代码是用的之前那个csrf_token的，然后方法不同，我这里提供两种方法给大伙用，而且简单，针对每次请求是需要token的解决办法</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">JJFly</span> <span class="reply-time">2014-07-07 16:09:48</span></div><p></p><p>霸气测漏。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">wangy3e</span> <span class="reply-time">2014-07-07 14:16:22</span></div><p></p><p>呵呵,这些食用方法</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">depycode</span> <span class="reply-time">2014-07-07 13:01:32</span></div><p></p><p>真是霸气 不过没看太懂！！！burpsuite 功能真心多，各种姿势</p><p></p></div></div></div></div></div></main>