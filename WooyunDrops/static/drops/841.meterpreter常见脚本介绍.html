<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">meterpreter常见脚本介绍</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">君莫笑</a> <span class="bull">·</span> <time title="2015/10/21 10:18" ui-time="" datetime="2015/10/21 10:18" class="published ng-binding ng-isolate-scope">2015/10/21 10:18</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h1>0x00 前言</h1><hr><p>在获得meterpreter的session后，除了meterpreter本身内置的一些基本功能，在<code>/usr/share/metasploit-framework/scripts/</code>meterpreter下面还有很多scripts，提供了很多额外功能，非常好用</p><p>我看网上没有详细介绍常见脚本功能的文章,就总结了一下</p><p>我们可以通过<code>run 脚本名</code>来进行使用</p><p><code>run 脚本名 -h</code>可以查看帮助</p><h1>0x01 常见脚本</h1><hr><h2>1 arp_scanner</h2><p>利用arp进行存活主机扫描</p><p><img alt="" img-src="ce55c9dbf45477aab87204358981a76386ae912a.jpg"></p><h2>2 autoroute</h2><p>可以添加，删除，显示路由表</p><h2>3 checkvm</h2><p>可以检测目标是否是虚拟机</p><p><img alt="" img-src="91580b83759fe33c4d79490ca5d72200ce081639.jpg"></p><h2>4 credcollect</h2><p>收集目标主机上的hash等凭证</p><p><img alt="" img-src="4bf279a910a6866a3d9d7f4767e4e1b6a12bf7df.jpg"></p><h2>5 domain&#95;list&#95;gen</h2><p>获取域管理账户列表，并判断当前session所在用户是否在列表中</p><h2>6 dumplinks</h2><p>Link文件包含时间戳，文件位置，共享名，卷序列号，等。脚本会在用户目录和office目录中收集lnk文件</p><p><img alt="" img-src="93cde2996ce8ed5a41e97dbdb6212c5f560a91f9.jpg"></p><h2>7 duplicate</h2><p>再次产生payload，注入到其他进程或打开新进程并注入其中</p><p><img alt="" img-src="495d00f0c4f66b2451fa63b39f40930467fe96d3.jpg"></p><p><img alt="" img-src="0f2639a9ba9ce86062b5b98d80efd166a80a67be.jpg"></p><h2>8 enum_chrome</h2><p>获取chrome中的信息</p><h2>9 enum_firefox</h2><p>获取firefox中的信息，包括cooikie，历史纪录，书签等</p><p><img alt="" img-src="e4e44b1d3124970577c56457ce7b16d7a036cdbd.jpg"></p><p><img alt="" img-src="32d9db01742ccd1b2562ac817fc93183277ac595.jpg"></p><h2>10 enum&#95;logged&#95;on_users</h2><p>列出当前登录的用户</p><h2>11 enum&#95;powershell&#95;env</h2><p>列出powershell和WSH的配置文件</p><h2>12 enum_putty</h2><p>列出putty的配置文件</p><h2>13 enum_shares</h2><p>列出共享及历史共享</p><h2>14 enum_vmware</h2><p>列出vmware的配置文件和产品</p><h2>15 event_manager</h2><p>可以查询和清理事件日志</p><p><img alt="" img-src="40b8272996b7bc5f125c7f608a454cc24ab9798c.jpg"></p><h2>16 file_collector</h2><p>搜索符合指定模式的文件</p><h2>17 get&#95;application&#95;list</h2><p>获取安装的程序列表及版本</p><p><img alt="" img-src="bf27a136273aca7737747c50d8e00b440d45f004.jpg"></p><h2>18 getcountermeasure</h2><p>列出HIPS 和 AV 的进程，显示XP 防火墙规则, 并且显示 DEP和UAC 策略</p><p>Ps：-k参数可以杀掉防护软件进程</p><p><img alt="" img-src="a1537275c8f3cd80a5dbfeeed67c9889cad07a5a.jpg"></p><h2>19 get_env</h2><p>获取所有用户的环境变量</p><h2>20 get&#95;filezilla&#95;creds</h2><p>获取filezilla的登陆凭证</p><h2>21 getgui</h2><p>可以很方便的开启远程桌面服务，添加用户，端口转发功能</p><p><img alt="" img-src="f5c17b725b8cdd877c17410a4de27b7334646e85.jpg"></p><p><img alt="" img-src="db30f56fe7ca2e494b5b4983fd52fbd16687d849.jpg"></p><p><img alt="" img-src="32c6004517670209adb2dc48be034c60905ba9d6.jpg"></p><p><img alt="" img-src="ec917f3f91b495cc980b706aadc4271667ddf101.jpg"></p><p><img alt="" img-src="b61b7985682bd8a40135218785429ee84e5ff039.jpg"></p><h2>22 get&#95;local&#95;subnets</h2><p>获得本地的子网</p><h2>23 get&#95;pidgin&#95;creds</h2><p>获取pidgin配置文件中的用户名和密码</p><h2>24 gettelnet</h2><p>同之前开启终端桌面服务的脚本，这个是用来开启telnet的</p><h2>25 get&#95;valid&#95;community</h2><p>获取SNMP community字符串</p><h2>26 getvncpw</h2><p>获取vnc密码</p><h2>27 hashdump</h2><p>同meterpreter的内置功能</p><h2>28 hostsedit</h2><p>操作hosts文件</p><h2>29 keylogrecorder</h2><p>Meterpreter内置此功能</p><h2>30 killav</h2><p>关闭防护软件</p><h2>31 metsvc</h2><p>将payload安装为服务</p><h2>32 migrate</h2><p>同内置功能，用于迁移进程</p><h2>33 persistence</h2><p>可见建立一个持久性的后门，设置成开机启动</p><h2>34 service&#95;permissions&#95;escalate</h2><p>许多服务被配置了不安全 的权限。 这个脚本会尝试创建一个服务, 然后会搜索已存在d服务，找到不安全的文件或配置有问题的文件，用一个payload替换掉他，然后会尝试重启服务来运行这个paylaod，如果重启服务失败，则在下次服务器重启时会执行payload</p><h2>35 vnc</h2><p>可以看到远程桌面</p><h2>36 win32-sshserver</h2><p>安装openssh服务</p><h2>37 winenum</h2><p>会自动运行多种命令，将命令结果保存到本地</p><p><img alt="" img-src="cc0bff0893ce7c17d4f64e08581bc649c3ff4431.jpg"></p><p><img alt="" img-src="9d2e67cf65fb89680ff1d88f527120890f33ca69.jpg"></p><p>Ps：这些脚本最好的地方在于有源码可看，可以根据环境进行修改，如何运用就看各人了</p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div id="donate" style="padding:10px;border-top:1px solid #d9d9d9;text-align:center"><span>碎银子打赏，作者好攒钱娶媳妇：</span><br><br><img src="http://static.wooyun.org/wooyun/upload/donate/20141225164032387e6753d7744bf9c1c9b81a2982f65c.jpg" style="width:200px;height:200px"></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/tips/2227" rel="bookmark" id="re1">metasploit 渗透测试笔记(meterpreter篇)</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">scanf</span> <span class="reply-time">2015-10-23 18:04:37</span></div><p></p><p>棹牛 膝盖收下吧</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">sucer</span> <span class="reply-time">2015-10-22 01:45:14</span></div><p></p><p>学弟！膝盖！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">mosin</span> <span class="reply-time">2015-10-22 01:02:19</span></div><p></p><p>学弟，膝盖！！！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Croxy</span> <span class="reply-time">2015-10-21 19:25:40</span></div><p></p><p>膝盖一软 Orz</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">′ 雨。</span> <span class="reply-time">2015-10-21 18:24:46</span></div><p></p><p>桌牛。。 给大牛跪了。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">hear7v</span> <span class="reply-time">2015-10-21 14:26:27</span></div><p></p><p>卓爷爷，膝盖</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">0CC</span> <span class="reply-time">2015-10-21 14:09:21</span></div><p></p><p>....我不能评论 还是有 和谐字？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Rainism</span> <span class="reply-time">2015-10-21 11:14:30</span></div><p></p><p>学弟，膝盖！！！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">0xfa</span> <span class="reply-time">2015-10-21 10:56:46</span></div><p></p><p>0xfa某成员前来膜拜</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">shushu</span> <span class="reply-time">2015-10-21 10:55:06</span></div><p></p><p>学弟，膝盖！！！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Purpleroc</span> <span class="reply-time">2015-10-21 10:53:57</span></div><p></p><p>学弟，膝盖！！！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">RickGray</span> <span class="reply-time">2015-10-21 10:51:43</span></div><p></p><p>学弟，膝盖！！</p><p></p></div></div></div></div></div></main>