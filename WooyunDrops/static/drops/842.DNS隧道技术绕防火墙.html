<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">DNS隧道技术绕防火墙</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">Blood_Zero</a> <span class="bull">·</span> <time title="2015/10/22 10:20" ui-time="" datetime="2015/10/22 10:20" class="published ng-binding ng-isolate-scope">2015/10/22 10:20</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h1>0x01 概念</h1><hr><p>隧道技术（Tunneling）是一种通过使用互联网络的基础设施在网络之间传递数据的方式。使用隧道传递的数据（或负载）可以是不同协议的数据帧或包。隧道协议将其它协议的数据帧或包重新封装然后通过隧道发送。新的帧头提供路由信息，以便通过互联网传递被封装的负载数据。</p><h1>0x02 实例分析- DNS隧道技术</h1><hr><p>环境：客户机（Kali）+DNS服务器（window2003）+目标机（redhat7）</p><h2>DNS服务器：192.168.10.132</h2><p>1、新建一个名字为”bloodzero.com”的正向解析域</p><p><img alt="" img-src="dc4c5b134893c1ecc7e7e3567d2e6c179f7c4be0.jpg"></p><p>2、新建一个主机：IP为攻击者kali的IP</p><p><img alt="" img-src="96168bd36aa8461bd9ec1b6af3608897c3d4da2d.jpg"></p><p>3、新建一个委托</p><p><img alt="" img-src="eb92d4b93d8e80810528c208f182007864d2a094.jpg"></p><p>此时我们的DNS服务器就配置好了！</p><h2>Kali：攻击者&amp;&amp;客户端 192.168.10.135</h2><p>1、攻击端配置：</p><p>修改dns2tcpd配置文件：</p><p><img alt="" img-src="a38873da6203ee0cca090485ccd287f27540db09.jpg"></p><p>resources的IP为目标机的IP</p><p><img alt="" img-src="2e7402f4a50eb926122ba36f7fb2a4e1604a5f37.jpg"></p><p>启动dns隧道的服务端</p><p><img alt="" img-src="8a0f92bd5c11fe9cf8ee8ae5c46ff9e26e2621da.jpg"></p><p>2、客户端配置</p><p>删除ssh连接的known_hosts文件</p><p><img alt="" img-src="6382a7e999c30c5c2c5883d062677ab487c9416e.jpg"></p><p>修改DNS解析文件:<code>vim /etc/resolv.conf</code></p><p><img alt="" img-src="ba9361646fb29fab6e4a94f4351e87585a55829c.jpg"></p><p><img alt="" img-src="1df490726b0f60ff8b931ea8bf76dbdb59b68252.jpg"></p><p><img alt="" img-src="d4704e855afb07945d5fbedc9489d160187e5828.jpg"></p><p>配置dns隧道客户端程序</p><p>在kali2.0中，没有配置文件，需要自己写配置文件</p><p><code>vim /etc/dns2tcpc.conf</code></p><p><img alt="" img-src="29adee429973fcffdf94811d6d294e8be56409fd.jpg"></p><p>测试是否可以提供服务</p><p><img alt="" img-src="88da3fc5ab965b60f162792435b231e473a6cd74.jpg"></p><p>这个时候我们就已经配置成功了！</p><h2>成功效果</h2><p><img alt="" img-src="44c391c3a799af1b0124bf31e4c63cb8b5242d07.jpg"></p><p><img alt="" img-src="2bd96043c9897d767133cfaa7d625051471d8c83.jpg"></p><p><img alt="" img-src="5eb3a73ff84d8c6e04ad376a0837978c14a342b4.jpg"></p><h1>0x03 分析结论</h1><hr><p>这个时候的流量走向：</p><p><img alt="" img-src="cc6e03abbb8376b3fc54efdaf15a21b592a2e9b0.jpg"></p><p>本文中介绍的是DNS隧道服务器，和DNS隧道客户端是同一台机器，并不能说明问题，当DNS隧道服务器存在于防火墙之后，这个时候我们就可以利用此种技术来绕过大部分的防火墙。并且可绕过不开端口，隐蔽性好等；</p><p><img alt="" img-src="3af0f767214d04b8fbd8a532d8f616575de92201.jpg"></p><p>这里我使用另外一台客户机去连接目标机时，服务端监听的数据如下：</p><ul><li>目标机：192.168.10.133</li><li>DNS隧道服务端：192.168.10.135</li><li>DNS隧道客户端：192.168.10.134</li><li>DNS服务器：192.168.10.132</li></ul><p><img alt="" img-src="3f3018145586d6f1e30a5688f387f15560d907ca.jpg"></p><p>客户端监听数据如下：</p><p><img alt="" img-src="9b534f58f4697c3ad5ea691f61114814df7664c5.jpg"></p><p>发现能够监听到的ssh数据包是DNS隧道服务端与目标机之间的通信；</p><p>而客户端与目标机之间的通信是DNS数据；</p><p>这就是简单的配置DNS隧道；</p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/tips/9947" rel="bookmark" id="re1">Javascript缓存投毒学习与实战</a></li><li><a href="http://drops.wooyun.org/tips/5253" rel="bookmark" id="re2">劫持SSH会话注入端口转发</a></li><li><a href="http://drops.wooyun.org/tips/11367" rel="bookmark" id="re3">Cuckoo恶意软件自动化分析平台搭建</a></li><li><a href="http://drops.wooyun.org/tips/2866" rel="bookmark" id="re4">lnmp虚拟主机安全配置研究</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">网路游侠</span> <span class="weibo"></span> <span class="reply-time">2015-10-22 22:21:02</span></div><p></p><p>iodine可以通过一台DNS服务器制造一个IPv4数据通道，这个工具可帮助渗透测试人员用于穿越防火墙等情景。这款工具运行于 Linux, Mac OS X, FreeBSD, NetBSD, OpenBSD和Windows，并需要一个TUN/TAP设备。同时对带宽也有一定要求。 请叫我雷锋。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">lxj616</span> <span class="reply-time">2015-10-22 15:14:20</span></div><p></p><p>iodine</p><p></p></div></div></div></div></div></main>