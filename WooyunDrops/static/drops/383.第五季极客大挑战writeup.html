<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">第五季极客大挑战writeup</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">F1uYu4n</a> <span class="bull">·</span> <time title="2014/11/03 16:22" ui-time="" datetime="2014/11/03 16:22" class="published ng-binding ng-isolate-scope">2014/11/03 16:22</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h2>0x01 misc</h2><hr><p><strong>too young too simple</strong></p><p>一个叫flag.bmp的文件，但是无法打开。文件头42 4D确实是bmp文件的头，但是文件尾 <code>49 45 4E 44 AE 42 60 82</code>却是png文件的尾。</p><p><img alt="enter image description here" img-src="856535a2cc33a9ccdabbb69272c5368ded6b67df.jpg"></p><p><img alt="enter image description here" img-src="8ef5cf9262a3c928d40e6d3fbb6edb214abe4e86.jpg"></p><p>另外文件头中的IHDR也能确信这是一个png图片。将文件头的 <code>42 4D E3 BF 22 00 00 00</code>修改为png头 <code>89 50 4E 47 0D 0A 1A 0A</code>，顺利打开得到一张图片。</p><p><img alt="enter image description here" img-src="448a78fe5588df47e7526b2c56edff374dc2fdbf.jpg"></p><p>图上是appleu0大神的blog地址，后面的提示意味不明。搜了下<code>weichuncai</code>并访问blog才知道这是blog上的动漫人物。与之聊天输入flag得到Flag。Flag貌似是海贼王里的。大神果然是十足的动漫控啊！</p><p><img alt="enter image description here" img-src="6e5b851e09354b623ecce8902986aca94e5b96dd.jpg"></p><p><strong>你喜不喜欢萌萌哒的姐姐</strong></p><p>一张loli的图，在jpg尾FF D9后还有很多可显字符。</p><p><img alt="enter image description here" img-src="10b8610767f8de81fe8f5a855500bc9eb76a2986.jpg"></p><p>全部复制出来，看编码应该是base64，放到hackbar里base64decode一下，却得到很多不可显字符，但是发现了JFIF标识，应该是base64encode了一张图片得到的。</p><p><img alt="enter image description here" img-src="560f0aaca5c938abebb1f6f0acf28711d61c4008.jpg"></p><p>下面是解码脚本。</p><pre><code>#!/usr/bin/env python

import base64

f = open('1.jpg', 'rb')
pic = f.read()
index = pic.find('\xff\xd9')
flag = pic[index + 5:]
f.close()

f1 = open('flag.jpg', 'w')
f1.write(base64.decodestring(flag))
f1.close()
</code></pre><p>运行得到flag.jpg。</p><p><img alt="enter image description here" img-src="2d352231c3f79d299df5766bc008535cb8d95e04.jpg"></p><p><strong>开胃小菜</strong></p><p>题目要求修改参赛口号为Hacked by white god!。</p><p>在个人信息页面<code>http://hack.myclover.org/team_info</code>的HTML注释中发现提示：</p><p><img alt="enter image description here" img-src="2770b95e09848e49e60437ee0b62e661ee73bc35.jpg"></p><p>更新口号翻译为upvoice，简直不忍直视，不能再low。 访问 <code>http://hack.myclover.org/team_info/upvoice?voice=Hacked+by+white+god!</code>得到Flag。</p><p><img alt="enter image description here" img-src="2472c2b856759a0fe69bbb0285b27bc0824066c9.jpg"></p><p><strong>白神的假期</strong></p><p>一张jpg图片，在文件尾FF D9后还有不少内容，而且是rar文件头<code>52 61 72 21</code>。</p><p><img alt="enter image description here" img-src="fc70a5417e7dafc5e5ebeba76393a8f07a3940df.jpg"></p><p>复制出剩下的部分成rar文件解压得到flag.txt。</p><p><img alt="enter image description here" img-src="989a5c96fd4a7127629da41bc68c838173bcd20e.jpg"></p><p>在base64decode一下就得到Flag：<code>KEY:SYC{Y34h!Thi5_15_th3_jp9_r4r_K3Y}</code></p><p><strong>reg</strong></p><p><img alt="enter image description here" img-src="9d3a804dcf43c7637838bbc844596ba0eadde9d8.jpg"></p><p>看到com啥的基本上就知道这肯定是个url了，再加上开始部分twi以及com之前的部分是从syclover中取，就能猜出是twitter.com，追加上后面的asdlalalalala得到url：<code>twitter.com/asdlalalalala</code>，访问url得到Flag。</p><p><img alt="enter image description here" img-src="7aeb7d092d3709af00ed1713ed7f1b0f0a317916.jpg"></p><p><strong>bilibili</strong></p><p>最坑的题没有之一。出题者丧心病狂居然要求通过bilibili的会员晋级考试，还得至少80分。好不容易通过修改HTML代码弄出了一张通过图，竟然还要关注出题者。无奈只好仔细百度做题，还好这时候只需要60就晋级成功，出题者也无法分辨我到底是60还是80。</p><h2>0x02 pentest</h2><hr><p><strong>HTTP Base1</strong></p><p>Flag在HTTP response header中。</p><p><img alt="enter image description here" img-src="226e9af315dc093cc77099fd36661e3107d23e90.jpg"></p><p><strong>HTTP Base2</strong></p><p><img alt="enter image description here" img-src="7cab713befb6409b07371e16b5d2adace714a274.jpg"></p><p>题目要求必须本机访问，开始以为加上X-Forwarder-For: 127.0.0.1到request header中就能解决，后来才知道也有从Client-IP来判断访问者来路的，于是填上Client-IP: 127.0.0.1到request header中得到Flag。</p><p><img alt="enter image description here" img-src="31746e082f069b025c740ff778bcc6b8e7f34e03.jpg"></p><p><strong>HTTP Base3</strong></p><p><img alt="enter image description here" img-src="6e15d6c82db2da9680fddd1e3f41d78264cb322c.jpg"></p><p>题目显示访问者是普通用户，所以思路是变成管理员，再加上cookie中发现有：userid=33; userlevel=2;于是将userid和userlevel都置为1，再次访问得到Flag。</p><p><img alt="enter image description here" img-src="8d5f85e90942369d545aeedb55dd3ec16a470c79.jpg"></p><p><strong>CrackPWD1</strong></p><p><img alt="enter image description here" img-src="007cd151b896490bd9cb336c5af5843a92224e83.jpg"></p><p>直接上ophcrack。Ophcrack基于彩虹表来破解hash口令，特别是针对XP的LM-NT hash，成功率很高。 下载地址：</p><pre><code>http://sourceforge.jp/projects/ophcrack/releases/

http://sourceforge.net/projects/ophcrack/files/
</code></pre><p><img alt="enter image description here" img-src="d6f16266cf43f137fb259d38979e483ed92ea51a.jpg"></p><p><strong>CrackPWD2</strong></p><p><img alt="enter image description here" img-src="9a8019ae6dab98be026340a7273dba59860b5c54.jpg"></p><p>提示口令起始为<code>SYC#</code>且长度为8，只需要生成一份包含所有可能性的字典交给工具跑。后4位每位上可见字符一共94个，字典大小为94的4次方行，约7800w。</p><p><img alt="enter image description here" img-src="4b5cf678cfd710a8a5ea941302df26e172672ef8.jpg"></p><p>再加上毛子强大的工具oclhashcat（http://hashcat.net/oclhashcat/），几乎是秒破口令。oclhashcat是一款使用GPU显卡来破密码的工具，分为N卡版和A卡版，号称世界上最快的密码破解器。 运行命令：</p><pre><code>cudaHashcat64.exe -t 32 -m 1000 NT.hash pass.dic
</code></pre><p><img alt="enter image description here" img-src="99096f03f783bce3754cd3e7ca3cea1139aecacf.jpg"></p><p><strong>美男子</strong></p><p><img alt="enter image description here" img-src="29d1a4574d331f38167fc85a4cfbcf2f4147375b.jpg"></p><p>按提示需要认证为美男子。查看cookie发现是： <code>user=diaosi; isboy=0; pass=d93fa3b25f83f202cc51257eee2c9207;</code>访问者被设为diaosi了，不能忍，果断修改us<code>er=meinanzi; isboy=1;</code>刷新得到Flag。</p><p><img alt="enter image description here" img-src="7a6e6994b673982870c8fbf280300b33ce56f74d.jpg"></p><p>Cookie中的md5解开是ds0，没用上。</p><p><strong>Login</strong></p><p><img alt="enter image description here" img-src="73be6c3351272cde1f0a1049536edfa8420ebd0d.jpg"></p><p>以<code>username=appleU0&amp;password=syclover</code>登录，发现一行提示 Tips: coverage login。 各种搜索不知道啥叫覆盖登录。各种乱想终于想到是覆盖login，变量覆盖漏洞。经历ISCC2014的变量覆盖题，猜变量名是一件头大的事。我设想了几个可能的变量名：</p><pre><code>admin\flag\key\KEY\user\login\submit
</code></pre><p>以及可能的值： <code>1\true\flag\key\admin\flag\login</code>，爆破了下没有结果，甚至连中文的值都试过，登录\提交，无果。最终觉得既然是覆盖login，变量名应该就是login，于是在GET的url后面添加上?login=1，尝试了下得到Flag。</p><p><img alt="enter image description here" img-src="fdd4504f9dc472f3f94fc1da6427aedc93eff667.jpg"></p><p><strong>白神的shell</strong></p><p><img alt="enter image description here" img-src="db9acd8502d217cd836eee831e0d965de3b8b860.jpg"></p><p>直接上代码吧，多线程也不会，跑的慢点，不过也能出结果。</p><pre><code>#!/usr/bin/env python

import httplib

s = 'zxcvbnmasdfghjklqwertyuiop'
length = len(s)
uri = '/pentest/findshell/white_god_s_webshell_'
conn = httplib.HTTPConnection("syc.myclover.org")

for i in range(length):
    for j in range(length):
        for k in range(length):
            conn.request("GET", uri + s[i] + s[j] + s[k] + ".php")
            response = conn.getresponse()
            response.read()
            if response.status == 200:
                print "white_god_s_webshell_%s%s%s" % (s[i], s[j], s[k]) + ".php"
                exit()
</code></pre><p><img alt="enter image description here" img-src="981472836a7a8a9130be5a497ef4a69f09dc6ccd.jpg"></p><p><img alt="enter image description here" img-src="ae62568966b7d7b0e4e655ace25fbf3d55fdb5bb.jpg"></p><p><strong>德玛西亚</strong></p><p><img alt="enter image description here" img-src="7dcbbd66a12a87bbc4ba62a386b4cbd903b4e99c.jpg"></p><p>下载的dhs文件可以用7z解压缩，打开解压的文件发现内容是某用户访问baidu的cookie，于是可以用劫持到的cookie冒充该用户登录百度。</p><p><img alt="enter image description here" img-src="4bb73ff45453124b271c383e7a5fc4cb2155d56d.jpg"></p><p>利用hackbar修改cookie，刷新登录百度，该用户的baidu id是dsploit_test。开始以为flag会在网盘、文库等地方，找了下没找到，回到个人中心，发现用户有贴吧操作痕迹，果断查看发帖和回帖发现Flag。</p><p><img alt="enter image description here" img-src="0e63edc12941f6481a9e1544790316556fd0f904.jpg"></p><p><strong>Web Base1</strong></p><p>简单的Get型注入。</p><pre><code>python sqlmap.py –u http://syc.myclover.org/pentest/web1/read.php?id=1 --dbms mysql -D webbase1 -T flag --dump
</code></pre><p><img alt="enter image description here" img-src="11e8448cb2e6096d16edb96f63ef3ef487f6d9fb.jpg"></p><p><strong>Web Base2</strong></p><p>Post搜索型注入。</p><pre><code>python sqlmap.py –u http://syc.myclover.org/pentest/web2/search.php --data “key=my” --dbms mysql -D webbase2 -T #flag --dump
</code></pre><p><img alt="enter image description here" img-src="eb3cf9aa9b5c01d8ccea508b4bde97816143b744.jpg"></p><p><strong>SQL注入</strong></p><p>链接是sqlmap.org的山寨页面，在http response header里发现提示，index.php?id=。分别取id=1/2/3/4，页面与默认页面均不同。id=4-1与id=3一样，id=2%2B1与id=3也一样，id应该就是所需要的注入点了。 如果直接上sqlmap的话，会发现有mysql的payload，但是sqlmap无法识别database类型。</p><p><img alt="enter image description here" img-src="9a5e5b424339f38985f2a7ac249e481435d47dfa.jpg"></p><p>在尝试多个tamper之后，发现对关键字进行保护(对关键字添加/<em>!</em>/，如/!<em>select</em>/)的versionedmorekeywords.py能有斩获，payload发生了变化，也可以跑出一个数据库。</p><p><img alt="enter image description here" img-src="875076c8830e6545abe0353ee39460e59f14a7e3.jpg"></p><p>MySQL的表结构都存放在information&#95;schema中，不能访问这个库，就无法知道sqli库的结构，使用common-tables爆破表名也未果。下图中无法获取数据库的个数，当时觉得可能是过滤了information&#95;schema，也没有想到好的绕过方法，至此暂时陷入了僵局。</p><p><img alt="enter image description here" img-src="37716aee69b604836f74fe73f041d677a1ab04d1.jpg"></p><p>两天后，主办方在页面注释中给出了新提示，</p><blockquote><p></p><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/tips/4322" rel="bookmark" id="re1">False SQL Injection and Advanced Blind SQL Injection</a></li><li><a href="http://drops.wooyun.org/tips/125" rel="bookmark" id="re2">python脚本处理伪静态注入</a></li><li><a href="http://drops.wooyun.org/tips/3420" rel="bookmark" id="re3">Hack.lu 2014 Writeup</a></li><li><a href="http://drops.wooyun.org/tools/650" rel="bookmark" id="re4">tunna工具使用实例</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" img-src="default.png"><div class="content"><div class="comment-header"><span class="author-link">Winck</span> <span class="reply-time">2015-01-30 17:59:33</span></div><p></p><p>虽然不是很懂 但是也看完了</p></div></div></div></div><p></p></blockquote></section></article></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Toom</span> <span class="reply-time">2015-01-14 20:48:10</span></div><p></p><p>小白超市吓都吓死了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Fire ant</span> <span class="reply-time">2014-12-14 13:07:46</span></div><p></p><p>真是屌屌的</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">lnterface</span> <span class="reply-time">2014-11-25 23:49:22</span></div><p></p><p>赞</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">XX</span> <span class="reply-time">2014-11-22 22:38:44</span></div><p></p><p>感谢 ，这道题折腾了好久没做出来 原来是这样的！<br>下次审计的时候仔细点啦！<br>CODE2 也是把POST 看成了GET = =1!</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">neals</span> <span class="reply-time">2014-11-05 20:44:29</span></div><p></p><p>sqli中明显post也被限制了，而且index.php源代码中明显只接受get过来的数据，提交post数据能绕过？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">sky</span> <span class="reply-time">2014-11-05 15:12:39</span></div><p></p><p>天使来招你了~么么哒</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">牛肉包子</span> <span class="reply-time">2014-11-05 14:20:41</span></div><p></p><p>web300是靠phpmyadmin的弱口令进去，不是wordpress后台弱口令，所以后面我把密码回滚了。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">F1uYu4n</span> <span class="reply-time">2014-11-04 16:06:43</span></div><p></p><p>code3最后出的 乌云没给我更新上<br>首先通过svn获取到源码，index.php和code1一致，多了一个防御注入的sqli.php，黑名单\ union and or | from where select，但是只在get里过滤了，post没有过滤<br>最后post ?syc%26id=1%20union%20select%201,`flag%23is%23here`%20from%20flag就能搞定</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">XX</span> <span class="reply-time">2014-11-04 10:39:36</span></div><p></p><p>醉了 ，官方出writeup了嘛？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">XX</span> <span class="reply-time">2014-11-04 10:38:51</span></div><p></p><p>代码审计第三题是怎么做的？ 那道题怎么弄都没弄好··</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">园长</span> <span class="reply-time">2014-11-04 10:36:48</span></div><p></p><p>每个会做题的孩子都是天使</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">党中央</span> <span class="reply-time">2014-11-04 01:21:14</span></div><p></p><p>留名</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">laterain</span> <span class="reply-time">2014-11-03 23:08:01</span></div><p></p><p>极客比赛是给新生做的啊，只能出简单点，要不会把人家玩坏的=。=<br>如果想做难题，欢迎参加12月的SCTF哟&gt;_&lt;</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">DM_</span> <span class="reply-time">2014-11-03 22:59:13</span></div><p></p><p>这么详细的文章，给赞～</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">hksong</span> <span class="reply-time">2014-11-03 22:01:11</span></div><p></p><p>两题web，用sqlmap轻松就搞定也是醉了~</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">无边落木</span> <span class="reply-time">2014-11-03 21:25:27</span></div><p></p><p>膜拜</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">maodun</span> <span class="reply-time">2014-11-03 19:27:24</span></div><p></p><p>nice</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Hxai11</span> <span class="reply-time">2014-11-03 17:16:49</span></div><p></p><p>。。。看完我只想说为毛破解效率如此高，还有，作者萌萌哒</p><p></p></div></div></main>