<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">linux下tomcat安全配置</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">s4cr00t</a> <span class="bull">·</span> <time title="2016/05/25 9:29" ui-time="" datetime="2016/05/25 9:29" class="published ng-binding ng-isolate-scope">2016/05/25 9:29</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h1>0x00 删除默认目录</h1><hr><p>安装完tomcat后，删除<code>$CATALINA_HOME/webapps</code>下默认的所有目录文件</p><pre><code>#!bash
rm -rf /srv/apache-tomcat/webapps/*
</code></pre><h1>0x01 用户管理</h1><hr><p>如果不需要通过web部署应用，建议注释或删除tomcat-users.xml下用户权限相关配置</p><p><img alt="p1" img-src="588e048b5241142b149265db0f10fef5b52344e1.jpg"></p><h1>0x02 隐藏tomcat版本信息</h1><hr><p><strong>方法一</strong></p><p>修改<code>$CATALINA_HOME/conf/server.xml</code>,在Connector节点添加server字段，示例如下</p><p><img alt="p2" img-src="1cd616d60e92cfd07dd7060f852eb8d6f16d7861.jpg"></p><p><img alt="p3" img-src="1114e7a72de0f9c556b87d99c24ff928f9a3af2c.jpg"></p><p><strong>方法二</strong></p><p>修改<code>$CATALINA_HOME/lib/catalina.jar::org/apache/catalina/util/ServerInfo.properties</code></p><p>默认情况下如图</p><p><img alt="p4" img-src="086df866e8051fbb0b2c2350ef0a77ff8e4a955d.jpg"></p><p><img alt="p5" img-src="f57ef9f4e719a780fabbd859e150faf85241af7a.jpg"></p><p>用户可自定义修改server.info字段和server.number字段，示例修改如下图所示。</p><p><img alt="p6" img-src="90518975aafdbaa41413d3504923774faf142c65.jpg"></p><p><img alt="p7" img-src="ce23f85abdba01e18dfab52f1aeb8be56e39a643.jpg"></p><h1>0x03 关闭自动部署</h1><hr><p>如果不需要自动部署，建议关闭自动部署功能。在<code>$CATALINA_HOME/conf/server.xml</code>中的host字段，修改<code>unpackWARs="false" autoDeploy="false"</code>。</p><p><img alt="p8" img-src="5ba937c9234374239b2a587a51acf1514b10a9b5.jpg"></p><h1>0x03 自定义错误页面</h1><hr><p>修改web.xml,自定义40x、50x等容错页面，防止信息泄露。</p><p><img alt="p9" img-src="b239cc27b79dc03321a9696f45fa440d386ad0a1.jpg"></p><h1>0x05 禁止列目录（高版本默认已禁止）</h1><hr><p>修改web.xml</p><p><img alt="p10" img-src="8edfbf4e6836c02075ad8c38fb085a9878572045.jpg"></p><h1>0x06 AJP端口管理</h1><hr><p>AJP是为 Tomcat 与 HTTP 服务器之间通信而定制的协议，能提供较高的通信速度和效率。如果tomcat前端放的是apache的时候，会使用到AJP这个连接器。前端如果是由nginx做的反向代理的话可以不使用此连接器，因此需要注销掉该连接器。</p><p><img alt="p11" img-src="fbd055edc0c54157d125072b11cd3343c7482522.jpg"></p><h1>0x07 服务权限控制</h1><hr><p>tomcat以非root权限启动，应用部署目录权限和tomcat服务启动用户分离，比如tomcat以tomcat用户启动，而部署应用的目录设置为nobody用户750。</p><h1>0x08 启用cookie的HttpOnly属性</h1><hr><p>修改<code>$CATALINA_HOME/conf/context.xml</code>，添加<code>&lt;Context useHttpOnly="true"&gt;</code>,如下图所示</p><p><img alt="p12" img-src="63035dccb8436d87cfb1164c4388fe7365074fe5.jpg"></p><p>测试结果</p><p><img alt="p13" img-src="d46217a6558ced1b7f09f9e2a9b4f511c8e63a1f.jpg"></p><p><img alt="p14" img-src="c35292f5d890cde77a479a1c65cfa7592026c1e1.jpg"></p><p>配置cookie的secure属性，在web.xml中sesion-config节点配置cooker-config，此配置只允许cookie在加密方式下传输。</p><p><img alt="p15" img-src="2e4d423328a090acbffb134315c6ea01b4a2f46b.jpg"></p><p>测试结果</p><p><img alt="p16" img-src="e5c32b63121e2b6b05eb067733e6af1af0f9d603.jpg"></p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">气质鸵鸟</span> <span class="reply-time">2016-05-30 09:24:06</span></div><p></p><p>降权的地方还可以深入一下</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">cfan</span> <span class="reply-time">2016-05-26 14:38:16</span></div><p></p><p>mark</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">vforbox</span> <span class="reply-time">2016-05-26 10:18:47</span></div><p></p><p>mark 写的不错</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">谢谢分享</span> <span class="reply-time">2016-05-25 19:17:31</span></div><p></p><p>赞一个，不错~ 再问一句，0x04去哪里了？ ：）</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">depycode</span> <span class="reply-time">2016-05-25 17:25:03</span></div><p></p><p>收藏了,感谢分享!</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">qglfnt</span> <span class="reply-time">2016-05-25 14:38:38</span></div><p></p><p>不错，学习了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">xsser</span> <span class="reply-time">2016-05-25 14:09:55</span></div><p></p><p>不错 小地方很深入</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">小r00to1</span> <span class="reply-time">2016-05-25 10:51:29</span></div><p></p><p>good</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">小饼仔</span> <span class="reply-time">2016-05-25 10:16:22</span></div><p></p><p>赞</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">mono</span> <span class="reply-time">2016-05-25 09:42:43</span></div><p></p><p>这个paper好及时，赞！</p><p></p></div></div></div></div></div></main>