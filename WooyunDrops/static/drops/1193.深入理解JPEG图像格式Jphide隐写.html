<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">深入理解JPEG图像格式Jphide隐写</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">4ido10n</a> <span class="bull">·</span> <time title="2016/05/12 10:33" ui-time="" datetime="2016/05/12 10:33" class="published ng-binding ng-isolate-scope">2016/05/12 10:33</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h1>0x00 隐写原理</h1><hr><p>Jphide是基于最低有效位LSB的<a href="http://www.cnblogs.com/leaven/archive/2010/04/06/1705846.html">JPEG格式</a>图像隐写算法，使用JPEG图像作为载体是因为相比其他图像格式更不容易发现隐藏信息，因为JPEG图像在<a href="https://en.wikipedia.org/wiki/Discrete_cosine_transform">DCT变换域</a>上进行隐藏比空间域隐藏更难检测，并且鲁棒性更强，同时<a href="http://baike.baidu.com/link?url=OWM-kQRYlFaJ2Sy7m1E_Z_-fnvknJTRSHwk1f3eoabLsbht1TJa07GmvWRoiOg6U7-0-Ey3vb_UHcDm9Pc7Mgq">Blowfish算法</a>有较强的抗统计检测能力。</p><p>由于JPEG图像格式使用<a href="http://baike.baidu.com/view/391624.htm?fr=aladdin&amp;fromtitle=DCT&amp;fromid=4184&amp;type=syn">离散余弦变换</a>（Discrete Cosine Transform，DCT）函数来压缩图像，而这个图像压缩方法的核心是：通过识别每个8×8像素块中相邻像素中的重复像素来减少显示图像所需的位数，并使用近似估算法降低其冗余度。因此，我们可以把DCT看作一个用于执行压缩的近似计算方法。因为丢失了部分数据，所以DCT是一种<a href="http://baike.baidu.com/link?url=7eIl--nFUaz-amKaY9jatpW4J-J2JyZEXy8dYJM4Py1CspzR9mUATKgTyXOCt7M6AjFSv4JmF3YKtXTTAauHm_">有损压缩</a>（Loss Compression）技术，但一般不会影响图像的视觉效果。</p><h1>0x01 隐写过程</h1><hr><p>Jphide隐写过程大致为：先解压压缩JPEG图像，得到DCT系数；然后对隐藏信息用户给定的密码进行Blowfish加密；再利用Blowfish算法生成伪随机序列，并据此找到需要改变的DCT系数，将其末位变为需要隐藏的信息的值。最后把DCT系数重新压回成JPEG图片，下面是个人对隐写过程理解画出的大致流程图。</p><p><img alt="" img-src="98c73e471b7eedfe507d3187c71e8a45a1525736.jpg"></p><h1>0x02 隐写实现</h1><hr><p><strong>（1）Stegdetect</strong></p><p>实现JPEG图像Jphide隐写算法工具有多个，比如由Neils Provos开发通过统计分析技术评估JPEG文件的DCT频率系数的隐写工具<a href="https://github.com/abeluck/stegdetect">Stegdetect</a>，它可以检测到通过JSteg、JPHide、OutGuess、Invisible Secrets、F5、appendX和Camouflage等这些隐写工具隐藏的信息，并且还具有基于字典暴力破解密码方法提取通过Jphide、outguess和jsteg-shell方式嵌入的隐藏信息。</p><p><strong>（2）JPHS</strong></p><p>而这里介绍另一款JPEG图像的信息隐藏软件<a href="http://io.acad.athabascau.ca/~grizzlie/Comp607/programs.htm">JPHS</a>，它是由Allan Latham开发设计实现在Windows和Linux系统平台针对有损压缩JPEG文件进行信息加密隐藏和探测提取的工具。软件里面主要包含了两个程序JPHIDE和JPSEEK， JPHIDE程序主要是实现将信息文件加密隐藏到JPEG图像功能，而JPSEEK程序主要实现从用JPHIDE程序加密隐藏得到的JPEG图像探测提取信息文件，Windows版本的JPHS里的JPHSWIN程序具有图形化操作界面且具备JPHIDE和JPSEEK的功能。</p><p><img alt="" img-src="2298edce4a2f20d7286788bf589603556fbf36f2.jpg"></p><p>1.Windows用户请下载<a href="http://io.acad.athabascau.ca/~grizzlie/Comp607/jphs05.zip">JPHS-05 for Windows</a>,同时也提供下载<a href="http://linux01.gwdg.de/~alatham/stego.html">Linux版本</a>。</p><p>2.分别准备一个JPEG格式的图片（example.jpg）和一个文本文件（flag.txt）。</p><p><img alt="" img-src="5879cece06bec6670a8e02a028c35d86fe978937.jpg"></p><p>由于JPEG文件使用的数据存储方式有多种不能一一演示，这里用最常用的JPEG格式-JPEG文件交换格式（JPEG File Interchange Format，JFIF）作为示例。</p><p>这里简单介绍JPEG文件交换格式的JPEG图片的图像开始标记SOI（Start of Image）和应用程序保留标记APP0（Application 0），JPEG文件交换格式的JPEG图片开始前2个字节是图像开始标记为0xFFD8，之后2个字节接着便是应用程序保留标记为0xFFE0，应用程序保留标记APP0包含9个具体字段，这里介绍前三个字段，第一个字段是数据长度占2个字节，表示包括本字段但不包括标记代码的总长度，这里为10个字节，第二个字段是标识符占5个字节0x4A46494600表示“JFIF0”字符串，第三个字段是版本号占2个字节，这里是0X0101，表示JFIF的版本号为1.1，但也可能为其它数值，从而代表了其它版本号。</p><p><img alt="" img-src="36e341227925a3eb50c3a6e1b91de9e54943cc2c.jpg"></p><p>3.Windows版本可以使用具有图形化操作界面的Jphswin，选择“Open jpeg”打开示例JPEG格式图片example.jpg</p><p><img alt="" img-src="779fa4e3e860f4a154ce24e6df517cb798957437.jpg"></p><p>如果你选择的不是JPEG格式的图片程序会自动退出，你可以16进制编辑器如Winhex查看图片的图像开始标记SOI和应用程序保留标记APP0，当载入JPEG格式图片会显示一些图片的属性。</p><p><img alt="" img-src="4d5a121dd8bddcc8b995bcf9cd4ac88d4a318726.jpg"></p><p>4.选择“Hide”选项之后在两次文本框输入相同的密码，这里以输入flag作为密码为例，然后输入要包含隐藏信息的文本。</p><p><img alt="" img-src="ae01062502d43c5227eca130b8d469e0bbd5db4f.jpg"></p><p><img alt="" img-src="32df503f6d8c95019fb6de4e275a0622a435758e.jpg"></p><p>6.选择“Save jpeg as”选项将图片另存为jpeg格式并输入文件的名称为新的图像文件如C4n-u-find-f14g.jpg。</p><p><img alt="" img-src="6eae1c28944f3f655d50fe39b62a43bfb4c8acc8.jpg"></p><p>7.之后便可以看到生成结果和相关信息。</p><p><img alt="" img-src="e52c66bbaba1cba8cc45e716e40487613e6377c0.jpg"></p><p>8.第2步到第7步做的是Jhide方式信息隐藏，接下来我们从C4n-u-find-f14g.jpg图片提取出隐藏信息。</p><p><img alt="" img-src="7d702d336e55b8096196b22628c52d73c5183467.jpg"></p><p>9.如果之前你并不知道图片是基于什么方式进行信息隐藏，你可以使用Stegdetect先进行探测。</p><p>Stegdetect的主要选项如下：</p><blockquote><p>-q 仅显示可能包含隐藏内容的图像。</p><p>-n 启用检查JPEG文件头功能，以降低误报率。如果启用，所有带有批注区域的文件将被视为没有被嵌入信息。如果JPEG文件的JFIF标识符中的版本号不是1.1，则禁用OutGuess检测。</p><p>-s 修改检测算法的敏感度，该值的默认值为1。检测结果的匹配度与检测算法的敏感度成正比，算法敏感度的值越大，检测出的可疑文件包含敏感信息的可能性越大。</p><p>-d 打印带行号的调试信息。</p><p>-t 设置要检测哪些隐写工具（默认检测jopi），可设置的选项如下：</p><ul><li>j 检测图像中的信息是否是用jsteg嵌入的。</li><li>o 检测图像中的信息是否是用outguess嵌入的。</li><li>p 检测图像中的信息是否是用jphide嵌入的。</li><li>i 检测图像中的信息是否是用invisible secrets嵌入的。</li></ul><p>-V 显示软件版本号。</p><p>如果检测结果显示该文件可能包含隐藏信息，那么Stegdetect会在检测结果后面使用1～3颗星来标识 隐藏信息存在的可能性大小，3颗星表示隐藏信息存在的可能性最大。</p></blockquote><p>从下图可以看出很可能是Jphide的信息隐藏方式：</p><p><img alt="" img-src="f1fe592b23a9d35349fd862d585d92f6d3c045d1.jpg"></p><p>10.在知道隐藏方式之后可以开始进行信息提取，和使用JPHS进行信息隐藏过程类似，打开需要提取隐藏信息的图片C4n-u-find-f14g.jpg，输入对应密码（在不知道密码的情况不可以尝试Stegdetect工具里的Stegbreak程序进行基于字典的暴力攻击）flag，密码验证通过JPHS会自动提取隐藏信息，之后便可以另存提取出的信息。</p><p><img alt="" img-src="018ec30774a20d83d26fa24e7129644e88987138.jpg"></p><p>11.打开提取得到的find.txt便可以得到我们想要的隐藏信息。</p><p><img alt="" img-src="27a392e7f4dbc7bbe84da9f73d70d205da4f7b10.jpg"></p><h1>0x03 参考资料</h1><hr><p><a href="http://mall.cnki.net/magazine/article/JSJC201006056.htm">Jphide原理剖析及检测</a></p><p><a href="http://www.cnki.com.cn/Article/CJFDTotal-JSJC200707054.htm">基于二次加密的JPhide隐写检测方法</a></p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">bombareck</span> <span class="reply-time">2016-06-11 00:41:29</span></div><p></p><p>看了半天没看明白你写的是什么。能不能简洁大方得体的表达清楚。就你专业话术多啊</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">bombareck</span> <span class="reply-time">2016-06-11 00:38:42</span></div><p></p><p>这是个 iJb弄点好的再写</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">4ido10n</span> <span class="reply-time">2016-06-10 20:42:02</span></div><p></p><p>个人博客：hackfun.org,欢迎来玩~</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">4ido10n</span> <span class="reply-time">2016-06-10 20:40:38</span></div><p></p><p>@GT 仔细看文章哦( •̀ ω •́ )y</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">GT</span> <span class="reply-time">2016-05-19 17:27:12</span></div><p></p><p><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="1af398b9fea2b0ffb59cfdba9bfc82b5fc9a94fea392ffa69eff9da0fc87bffd809e5a2e737e752b2a74">[email&#160;protected]</a></p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">whynot</span> <span class="reply-time">2016-05-18 00:30:12</span></div><p></p><p>感谢分享、都是这个感觉好像不太实用啊 跟exif似的</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">隔壁老爸</span> <span class="reply-time">2016-05-17 21:58:11</span></div><p></p><p>@沧浪浪拔出保健 二次截图谁能解出来，我认他做大表哥。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">4ido10n</span> <span class="reply-time">2016-05-15 01:24:28</span></div><p></p><p>@沧浪浪拔出保健<br>static/drops/full/7d702d336e55b8096196b22628c52d73c5183467.jpg 这是原图，不是截图的，我也测试过了，没有问题，你可以试一下: P</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">4ido10n</span> <span class="reply-time">2016-05-15 01:18:19</span></div><p></p><p>不好意思，在介绍应用程序保留标记APP0第一个字段数据长度应为16个字节，当时头脑不清醒QAQ</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">沧浪浪拔出保健</span> <span class="reply-time">2016-05-13 17:37:13</span></div><p></p><p>如果图片被二次截图的话，应该就无法读取里面信息了吧？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">K4r1iNNg</span> <span class="reply-time">2016-05-12 11:34:43</span></div><p></p><p>sctf的</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">qtdszws</span> <span class="reply-time">2016-05-12 11:23:09</span></div><p></p><p>不错，学习了</p><p></p></div></div></div></div></div></main>