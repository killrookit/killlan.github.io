<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">狗汪汪玩转嵌入式 -- KACO 电源逆变器系统 XP100U</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">Kevin2600</a> <span class="bull">·</span> <time title="2016/03/10 15:28" ui-time="" datetime="2016/03/10 15:28" class="published ng-binding ng-isolate-scope">2016/03/10 15:28</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h1>0x00 前言</h1><hr><p>首先要感谢冰哥的指导和鼓励才有了以下这篇小文. 当下智能物联网设备火热, 许多商家和开发人员只图功能上的快捷, 而忽略提供相应的安全方案. 同时许多传统的工控设备, 因添加了网络模块却又缺少相应的安全意识, 导致这些设备都稀里糊涂地暴露在了公网上. 这为攻击者打开了一道方便之门. 本文将于这款 KACO 新能源公司生产的电源逆变器系统为例, 跟大家分享下不安全的设计会给工控系统带来怎样的影响.</p><p><img alt="p1" img-src="8a15e1f94535b34aee4bcbc3197bb8e0e8f98bdd.jpg"></p><p>KACO 新能源公司是一家位于德国, 专注生产和设计电力相关的工控系统. 据称其客户遍布全球. 但在 2015 年的 DEFCON 23 上被爆出其在电源逆变器系统 XP100U 产品中存在后门.</p><p>而在重现的研究过程中, 我们可以发现此款产品的问题还不仅仅如此. 接下来大家就一起来场工控设备的探索之旅吧.</p><p><img alt="p2" img-src="c11961d0576d0624715e72a880586547750953f9.jpg"></p><h1>0x01 经典系统后门</h1><hr><p>KACO 的这款电源逆变器系统自带了一个Java 编写的小型 WEB 服务, 用于远程登陆系统监控各项数据指标.</p><p><img alt="p3" img-src="708b9adcaa7ee50b49ac9f7657b0973e40300d25.jpg"></p><p>通过阅读操作手册我们可以得知, 系统有个默认的密码 ksk12. 成功登陆后便可进行一系列的数据采集等操作.</p><p><img alt="p4" img-src="e2bf537fe76f820f59cbc929838758c83cc93ef2.jpg"></p><p>在通过查看页面代码后, 我们可以找到一个名为wms.jar 的文件. 这里我们可以使用JAVA decompile 软件来查看其源代码.</p><p><img alt="p5" img-src="69273be9af01fb9d44d9bc4c448e6bbaf4e07b8c.jpg"></p><p>只需简单的查找password关键字, 我们便可以轻松找到位于WMSSettings下的后门密码 “kacosolar2008” .</p><p><img alt="p6" img-src="40537a7a5e31404b832944ef1fb5c222951b2b19.jpg"></p><p>有趣的是此后门密码是无法修改的. 如以下代码所示, 整个后门的认证过程只是简单跟WMSSettings 里设置好的AdminPassword 在本地进行比对.</p><p><img alt="p7" img-src="d83c0c9cc02cddbe5d24483e53dfadccfeef7c6d.jpg"></p><p>瞧整个后门还原过程是那么的轻松愉快, 不过更为有趣的地方还在后头…</p><h1>0x02 掩耳盗铃认证设计</h1><hr><p>再了解过上面这个经典的后门系统后门账号后. 通过 Wireshark 抓包分析, 还可以发现了一个此系统 ”有意思” 的认证设计. 之前我们说过系统默认密码为 ksk12. 正常情况下用户可以将其修改为自定的密码, 而整个过程都以明文的方式传送. 是的, 我们可以通过简单的sniffing 就得到密码. 但这又有啥特别呢? 别急好戏还在后头.....</p><p><img alt="p8" img-src="f3a6728d319106def4246a812e063cba402b96ec.jpg"></p><p>这里我们还是先来看下整个登陆的过程. 当我们按下Login键之后, 客户端发的第一个包中含有 “<code>aci_request_code type=‘int’&gt; 31&lt;</code>”的字样. 那么 31 是代表什么意思呢？</p><p><img alt="p9" img-src="b90ab3d0cba1d5f4e174547e0076a173ecbd7b98.jpg"></p><p>通过查找 Java 源代码得知, 类型 31 是用来从服务器 get 当前密码的. 也就是说每次认证时, 系统都会将当前密码以明文的方式发回...</p><p><img alt="p10" img-src="a3450b23b79b6ac6ad106b10331209527436cfc4.jpg"></p><p>最不可思议的地方是即使用户输入了错误密码, 表面上会弹出个报错框. 但实际上系统依旧将正确的密码明文返回. 哈哈! 换句话说我们更本就不需要通过逆向源代码这么麻烦, 系统本身就已经把密码告知天下了.</p><p><img alt="p11" img-src="9e2c6761982bef33a76b8ea007780f1778c4a677.jpg"></p><h1>0x03 猎杀 XP100U</h1><hr><p>讲了这么多大家一定迫不及待的想找台KACO 来体验下了吧. 这里我们可以使用搜索引擎来帮助完成这个任务. 如下图所示 SHODAN 轻松帮我们找到了几台暴露在公网的KACO 逆变器.</p><p><img alt="p12" img-src="c2abebf8659be20a11406915f583d7856622f738.jpg"></p><p>需要注意的是系统默认的端口号是 80 . 大家在测试过程中可以多试试几个常用端口.</p><p><img alt="p13" img-src="52a19eaca839c067a01520e5821ab4a710796523.jpg"></p><p><img alt="p14" img-src="cc53d524b1ac18b755864e2ac792ad8239a5b7f8.jpg"></p><p>有意思的是在某个KACO 电源逆变器的网址, 还存在网络监视器系统 (感谢 Z-One 友情提供线索). 感兴趣的朋友可以继续深度挖掘一下. 不过不要搞破坏哦. :D</p><h1>0x04 总结</h1><hr><p>通过这个案例, 可以发现在传统系统安全中已经很少出现的漏洞. 如 HTTP 明文传输; 默认密码; 系统后门等等在工控嵌入式系统中仍旧非常普遍. 可是由此所带来的隐患却是巨大的. 嵌入式系统往往还面临一旦投入产品线, 便难以升级的困难. 也许产品设计者在初始阶段就应该在易用 vs 安全中找到平衡点. 不过就安全爱好者本身而言, 工控嵌入式是一个非常好玩又很深的领域. 期待大家玩出更多的花样.</p><p><img alt="p15" img-src="03c3047f807e3283d68175ec8802697fa9649a89.jpg"></p><h1>0x05 参考文献</h1><hr><ul><li><a href="http://kaco-newenergy.com/us/">http://kaco-newenergy.com/us/</a></li><li><a href="https://ics-cert.us-cert.gov/alerts/ICS-ALERT-15-224-01">https://ics-cert.us-cert.gov/alerts/ICS-ALERT-15-224-01</a></li><li><a href="https://www.defcon.org/html/defcon-23/dc-23-speakers.html#Sood">https://www.defcon.org/html/defcon-23/dc-23-speakers.html#Sood</a></li></ul><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/tips/12370" rel="bookmark" id="re1">狗汪汪玩转嵌入式 -- WINKHUB 边信道攻击 (NAND Glitch)</a></li><li><a href="http://drops.wooyun.org/tips/2469" rel="bookmark" id="re2">Shodan搜索引擎介绍</a></li><li><a href="http://drops.wooyun.org/tips/3296" rel="bookmark" id="re3">Android证书信任问题与大表哥</a></li><li><a href="http://drops.wooyun.org/tips/8594" rel="bookmark" id="re4">工控安全入门分析</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">一只猿</span> <span class="reply-time">2016-03-14 18:12:16</span></div><p></p><p>物联网不成熟的阶段，太多安全问题暴露，危害也很可怕</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">肉肉</span> <span class="reply-time">2016-03-11 15:45:25</span></div><p></p><p>汪</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">SPRITEKING</span> <span class="reply-time">2016-03-11 10:53:04</span></div><p></p><p>电源逆变器可以调电压么？能的话入侵电脑又多了一条途径：直接升电压让电脑冒烟 -。-！ 想想都好可怕</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Mark</span> <span class="reply-time">2016-03-11 09:13:40</span></div><p></p><p>德国的机械制造牛逼，但是程序猿好像.。。。233</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">super480</span> <span class="reply-time">2016-03-10 19:45:19</span></div><p></p><p>围观~~~~~</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">mickey</span> <span class="reply-time">2016-03-10 17:19:44</span></div><p></p><p>我要把这个漏洞上交给国家</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">yzola</span> <span class="reply-time">2016-03-10 16:54:16</span></div><p></p><p>无证程序员</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Insight-Labs</span> <span class="reply-time">2016-03-10 16:26:25</span></div><p></p><p>也就是说每次认证时, 系统都会将当前密码以明文的方式发回...</p><p>。<br>。<br>。<br>。<br>老大，请问这个程序员应该怎么处置？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">RevengeRangers</span> <span class="weibo"></span> <span class="reply-time">2016-03-10 16:05:56</span></div><p></p><p>旺财不是。。当兵去了么</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Kane叔</span> <span class="weibo"></span> <span class="reply-time">2016-03-10 15:50:01</span></div><p></p><p>物联网领域安全只能啧啧…</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">哦哦</span> <span class="reply-time">2016-03-10 15:44:27</span></div><p></p><p>其实和web安全还是差不多的嘛。。。。</p><p></p></div></div></div></div></div></main>