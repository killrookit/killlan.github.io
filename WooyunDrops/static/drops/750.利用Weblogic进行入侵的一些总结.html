<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">利用Weblogic进行入侵的一些总结</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">DC3</a> <span class="bull">·</span> <time title="2015/09/09 10:18" ui-time="" datetime="2015/09/09 10:18" class="published ng-binding ng-isolate-scope">2015/09/09 10:18</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><p>本文主要总结一下在利用<code>Weblogic</code>进行渗透时的一些错误的解决方法以及一些信息的收集手段。</p><h1>0x01 最常见的两种错误</h1><hr><ul><li>上传<code>war</code>时拒绝访问，如下图</li></ul><p><img alt="enter image description here" img-src="950ad8c2f136ccb82d0c651b347ba07c34ef4d59.jpg"></p><p>出现此种原因可能是因为管理对默认上传目录<code>upload</code>做了权限设置</p><p>用<code>burp</code>截取上传时的数据，修改upload为其他目录</p><p><img alt="enter image description here" img-src="13a167d2d68c22ebb40597629e7d79342f16c95e.jpg"></p><ul><li>上传后无法部署，出现<strong>java.util.zip.ZipException:Could not find End Of Central Directory</strong>，如下图（经过整理的错误信息）</li></ul><p><img alt="enter image description here" img-src="055832ae14150ef08654bedf5666af157d0e2258.jpg"></p><p><strong>原因分析</strong>： 出现此种原因是因为上传的时候没有使用二进制模式，而是采用的<code>ASCII</code>模式，导致上传的文件全部乱码</p><p>这是采用<code>ASCII</code>模式上传之后再下载下来的文件，全部乱码</p><p><img alt="enter image description here" img-src="f9b42ef9f58716e37eb04f273de33db9786a52a8.jpg"></p><p>而原本的文件应该是这个样子的</p><p><img alt="enter image description here" img-src="2cc5c0470c2b62b73bb2325503247afd3011f948.jpg"></p><p>默认上传<code>war</code>的<code>content-type</code>为<code>application/octet-stream</code>或者<code>application/x-zip-compressed</code> （记不清了）</p><p>这两种模式本来应该为二进制上传模式的，但是却无缘无故变成了<code>ASCII</code>模式，原因未知（暂且认定为管理员的设置）</p><p>在二进制上传模式中，除了普通的程序，即<code>content-type</code>为<code>application</code>开头的，还有图片<code>image</code>开头</p><p>用<code>burp</code>抓取上传的数据<code>content-type</code>改成<code>image/gif</code>,还一定要加上文件头<code>GIF89a</code>,否则还是要出错，下图的那个<code>filename</code>为<code>key1.gif</code>仅为测试，实际上传还是以<code>war</code>结尾</p><p><img alt="enter image description here" img-src="c59a2a6834192a41e6bdadf8c709fb2936dce277.jpg"></p><h1>0x02 其他的信息收集</h1><hr><p>拿到<code>shell</code>之后先找配置文件，一般在<code>WEB-INF</code>目录下，有些在<code>WEB-INF/classes</code>目录下，文件名一般以<code>properties</code>结尾。</p><p>还有一种是<code>JDBC</code>在<code>Weblogic</code>里面配置好的，如下图</p><p><img alt="enter image description here" img-src="68f30643a48fc816a68d92663763a78b78823824.jpg"></p><p><img alt="enter image description here" img-src="0b1e6bca35e86139be189daef1414d460f43b0d6.jpg"></p><p>这种的解密方式请参考<a href="http://drops.wooyun.org/tips/349">解密JBoss和Weblogic数据源连接字符串和控制台密码</a></p><p><code>Weblogic</code>还提供虚拟主机的功能，通过这个，可以收集到一些域名的信息，所属单位等，以便进一步通知处理。</p><p><img alt="enter image description here" img-src="510e84fe811db13041d2908d106614f419cf764a.jpg"></p><h1>0x03 进内网</h1><hr><p>由于<code>Weblogic</code>权限比较大，在<code>Windows</code>一般都是<code>administrator</code>，<code>Linux</code>则是<code>weblogic</code>用户，也有<code>root</code>权限的。</p><p>所以拿到<code>shell</code>之后，先看看能否访问外网，以便转发内网，进行更深的渗透,一条ping命令即可,若不能访问外网，可以尝试下面这个方法</p><p><a href="http://wooyun.org/bugs/wooyun-2015-0127056">http://wooyun.org/bugs/wooyun-2015-0127056</a></p><p>以上只是鄙人的个人见解，望各路大神指正</p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">有归于无</span> <span class="reply-time">2015-09-09 17:59:01</span></div><p></p><p>不知道楼主有没有碰到过一直跳目录的情况</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">mickey</span> <span class="reply-time">2015-09-09 15:42:35</span></div><p></p><p>赞，好文</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">爱上襄阳</span> <span class="reply-time">2015-09-09 11:35:24</span></div><p></p><p>赞</p><p></p></div></div></div></div></div></main>