<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">恶意吸费木马-变脸</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">腾讯电脑管家</a> <span class="bull">·</span> <time title="2016/02/26 12:39" ui-time="" datetime="2016/02/26 12:39" class="published ng-binding ng-isolate-scope">2016/02/26 12:39</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h1>0x00 背景</h1><hr><p>近日，安卓市场上出现了一种名叫”变脸”的木马病毒，该病毒通过在正常安卓应用程序中插入恶意扣费代码，诱使用户下载安装后，在程序启动时，拉起恶意代码执行，用户在使用软件的同时，莫名其妙地被恶意扣费，手段隐蔽，用户毫不知情。被植入恶意代码的应用往往是下载和使用量较大的应用程序，所以攻击面非常广泛。</p><h1>0x01 病毒行为</h1><hr><ol><li>该病毒运行是伴随正常应用程序同时启动的，病毒代码植入到正常应用中，当应用程序执行时，会伴随拉起恶意代码，恶意代码解密一段自带的加密网址，解密后访问该网址链接。</li><li>该网址是一个云端控制服务器，通过给木马下发控制指令，通知木马是否发送扣费短信，并且扣费短信号码也是通过云端下发到中毒手机上。所以，从木马中无法获取到发送扣费短信的信息和号码等关键内容，具有隐蔽性。</li></ol><ol><li>同时木马还注册了拦截短信的服务，该服务会拦截短信内容，判断短信发送方的号码是否是以10开头的，如果是，则屏蔽掉该短信，导致中毒手机开通的扣费服务运营商发送的短信回执无法接收到，用户被木马默默开通了扣费服务。</li></ol><p>木马安装到手机后的启动图标:</p><p><img alt="p1" img-src="7c7cd0320b5540f7caef7db91ef76466741a8eaa.jpg"></p><p>当用户点击该程序后，程序启动:</p><p><img alt="p2" img-src="323d56c885287b4ade62c069708e52ed4bfb5a8e.jpg"></p><p>程序启动代码入口，可以看到，在游戏启动的同时，也拉起了恶意代码进行执行:</p><p><img alt="p3" img-src="406de7d3a4a218bb0583b92fc5527e7f8ead4c23.jpg"></p><p>木马首先通过异或运算解密云控制服务器网址:</p><p><img alt="p4" img-src="288d005a876e0e17cb72c14cd8df5fa6194e5f50.jpg"></p><p>解密后的服务器域名:</p><p><img alt="p5" img-src="e587f934c606919d9109a7d388bd4a0f7e20429f.jpg"></p><p>连接服务器并获取从云端获取控制指令:</p><p><img alt="p6" img-src="e2f4677a17621981f2aabf8b2a98eedcba59868d.jpg"></p><p>对从云端获取到的字符串信息进行解析，查找指令内容的特征:</p><p><img alt="p7" img-src="28f593f3221f09b56d233e438cc0f354590f47b0.jpg"></p><p>如果格式正确,则解析出号码和内容，开始发送扣费短信:</p><p><img alt="p8" img-src="64c59dc849c36953b3ebedbdf9691e41ecce3801.jpg"></p><p>木马注册了拦截短信的服务:</p><p><img alt="p9" img-src="f5e52f9a0e00d5f6c846b790527133cbe678e9b2.jpg"></p><p>该服务屏蔽以“10”开头的短信号码，导致中毒手机无法接收到扣费服务运营商发送的短信回执，在用户不知情的情况下,实现扣费。</p><p><img alt="p10" img-src="401e3dfd12b5064fe377184b70db14268de38bb9.jpg"></p><h1>0x02 查杀和预防</h1><hr><p>目前电脑管家、手机管家和哈勃分析系统已能分析查杀。</p><p>根据统计:从去年7月到今年年初，腾讯反病毒实验室平均每月能够捕获约22个同类型木马病毒。木马感染手机数预估为5300多台，木马发送的扣费服务短信，对中毒用户的吸费总计超过5万元以上。</p><h1>0x03 安全建议</h1><hr><p>目前安卓市场有大量的应用软件供用户免费下载使用，黑客通过在下载量大的应用软件和游戏中植入恶意代码，上传到市场上供用户下载传播，被植入恶意代码的应用从外观上看并没有差别，执行后也没有异常行为，但是在应用被使用的同时，恶意代码和病毒也被悄悄地拉起并执行，它们通过发送短信，定制扣费服务等方式，在用户不知情的情况下，对用户进行吸费，很难察觉，会严重威胁用户的账户隐私信息和财产安全，建议一定要从正规的市场下载APP，并用杀毒软件进行扫描后再安装使用，如碰到可疑文件，可使用电脑管家进行扫描或者上传到哈勃文件分析系统进行分析。</p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/tips/572" rel="bookmark" id="re1">如何玩转andriod远控（androrat）</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">游侠客</span> <span class="reply-time">2016-02-28 19:32:55</span></div><p></p><p>感谢您的论文！收益了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">sdf</span> <span class="reply-time">2016-02-26 13:56:09</span></div><p></p><p>3e7e64e202240d5c686f6b90fa0c5804</p><p></p></div></div></div></div></div></main>