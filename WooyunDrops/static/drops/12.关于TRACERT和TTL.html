<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">关于TRACERT和TTL</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">lion(lp)</a> <span class="bull">·</span> <time title="2013/01/29 11:14" ui-time="" datetime="2013/01/29 11:14" class="published ng-binding ng-isolate-scope">2013/01/29 11:14</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><p>最近看了一些文章，比如利用TTL 判断G&#42;F&#42;W，或者一些奇怪设备的位置，特做一个实验，看一下TTL 及TRACERT 。 TRACERT 大概的原理，就是通过发送不断+1 的TTL（TIME TO LIVE）的ICMP REQUEST到达最终设备，最后由最终设备返回ICMP REPLY（中间经过的设备返回的都是ICMP超时&#45;--|||||ICMP TIME EX）实现。 先发一个TRACERT 图</p><p><img alt="20130128144105_81105.jpg" img-src="5dcef595dde94c9d7eabdab508cf5df91526e605.jpg"></p><p>首先看第一个包</p><p><img alt="20130128143941_96799.jpg" img-src="dddecc1b2dd9145e8e930c8abc6bdbc24fd572b1.jpg"></p><p>TTL 为1，然后网关102.1 返回了一个超时如下图：</p><p><img alt="20130128144209_43363.jpg" img-src="5ab539452554fd1698c8cbd0012c4ded3feb8dea.jpg"></p><p>TTL+1</p><p><img alt="20130128144237_83074.jpg" img-src="46c86f6756447760c622973a61950ba949ab4bd8.jpg"></p><p>下一个设备返回TTL 超时，这样就能确定了两个设备，如图：</p><p><img alt="20130128144326_66137.jpg" img-src="812ddd743209c61517e86a21d3ad6748069fe1a3.jpg"></p><p>TTL再+1</p><p><img alt="20130128144403_98915.jpg" img-src="47c355ef4a0cd4b3858fb88fc1a81bee8a87aab4.jpg"></p><p>再超时</p><p><img alt="20130128144421_98502.jpg" img-src="c1f7e6d7cc5e2af7664fcd6ba70916989bf29953.jpg"></p><p>最后一个设备（google服务器）TTL 已经是17</p><p><img alt="20130128144448_97557.jpg" img-src="ef4b69248f4231248ab4a2b254b5ea668075343c.jpg"></p><p>谷歌服务器返回ICMP REPLY</p><p><img alt="20130128144542_62494.jpg" img-src="c6d0f73470e8d9c6fdacf9e6016c9cd45643cccb.jpg"></p><p>证明我和GOOGLE 服务器距离17跳。PING GOOGLE  （IP地址变了，但TTL 还是43）</p><p><img alt="20130128145247_32010.jpg" img-src="fcfc91c06878de4560b91e3b328347bdc3d1a92d.jpg"></p><p>基本上确定43+17=61  （google服务器的TTL 好像是61：从另一个国外linux PING 和tracert</p><p><img alt="20130128145815_99902.jpg" img-src="3cbf5590db0dcd67f9c47f52d8e766710772eb72.jpg"></p><p>54+7=61</p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">rehd</span> <span class="reply-time">2013-03-05 10:22:24</span></div><p></p><p>WildPackets OmniPeek你懂得</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">紫梦芊</span> <span class="reply-time">2013-02-22 12:55:14</span></div><p></p><p>工具很熟悉 科来的.</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">pentest</span> <span class="reply-time">2013-01-29 14:02:06</span></div><p></p><p>关那跳肯定需要算</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">lion(lp)</span> <span class="reply-time">2013-01-29 13:24:28</span></div><p></p><p>其实就是看算不算网关那跳了，不过GOOGLE 我觉得，不会改TTL 所以，应该还是 64</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">pentest</span> <span class="reply-time">2013-01-29 12:24:39</span></div><p></p><p>应该是43+16=60/54+6=60 吧？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">xsser</span> <span class="reply-time">2013-01-29 11:41:42</span></div><p></p><p>一般不会更改ttl的</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">lion(lp)</span> <span class="reply-time">2013-01-29 11:31:59</span></div><p></p><p>@xsser 这个是有可能的，有些设备是可以不让TRACERT 的，通过这样的设备，TRACERT 是看不到的，比如CISCO 的ASA 就可以这么配置。 我也怀疑，GOOGLE 应该不会改成61的，应该是64</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">xsser</span> <span class="reply-time">2013-01-29 11:16:07</span></div><p></p><p>哈哈，Google的服务器肯定不会是61，是不是可以说明在这个前面路由设备的后面实际上还有几层呢</p><p></p></div></div></div></div></div></main>