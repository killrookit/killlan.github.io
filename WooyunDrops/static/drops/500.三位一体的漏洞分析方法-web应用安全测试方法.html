<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">三位一体的漏洞分析方法-web应用安全测试方法</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">BMa</a> <span class="bull">·</span> <time title="2015/03/13 10:05" ui-time="" datetime="2015/03/13 10:05" class="published ng-binding ng-isolate-scope">2015/03/13 10:05</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h1>0x00 前言</h1><hr><p>节选自： http://www.owasp.org.cn/OWASP_Conference/owasp-20140924/02OWASPWeb20140915.pdf</p><ul><li>4.1  主动式（全自动 ）：Web2.0、交互式漏洞扫描</li><li>4.2  半自动式漏洞分析：业务重放、url镜像，实现高覆盖度</li><li>4.3  被动式漏洞分析：应对0Day和孤岛页面</li></ul><h1>0x01 主动式（全自动 ）Web扫描</h1><hr><p>• 使用常见的漏洞扫描器  • 自动fuzz，填充各种攻击性数据  • 业务逻辑混淆，导致服务出错</p><p><img alt="enter image description here" img-src="96574a26503733067a44b296449d8dad28eef327.jpg"></p><p>• 局限：  • 难以处理高交互式应用  • 只能发现暴露给用户（搜索引擎）的链接，难以覆盖100%的业务链接  • 解决方法：引入半被动式漏洞分析方法  • 在人工未参与的情况下，50%以上的Web应用系统存在高危漏洞</p><h1>0x02 半自动式漏洞分析：业务重放+url镜像，实现高覆盖度</h1><hr><h2>1. 方法一：业务重放</h2><hr><ul><li>测试过程使用 burpsuite、fiddler：</li></ul><ol><li>HTTP（S）业务流量录制与重放扫描</li><li>手工修改业务数据流</li><li>对手机APP也适用</li></ol><p>检测逻辑漏洞：  •水平权限绕过  •订单修改  •隐藏域修改</p><p><img alt="enter image description here" img-src="0e619fab10161747ee60661058cb972f8158d769.jpg"></p><h2>2. 方法二： 手工记录</h2><hr><p>• 从日志中获取url记录</p><pre><code>1. Fiddler的Url日志 
2. 获取Apache、Nginx、Tomcat的access日志 
3. 从旁路镜像中提取url日志 （安全人员不用再被动等待应用 的上线通知） 
</code></pre><ol><li>从Fiddler2、 burpsuite 导出Url日志 再导入到漏洞扫描器扫描</li></ol><p><img alt="enter image description here" img-src="8c76f1bbc1ead45feed55a6e73bf236ae00d0410.jpg"></p><p><img alt="enter image description here" img-src="d1e7c5eade34795fd2a08af2af75e88fc68e9397.jpg"></p><p>2.获取Apache、Nginx、Tomcat的access日志</p><ul><li>360-日志宝</li><li>Splunk</li><li>各种日志审计系统</li></ul><ol><li>从旁路镜像中提取url日志 （安全人员不用再被动等待应用 的上线通知）  如：jnstniffer、 360鹰眼、各大IT公司等</li></ol><p><img alt="enter image description here" img-src="730ad0ab8c15bed662d6f8e02ffc94c8135a2ed7.jpg"></p><p>• 从旁路镜像中获取url列表，能高效地检出大量的漏洞，不需要运维人员通知，便可以获知业务系统的上线情况并执行漏洞扫描任务。</p><h1>0x03 半自动式漏洞分析：业务重放、url镜像，高覆盖度</h1><hr><p>- 局限  ① 时间滞后/token: 流量重发时，不一定能100%重现当时的业务流程及出现的bug。  ② 依然难以覆盖100%的业务链接，存在孤岛页面。（正常数据流不触发）  ③ 漏洞检测（防御）技术滞后于攻击技术，无法解决0day漏洞  - 解决方法：引入全被动式漏洞分析</p><h1>0x04 全被动式漏洞分析：</h1><hr><p>国外产品：Nessus PVS被动扫描</p><p><img alt="enter image description here" img-src="db08cfb7a7d17d0cf3377dd9617249b1ca5a2e93.jpg"></p><h2>全被动式漏洞分析（不发送任何数据包)</h2><hr><ul><li>全被动式扫描VS主动式漏洞扫描器  相同点：都是根据双向数据包的内容，判断漏洞是否存在  不同点：  检测方式：被动式扫描不需要联网，不会主动发出url请求，也不发出任何数据包 PVS和IDS的区别：  • 更关注漏洞感知，而不是入侵，如页面出现sql错误信息，可触发pvs报警，但不会触发ids报警。  • 报警结果不一样：pvs按照漏洞的风险等级，ids按照黑客的攻击手段报警  • 双向分析数据报文  • 更关注于web应用，OWASP TOP10的攻击手段  • 按攻击影响报警（分析双向报文），而不是按攻击手段去报警（分析单向报文） Nessus的PVS只是一个思路，它专注及网络及主机漏洞，对Web应用的检测能力有限，需要重新设计一个针对web的PVS出来:WebPVS，同步接受用户提交的所有业务请求，通过扫描引擎识别请求，一旦发现恶意请求或者该请求返回数据，触发报警处理</li></ul><p><img alt="enter image description here" img-src="5a6a14ebe7fcf17a0834c6ea02775b04d4de547a.jpg"></p><p>• WebPVS的优点：    • 虽然依然难以覆盖100%的业务链接，但是能覆盖100%已经发生的业务链接。  • 能与黑客同步发现各种漏洞 • 由于HTTP协议是固定，因此能够根据回包情况发现0day攻击。</p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/tips/2614" rel="bookmark" id="re1">配置ModSecurity防火墙与OWASP规则</a></li><li><a href="http://drops.wooyun.org/web/5459" rel="bookmark" id="re2">验证码安全问题汇总</a></li><li><a href="http://drops.wooyun.org/tools/5751" rel="bookmark" id="re3">burpsuite扩展开发之Python</a></li><li><a href="http://drops.wooyun.org/papers/539" rel="bookmark" id="re4">解析漏洞总结</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">thanatos</span> <span class="reply-time">2015-12-07 17:08:35</span></div><p></p><p>听起来很牛逼的样子，有木有开源的？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">BMa</span> <span class="reply-time">2015-03-18 16:51:40</span></div><p></p><p>基友们引以为戒</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">px1624</span> <span class="reply-time">2015-03-14 21:30:55</span></div><p></p><p>哈哈，就是你，扫描器，被封了！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">f4ckbaidu</span> <span class="reply-time">2015-03-14 16:09:24</span></div><p></p><p>PVS好贵的说～</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Mr .LZH</span> <span class="reply-time">2015-03-13 13:29:31</span></div><p></p><p>曾经挖了一个网站的注入，刚提交乌云，过了几个小时审核不通过，原因：漏洞不存在。再去看一下，发现漏洞被修复了。所以说被动虽然不能在第一时间做出相应，但也是一种比较快速的发现产品线漏洞的方法。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">爱上平顶山</span> <span class="reply-time">2015-03-13 11:13:10</span></div><p></p><p>说到底 还是出钱的好</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">ModNar</span> <span class="reply-time">2015-03-13 10:23:36</span></div><p></p><p>嗯，去年ISC的议题。当时就有疑问：对于全被动，不配合IDC或WAF能检测到盲注么？</p><p></p></div></div></div></div></div></main>