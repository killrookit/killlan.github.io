<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">Tomcat安全配置</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">夸父追日</a> <span class="bull">·</span> <time title="2015/09/10 10:22" ui-time="" datetime="2015/09/10 10:22" class="published ng-binding ng-isolate-scope">2015/09/10 10:22</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><p><code>tomcat</code>是一个开源<code>Web</code>服务器，基于<code>Tomcat</code>的<code>Web</code>运行效率高，可以在一般的硬件平台上流畅运行，因此，颇受<code>Web</code>站长的青睐。不过，在默认配置下其存在一定的安全隐患，可被恶意攻击。</p><h1>0x00 测试环境</h1><hr><p>Win2003</p><p>Tomcat6.0.18 安装版</p><h1>0x01 安全验证</h1><hr><h3>一.登陆后台</h3><p>首先在<code>win2003</code>上部署<code>Tomcat</code>,一切保持默认。</p><p><code>Tomcat</code>的默认后台地址为:<code>http://域名:端口/manager/html</code>.进入之后弹出登陆对话框,<code>Tomcat</code>默认的用户名<code>admin</code>,密码为空。</p><p><code>Tomcat</code>的一些弱口令:</p><pre><code>tomcat tomcat 
admin 空 
admin admin 
admin 123456
</code></pre><p><img alt="enter image description here" img-src="f7cdad77d6ca4b04fdaffd10299eeded052fb17b.jpg"></p><p>然后来看一下<code>Tomcat</code>安装版默认的<code>tomacat-users.xml</code>配置文件</p><p><img alt="enter image description here" img-src="dda251ffa019a4e667d1dab9be144eaf7cb54e62.jpg"></p><p>注：<code>Linux</code>平台及<code>Windows</code>平台免安装版本不受该漏洞影响。</p><h3>二.获取Webshell</h3><p>在<code>Tomcat</code>的后台有个<code>WAR file to deploy</code>模块，通过其可以上传<code>WAR</code>文件。<code>Tomcat</code>可以解析<code>WAR</code>文件，能够将其解压并生成<code>web</code>文件。</p><p><img alt="enter image description here" img-src="790ba5d2ec7643afb3f4bffcc9942dcebb443c5b.jpg"></p><p>我们将一个<code>jsp</code>格式的<code>webshell</code>用<code>WinRar</code>打包然后将其后缀改名为<code>WAR</code>(本例为<code>no.war</code>)，这样;一个<code>WAR</code>包就生成了。最后将其上传到服务器，可以看到在<code>Tomcat</code>的后台中多了一个名为<code>/no</code>的目录。</p><p><img alt="enter image description here" img-src="bb7cd52c9c57caa207b81a1d201b50046cbc287c.jpg"></p><p>点击该目录打开该目录<code>jsp</code>木马就运行了，这样就获得了一个<code>Webshell</code>。</p><p><img alt="enter image description here" img-src="74992d91dfb63fea82367d8dd459ff77a901f5ff.jpg"></p><h3>三.获取服务器权限</h3><p><code>Tomcat</code>服务默认是以<code>system</code>权限运行的，因此该<code>jsp</code>木马就继承了其权限，几乎可以对<code>Web</code>服务器进行所有的操作。</p><p><img alt="enter image description here" img-src="7f259ee43ef100cfce10c731fd3f42e4acc37d23.jpg"></p><p>然后创建用户: <code>net user Boom shellcode /add</code></p><p>添加到管理员用户组: <code>net localgroup administrators Boom /add</code></p><p><img alt="enter image description here" img-src="8137836254aad5adfbccb4deaf9c5936239bffca.jpg"></p><p>然后可以干什么事我就不说了</p><h1>0x02 安全配置</h1><hr><h3>一.修改tomacat-users.xml或删除Tomcat后台</h3><p>修改<code>\conf\tomacat-users.xml</code></p><p><img alt="enter image description here" img-src="e6887a5569293e7917f1248c6870d55774cc8270.jpg"></p><p>删除<code>Tomcat</code>后台 <code>\webapps</code>全部删除就好。</p><h3>二.禁止列目录</h3><p>在<code>IIS</code>中如果设置不当，就会列出<code>Web</code>当前目录中的所有文件，然而在<code>Tomcat</code>也不例外。如果浏览者可以在客户端浏览<code>Web</code>目录，那将会存在较大的安全隐患，因此我们要确认<code>Tomcat</code>的设置中禁止列目录。<code>\conf\web.xml</code>下</p><pre><code>&lt;init-param&gt;
&lt;param-name&gt;listings&lt;/param-name&gt;
&lt;param-value&gt;false&lt;/param-value&gt;
&lt;/init-param&gt;　　
</code></pre><p>确认是<code>false</code>而不是<code>true</code>。</p><p><img alt="enter image description here" img-src="7ace26cbf28612aedb85fe201893a3fc0322629c.jpg"></p><h3>三.服务降权</h3><p>默认安装时<code>Tomcat</code>是以系统服务权限运行的，因此缺省情况下几乎所有的<code>Web</code>服务器的管理员都具有<code>Administrator</code>权限，存在极大的安全隐患，所以我们的安全设置首先从<code>Tomcat</code>服务降权开始。</p><p>首先创建一个普通用户，为其设置密码，将其密码策略设置为“密码永不过期”，比如我们创建的用户为<code>tomcat</code>。然后修改<code>tomcat</code>安装文件夹的访问权限，为<code>tomcat</code>赋予<code>Tomcat</code>文件夹的读、写、执行的访问权限，赋予<code>Tomcat</code>对<code>WebApps</code>文件夹的只读访问权限，如果某些<code>Web</code>应用程序需要写访问权限，单独为其授予对那个文件夹的写访问权限。</p><p><img alt="enter image description here" img-src="d9828eeaa5a569bcfb9fe9915d8c33dd6501f684.jpg"></p><p>“开始→运行”，输入<code>services.msc</code>打开服务管理器，找到<code>Apache Tomcat</code>服务，双击打开该服务的属性，在其实属性窗口中点击“登录”选项卡，在登录身份下选中“以此帐户”，然后在文本框中输入<code>tomcat</code>和密码，最后“确定”并重启服务器。这样<code>tomcat</code>就以<code>tomcat</code>这个普通用户的权限运行。</p><p><img alt="enter image description here" img-src="ec6815729e4cc64163a71cd7a89b03d4c974496d.jpg"></p><p>然后重启服务,就生效了。这样普通用户<code>tomcat</code>运行的<code>Tomcat</code>其权限就大大地降低了，就算是攻击者获得了<code>Webshell</code>也不能进一步深入，从而威胁web服务器的安全。</p><h3>四.关闭war自动部署</h3><p>关闭<code>war</code>自动部署 <code>unpackWARs="false" autoDeploy="false"</code>。防止被植入木马等恶意程序</p><p>应用程序部署与<code>tomcat</code>启动,不能使用同一个用户。</p><p><img alt="enter image description here" img-src="d27dad9cce093e04fb3259c5f4f3b386c2e64a74.jpg"></p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div id="donate" style="padding:10px;border-top:1px solid #d9d9d9;text-align:center"><span>碎银子打赏，作者好攒钱娶媳妇：</span><br><br><img src="http://static.wooyun.org/wooyun/upload/donate/201509121924418df78495ab65d00161df57e289492119.png" style="width:200px;height:200px"></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/tips/7299" rel="bookmark" id="re1">MySQL注入技巧</a></li><li><a href="http://drops.wooyun.org/tips/163" rel="bookmark" id="re2">攻击JavaWeb应用[1]-JavaEE 基础</a></li><li><a href="http://drops.wooyun.org/tips/2866" rel="bookmark" id="re3">lnmp虚拟主机安全配置研究</a></li><li><a href="http://drops.wooyun.org/tips/123" rel="bookmark" id="re4">MySql注入科普</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">馆主</span> <span class="reply-time">2016-05-10 14:09:33</span></div><p></p><p>这样真的挺好</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">你好</span> <span class="reply-time">2016-05-09 16:51:20</span></div><p></p><p>66666666666666666666666</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">wsg00d</span> <span class="reply-time">2016-04-09 21:30:45</span></div><p></p><p>关闭war自动部署 unpackWARs=&quot;false&quot; autoDeploy=&quot;false&quot;<br>我照做了，为啥还是能部署？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">机器猫</span> <span class="reply-time">2015-09-15 10:52:33</span></div><p></p><p>这是知识库里面为数不多的我可以一眼就看得懂的~</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">尊-折戟</span> <span class="reply-time">2015-09-14 08:49:31</span></div><p></p><p>这是知识库里面为数不多的我可以一眼就看得懂的~</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">不能忍</span> <span class="reply-time">2015-09-11 10:17:19</span></div><p></p><p>这是知识库里面为数不多的我可以一眼就看得懂的~</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">xk0n</span> <span class="reply-time">2015-09-10 22:49:32</span></div><p></p><p>这是知识库里面为数不多的我可以一眼就看得懂的~</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Xmyth_夏洛克</span> <span class="reply-time">2015-09-10 18:18:10</span></div><p></p><p>好的好的我知道了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">夸父追日</span> <span class="reply-time">2015-09-10 17:24:01</span></div><p></p><p>@海绵君 你是?</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">botak</span> <span class="reply-time">2015-09-10 16:11:59</span></div><p></p><p>这是知识库里面为数不多的我可以一眼就看得懂的~</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">‮</span> <span class="reply-time">2015-09-10 15:45:51</span></div><p></p><p>然而我用的是tomcat7.0</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">海绵君</span> <span class="reply-time">2015-09-10 14:10:01</span></div><p></p><p>好的好的我知道你脚受伤了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">鹦鹉螺1975</span> <span class="weibo"></span> <span class="reply-time">2015-09-10 12:16:35</span></div><p></p><p>tomcat</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">bingtangguan</span> <span class="reply-time">2015-09-10 10:51:49</span></div><p></p><p>这是知识库里面为数不多的我可以一眼就看得懂的~</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">BoomBoomBoom</span> <span class="reply-time">2015-09-10 10:38:23</span></div><p></p><p>这是知识库里面为数不多的我可以一眼就看得懂的~</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">mtfly</span> <span class="reply-time">2015-09-10 10:37:14</span></div><p></p><p>好的好的我知道了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">BoomBoomBoom</span> <span class="reply-time">2015-09-10 10:37:08</span></div><p></p><p>@mtfly 呀暴露了~</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">mtfly</span> <span class="reply-time">2015-09-10 10:34:19</span></div><p></p><p>LYLSQ</p><p></p></div></div></div></div></div></main>