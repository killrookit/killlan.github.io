<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">SVN安装配置及安全注意事项</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">瞌睡龙</a> <span class="bull">·</span> <time title="2013/07/30 15:05" ui-time="" datetime="2013/07/30 15:05" class="published ng-binding ng-isolate-scope">2013/07/30 15:05</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h3>0x00 SVN介绍</h3><hr><p>Subversion，简称SVN，是一个开放源代码的版本控制系统，相对于的RCS、CVS，采用了分支管理系统，它的设计目标就是取代CVS。互联网上越来越多的控制服务从CVS转移到Subversion。</p><p>Subversion的官方网站是：<a href="http://subversion.tigris.org/">http://subversion.tigris.org/</a></p><p>中文的网站：<a href="http://www.subversion.org.cn/">Subversion中文站</a>、<a href="http://svn.stu.edu.tw/svnbook/">SVNBook 正體中文版</a>、<a href="http://www.iusesvn.com/">Subversion中文社区</a>、<a href="http://www.svn8.com/">中文SVN技术资料</a>。</p><p>这些网站都提供了非常详细、多样的说明文档，有时间大家可以逐一细查。</p><p>Subversion使用服务端—客户端的结构，当然服务端与客户端可以都运行在同一台服务器上。在服务端是存放着所有受控制数据的Subversion仓库，另一端是Subversion的客户端程序，管理着受控数据的一部分在本地的映射（称为“工作副本”）。在这两端之间，是通过各种仓库存取层（Repository Access，简称RA）的多条通道进行访问的。这些通道中，可以通过不同的网络协议，例如HTTP、SSH等，或本地文件的方式来对仓库进行操作。</p><h3>0x01 安装配置</h3><hr><p>安装SVN</p><pre><code>#yum install subversion
</code></pre><p>测试是否安装成功</p><pre><code>#svnserve --version
</code></pre><p>如果显示了版本信息则表示安装成功</p><p>创建仓库</p><pre><code>#svnadmin create /home/svn/repo
</code></pre><p>给svn设置密码</p><p>修改配置文件<strong>/home/svn/repo/conf/svnserve.conf</strong> 去掉</p><pre><code>#[general]
</code></pre><p>前面的#号</p><p>匿名访问的权限，可以是read,write,none,默认为read</p><pre><code>anon-access = none
</code></pre><p>认证用户的权限，可以是read,write,none,默认为write</p><pre><code>auth-access = write
</code></pre><p>密码数据库的路径</p><pre><code>#password-db = passwd
</code></pre><p>去掉前面的#</p><p>修改配置文件passwd</p><pre><code>#vim /home/svn/repo/conf/passwd
</code></pre><p>=前面是用户名，后面是密码：</p><pre><code>[users]
name = password
</code></pre><p>启动SVN服务器</p><p>对于单个代码仓库</p><pre><code>#svnserve -d -r /home/svn --listen-host 192.168.1.100
</code></pre><p>svn默认端口是3690，在防火墙上开放这个端口。</p><pre><code>/sbin/iptables -A INPUT -i eth0 -p tcp --dport 3690 -j ACCEPT
/sbin/service iptables save
</code></pre><p>把/var/www/html/目录导入到svn的repo目录下</p><pre><code>svn import /var/www/html/  file:///home/svn/repo  -m "test"
</code></pre><p><br></p><h3>0x02 注意的问题</h3><hr><p>1、检出(导出结果带.svn文件夹的目录树)</p><pre><code>svn  co  http://路径　[本地目录全路径]  --username 用户名 --password 密码
svn  co  svn://路径　[本地目录全路径]  --username 用户名 --password 密码
svn  checkout  http://路径　[本地目录全路径] --username　用户名
svn  checkout  svn://路径　[本地目录全路径]  --username　用户名
</code></pre><p>如果不带--password 参数传输密码的话，会提示输入密码，建议不要用明文的--password 选项。 其中 username 与 password前是两个短线，不是一个。 不指定本地目录全路径，则检出到当前目录下。</p><p>2、导出(导出一个干净的不带.svn文件夹的目录树)</p><pre><code>svn  export  [-r 版本号]  http://路径 [本地目录全路径]　--username　用户名
svn  export  [-r 版本号]  svn://路径 [本地目录全路径]　--username　用户名
svn  export  本地检出的(即带有.svn文件夹的)目录全路径  要导出的本地目录全路径
</code></pre><p>第一种从版本库导出干净工作目录树的形式是指定URL。 如果指定了修订版本号，会导出相应的版本。 如果没有指定修订版本，则会导出最新的，导出到指定位置。 如果省略 本地目录全路径，URL的最后一部分会作为本地目录的名字。 第二种形式是指定 本地检出的目录全路径 到 要导出的本地目录全路径，所有的本地修改将会保留。 但是不在版本控制下(即没提交的新文件，因为.svn文件夹里没有与之相关的信息记录)的文件不会拷贝。</p><p>现实的开发环境中，强烈建议使用导出功能<strong>svn export</strong>而不是<strong>svn co</strong>。</p><p>由此可能导致非常严重的问题，很多管理员直接吧svn co出来的代码直接放到web目录下。</p><p>这就使.svn隐藏文件夹被暴露于外网环境，黑客可以借助其中包含的用于版本信息追踪的“entries”文件，逐步摸清站点结构。</p><p><img alt="svn及entries文件夹暴露于外网环境" img-src="2f13f1889c0754cc55ea908ddaad74641f8df851.jpg"></p><p>更严重的问题在于，SVN产生的.svn目录下还包含了以.svn-base结尾的源代码文件副本（低版本SVN具体路径为text-base目录，高版本SVN为pristine目录），如果服务器没有对此类后缀做解析，黑客则可以直接获得文件源代码。</p><p><img alt="源代码文件副本暴露于外网环境" img-src="99522a4a0fed01804bf24f7d5e59a048b738a4cb.jpg"></p><p>如果解析了该后缀，可能会有文件解析的漏洞，可能会有扩展解析漏洞，找地方上传xxx.php.gif也许就可以直接得到webshell了。</p><p>如果已经线上的生产环境已经有了.svn目录不想删掉可以在服务器上设置禁制访问此目录：</p><p>另外svn更新至1.7+ .svn/entries目录就不包含文件目录列表了。</p><p>Apache:</p><pre><code>&lt;Directory ~ "\.svn"&gt;
Order allow,deny
Deny from all
&lt;/Directory&gt;
</code></pre><p>Nginx:</p><pre><code>location ~ ^(.*)\/\.svn\/ {
return 404;
}
</code></pre><p>附上个遍历.svn/entries展现网站目录结构的两个脚本：</p><p><a href="http://static.wooyun.org/20141017/2014101714374572884.zip">svn遍历脚本.zip</a></p><p>wooyun上也是已经有非常多的svn泄露网站信息的事件，有的甚至由此导致整个服务器沦陷：</p><p><a target="_blank" href="http://www.wooyun.org/bugs/wooyun-2013-020861">WooYun: 【盛大180天渗透纪实】第四章.SVN猎手 （某站SVN信息泄露+设计问题导致服务器沦陷）</a></p><p><a target="_blank" href="http://www.wooyun.org/bugs/wooyun-2013-018998">WooYun: 爱拍svn泄露，有被脱裤危险，想起了csdn....</a></p><p><a target="_blank" href="http://www.wooyun.org/bugs/wooyun-2013-026351">WooYun: 优酷某分站SVN信息及某sql文件泄漏</a></p><p><a target="_blank" href="http://www.wooyun.org/bugs/wooyun-2012-012665">WooYun: 淘宝网某应用svn信息导致代码泄露</a></p><p><a target="_blank" href="http://www.wooyun.org/bugs/wooyun-2012-012321">WooYun: 鲜果网怕是所有应用要沦陷了？</a></p><p><br><br><br></p><p>参考：</p><p><a href="http://www.subversion.org.cn/?action-viewnews-itemid-1">Subversion快速入门教程</a></p><p><a href="http://www.subversion.org.cn/svnbook/1.4/">使用Subversion进行版本控制</a></p><p><a href="http://www.ibm.com/developerworks/cn/java/j-lo-apache-subversion/">用Apache和Subversion搭建安全的版本控制环境</a></p><p><a href="http://blog.csdn.net/kangquan2008/article/details/8070391">centos svn安装及配置与使用</a></p><p><a href="http://www.cnblogs.com/aLittleBitCool/archive/2011/07/09/2101602.html">linux下svn常用指令</a></p><p><a target="_blank" href="http://www.wooyun.org/bugs/wooyun-2012-05539">WooYun: .svn目录未设权限限制的漏洞利用总结</a></p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div id="donate" style="padding:10px;border-top:1px solid #d9d9d9;text-align:center"><span>碎银子打赏，作者好攒钱娶媳妇：</span><br><br><img src="http://static.wooyun.org/wooyun/upload/donate/20141017203549ef27b55a7921e022214b5780c48f81e0.png" style="width:200px;height:200px"></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/papers/161" rel="bookmark" id="re1">Rsync安全配置</a></li><li><a href="http://drops.wooyun.org/papers/345" rel="bookmark" id="re2">在线支付逻辑漏洞总结</a></li><li><a href="http://drops.wooyun.org/papers/2035" rel="bookmark" id="re3">一些常见的重置密码漏洞分析整理</a></li><li><a href="http://drops.wooyun.org/papers/346" rel="bookmark" id="re4">终端机的安全性</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Ivan</span> <span class="reply-time">2013-12-06 12:58:05</span></div><p></p><p>有一个svn的利用程序</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">newbie0086</span> <span class="reply-time">2013-08-07 23:18:49</span></div><p></p><p>a</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">juuxdd</span> <span class="reply-time">2013-07-31 00:05:33</span></div><p></p><p>m</p><p></p></div></div></div></div></div></main>