<main class="main-container ng-scope" ng-view=""><div class="main receptacle post-view ng-scope"><article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox=""><header><h1 class="entry-title ng-binding">WireShark黑客发现之旅--开篇</h1><div class="entry-meta"><a target="_blank" class="author name ng-binding">聚锋实验室</a> <span class="bull">·</span> <time title="2015/06/18 10:41" ui-time="" datetime="2015/06/18 10:41" class="published ng-binding ng-isolate-scope">2015/06/18 10:41</time></div></header><section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><p></p><h1>0x00 先说几句</h1><hr><p>一看题目，很多朋友就会有疑问：市面上那么多的安全监控分析设备、软件，为什么要用WireShark来发现黑客和攻击行为？我想说的是WireShark目前作为最优秀的网络分析软件，如果用好了，比任何设备、软件都Nice。首先，它识别的协议很多；其次，WireShark其实具备很多分析功能；最主要的，它免费，既能采集又能分析，不丢包、不弃包。</p><p>我们虽然也接触了很多监控分析设备，但在分析中始终离不开WireShark的辅助，喜欢它的“诚实”，不忽悠、不遗漏，完完全全从原理上去认识数据。</p><p>本系列就是要抛开了各种所谓分析“神器”和检测设备，完全依靠WireShark从通信原理去发现和解密黑客的各种攻击行为。当然，仅是交流学习贴，不当之处请各位大神“轻喷”。</p><h1>0x01 WireShark的常用功能</h1><hr><p>介绍WireShark的书籍和文章比较多，本文就不献丑细讲了，一起了解一下部分常用的分析功能。</p><p>1、抓包捕获</p><p>菜单中选择Capture，选择Interface，然后选择需抓包的网卡。</p><p><img alt="enter image description here" img-src="6f929ca3ca81b9a0c6e5db9286ee61dbb7881bea.jpg"></p><p>可以勾选网卡，点击Start开始抓包。如想连续抓包设置文件大小、定义存放位置、过滤性抓包，点击Options进行设置。</p><p><img alt="enter image description here" img-src="6048868c090107f056d037172f8062a4f551c6df.jpg"></p><p>2、数据过滤</p><p>由于抓包是包含网卡所有业务通信数据，看起来比较杂乱，我们可以根据需求在Filter对话框中输入命令进行过滤。常用过滤包括IP过滤（如：ip.addr==x.x.x.x，ip.src== x.x.x.x,ip.dst== x.x.x.x）、协议过滤（如：HTTP、HTTPS、SMTP、ARP等）、端口过滤（如：tcp.port==21、udp.port==53）、组合过滤（如：ip.addr==x.x.x.x &amp;&amp; tcp.port==21、tcp.port==21 or udp.port==53）。更多过滤规则可以在Expression中进行学习查询。</p><p><img alt="enter image description here" img-src="2f927ee2035c39a04757940b521e27c761ec6490.jpg"></p><p>3、协议统计、IP统计、端口统计</p><p>协议统计：在菜单中选择Statistics，然后选择Protocol Hierarchy，就可以统计出所在数据包中所含的IP协议、应用层协议。</p><p><img alt="enter image description here" img-src="65dd81cff6bd6bf84d3338f9f7ba898515632d88.jpg"></p><p>IP统计：在菜单中选择Statistics，然后选择Conversation，就可以统计出所在数据包中所有通信IP地址，包括IPV4和IPV6。</p><p><img alt="enter image description here" img-src="2fa232bb3ff4182b44cea432980cd4e080607c19.jpg"></p><p>端口统计：同IP统计，点击TCP可以看到所有TCP会话的IP、端口包括数据包数等信息，且可以根据需求排序、过滤数据。UDP同理。</p><p><img alt="enter image description here" img-src="b91025a01863273b680281f2ba2a49f17fd1bc5b.jpg"></p><p>4、搜索功能</p><p>WireShark具备强大的搜索功能，在分析中可快速识别出攻击指纹。Ctrl+F弹出搜索对话框。</p><p>Display Filter：显示过滤器，用于查找指定协议所对应的帧。</p><p>Hex Value：搜索数据中十六进制字符位置。</p><p>String：字符串搜索。Packet list：搜索关键字匹配的Info所在帧的位置。Packet details：搜索关键字匹配的Info所包括数据的位置。Packet bytes：搜索关键字匹配的内容位置。</p><p><img alt="enter image description here" img-src="72072acbc8c16b29142b7764ae16373b477bc991.jpg"></p><p>5、Follow TCP Stream</p><p>对于TCP协议，可提取一次会话的TCP流进行分析。点击某帧TCP数据，右键选择Follow TCP Stream，就可以看到本次会话的文本信息，还具备搜索、另存等功能。</p><p><img alt="enter image description here" img-src="7ab9d6336b6215553479fcc55b676073431dc7f0.jpg"></p><p>6、HTTP头部分析</p><p>对于HTTP协议，WireShark可以提取其URL地址信息。</p><p>在菜单中选择Statistics，选择HTTP，然后选择Packet Counter（可以过滤IP）,就可以统计出HTTP会话中请求、应答包数量。</p><p><img alt="enter image description here" img-src="e14d83b447da4c45c7b4691300586a865307a3b4.jpg"></p><p>在菜单中选择Statistics，选择HTTP，然后选择Requests（可以过滤IP）,就可以统计出HTTP会话中Request的域名，包括子域名。</p><p><img alt="enter image description here" img-src="9517daab945af675f409ec9dc9ef0a46880458fa.jpg"></p><p>在菜单中选择Statistics，选择HTTP，然后选择Load Distribution（可以过滤IP）,就可以统计出HTTP会话的IP、域名分布情况，包括返回值。</p><p><img alt="enter image description here" img-src="fd6bbe9becfbdf8a327d062344e91d2762e0255e.jpg"></p><h1>0x02 WireShark分析攻击行为步骤</h1><hr><p>利用WireShark分析攻击行为数据，首先得具备一定的网络协议</p><p>知识，熟悉常见协议，对协议进行分层（最好分七层）识别分析。（如果不熟悉也没关系，现学现用也足够）。然后，需熟悉常见的攻击行为步骤、意图等等。画了张图，不太完善，仅作参考。</p><p><img alt="enter image description here" img-src="4f42988858ee66c2417b63836f5d41668e38988d.jpg"></p><h1>0x03 后续文章初步设计</h1><hr><p>对于后续文章内容，初步设计WireShark黑客发现之旅--暴力破解、端口扫描、Web漏洞扫描、Web漏洞利用、仿冒登陆、钓鱼邮件、数据库攻击、邮件系统攻击、基于Web的内网渗透等。但可能会根据时间、搭建实验环境等情况进行略微调整。 （By：Mr.Right、K0r4dji）</p><p></p></section></article><div class="entry-controls clearfix"><div style="float:left;color:#9d9e9f;font-size:15px"><span>&copy;乌云知识库版权所有 未经许可 禁止转载</span></div></div><div class="yarpp-related"><h3>为您推荐了适合您的技术文章:</h3><ol id="recommandsystem"><li><a href="http://drops.wooyun.org/tips/7300" rel="bookmark" id="re1">WireShark黑客发现之旅（3）—Bodisparking恶意代码</a></li><li><a href="http://drops.wooyun.org/tips/8660" rel="bookmark" id="re2">WireShark黑客发现之旅（5）—扫描探测</a></li><li><a href="http://drops.wooyun.org/tips/4715" rel="bookmark" id="re3">如何发现 NTP 放大攻击漏洞</a></li><li><a href="http://drops.wooyun.org/tips/4707" rel="bookmark" id="re4">Powershell and Windows RAW SOCKET</a></li></ol></div><div id="comments" class="comment-list clearfix"><div id="comment-list"><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">zjgwhh</span> <span class="reply-time">2016-05-11 14:04:39</span></div><p></p><p>收藏看看</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">聚锋实验室</span> <span class="reply-time">2015-06-27 23:00:46</span></div><p></p><p>@用户未填 怕篇幅太多，后续用到时再补充介绍。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">K0r4dji</span> <span class="reply-time">2015-06-20 13:56:54</span></div><p></p><p>斯。。斯锅一</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">聚锋实验室</span> <span class="reply-time">2015-06-19 16:46:24</span></div><p></p><p>@【|→上善若水】 谢谢你的细心。这张图的分层主要是针对数据的分层，确实有很多类型的攻击不止在一个层，这里指的路由攻击主要是指应用层的Telent、SSH、HTTP、HTTPS等。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">【|→上善若水】</span> <span class="reply-time">2015-06-19 13:25:49</span></div><p></p><p>路由攻击怎么在应用层？</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">岩少</span> <span class="reply-time">2015-06-18 17:27:56</span></div><p></p><p>斯。。斯锅一</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">洋2洋</span> <span class="reply-time">2015-06-18 17:27:45</span></div><p></p><p>斯。。斯锅一</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Azui</span> <span class="reply-time">2015-06-18 17:25:22</span></div><p></p><p>斯。。斯锅一</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">me1ody</span> <span class="reply-time">2015-06-18 17:23:54</span></div><p></p><p>斯。。斯锅一</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">rockes</span> <span class="reply-time">2015-06-18 17:23:25</span></div><p></p><p>斯。。斯锅一</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">Liuk3r</span> <span class="reply-time">2015-06-18 17:14:29</span></div><p></p><p>斯。。斯锅一</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">爷</span> <span class="reply-time">2015-06-18 17:14:07</span></div><p></p><p>斯。。斯锅一</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">saline</span> <span class="reply-time">2015-06-18 17:13:21</span></div><p></p><p>斯。。斯锅一</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">SLAckEr</span> <span class="reply-time">2015-06-18 17:12:56</span></div><p></p><p>斯。。斯锅一</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">啊L川</span> <span class="reply-time">2015-06-18 15:38:24</span></div><p></p><p>点赞</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">聚锋实验室</span> <span class="reply-time">2015-06-18 12:57:26</span></div><p></p><p>@ccav<br>还真没有。<br>最近大概看了一本诸葛建伟翻译的《WireShark数据包分析实战》，很实用。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">聚锋实验室</span> <span class="reply-time">2015-06-18 11:43:42</span></div><p></p><p>@9527<br>正在准备后序文章。</p><p></p></div></div><div class="note-comment"><img class="avatar" alt="30" src="http://wooyun.b0.upaiyun.com/wooyun_job/avatar/default.png"><div class="content"><div class="comment-header"><span class="author-link">9527</span> <span class="reply-time">2015-06-18 11:23:34</span></div><p></p><p>期待更新</p><p></p></div></div></div></div></div></main>